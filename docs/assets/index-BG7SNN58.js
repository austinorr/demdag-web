const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/raw-in9isEBO.js","assets/basedecoder-B2c5_Eok.js","assets/lzw-_aCqfs4w.js","assets/jpeg-vtRboCKw.js","assets/deflate-B9JhHpvg.js","assets/pako.esm-Cram60i4.js","assets/packbits-DDWKfGV_.js","assets/lerc-BlYw7UyN.js","assets/webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();function D(t){return(e,...r)=>Rt(t,e,r)}function j(t,e){return D(Je(t,e).get)}const{apply:Rt,getOwnPropertyDescriptor:Je,getPrototypeOf:Ue,ownKeys:Ut}=Reflect,{iterator:te,toStringTag:Bt}=Symbol,Mt=Object,{create:Be,defineProperty:Ot}=Mt,Lt=Array,Gt=Lt.prototype,Qe=Gt[te],Ft=D(Qe),We=ArrayBuffer,Ct=We.prototype;j(Ct,"byteLength");const je=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;je&&j(je.prototype,"byteLength");const et=Ue(Uint8Array);et.from;const _=et.prototype;_[te];D(_.keys);D(_.values);D(_.entries);D(_.set);D(_.reverse);D(_.fill);D(_.copyWithin);D(_.sort);D(_.slice);D(_.subarray);j(_,"buffer");j(_,"byteOffset");j(_,"length");j(_,Bt);const Nt=Uint8Array,tt=Uint16Array,Me=Uint32Array,kt=Float32Array,W=Ue([][te]()),rt=D(W.next),Kt=D((function*(){})().next),Vt=Ue(W),jt=DataView.prototype,qt=D(jt.getUint16),Oe=WeakMap,nt=Oe.prototype,it=D(nt.get),Yt=D(nt.set),ot=new Oe,Xt=Be(null,{next:{value:function(){const e=it(ot,this);return rt(e)}},[te]:{value:function(){return this}}});function $t(t){if(t[te]===Qe&&W.next===rt)return t;const e=Be(Xt);return Yt(ot,e,Ft(t)),e}const zt=new Oe,Ht=Be(Vt,{next:{value:function(){const e=it(zt,this);return Kt(e)},writable:!0,configurable:!0}});for(const t of Ut(W))t!=="next"&&Ot(Ht,t,Je(W,t));const st=new We(4),Zt=new kt(st),Jt=new Me(st),B=new tt(512),M=new Nt(512);for(let t=0;t<256;++t){const e=t-127;e<-24?(B[t]=0,B[t|256]=32768,M[t]=24,M[t|256]=24):e<-14?(B[t]=1024>>-e-14,B[t|256]=1024>>-e-14|32768,M[t]=-e-1,M[t|256]=-e-1):e<=15?(B[t]=e+15<<10,B[t|256]=e+15<<10|32768,M[t]=13,M[t|256]=13):e<128?(B[t]=31744,B[t|256]=64512,M[t]=24,M[t|256]=24):(B[t]=31744,B[t|256]=64512,M[t]=13,M[t|256]=13)}const Le=new Me(2048);for(let t=1;t<1024;++t){let e=t<<13,r=0;for(;(e&8388608)===0;)e<<=1,r-=8388608;e&=-8388609,r+=947912704,Le[t]=e|r}for(let t=1024;t<2048;++t)Le[t]=939524096+(t-1024<<13);const q=new Me(64);for(let t=1;t<31;++t)q[t]=t<<23;q[31]=1199570944;q[32]=2147483648;for(let t=33;t<63;++t)q[t]=2147483648+(t-32<<23);q[63]=3347054592;const at=new tt(64);for(let t=1;t<64;++t)t!==32&&(at[t]=1024);function Qt(t){const e=t>>10;return Jt[0]=Le[at[e]+(t&1023)]+q[e],Zt[0]}function ct(t,e,...r){return Qt(qt(t,e,...$t(r)))}function lt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ae={exports:{}},qe;function Wt(){if(qe)return ae.exports;qe=1;function t(e,r,i){const n=i&&i.debug||!1;n&&console.log("[xml-utils] getting "+r+" in "+e);const o=typeof e=="object"?e.outer:e,a=o.slice(0,o.indexOf(">")+1),s=['"',"'"];for(let l=0;l<s.length;l++){const c=s[l],u=r+"\\="+c+"([^"+c+"]*)"+c;n&&console.log("[xml-utils] pattern:",u);const m=new RegExp(u).exec(a);if(n&&console.log("[xml-utils] match:",m),m)return m[1]}}return ae.exports=t,ae.exports.default=t,ae.exports}var er=Wt();const Ee=lt(er);var ce={exports:{}},le={exports:{}},fe={exports:{}},Ye;function tr(){if(Ye)return fe.exports;Ye=1;function t(e,r,i){const o=new RegExp(r).exec(e.slice(i));return o?i+o.index:-1}return fe.exports=t,fe.exports.default=t,fe.exports}var ue={exports:{}},Xe;function rr(){if(Xe)return ue.exports;Xe=1;function t(e,r,i){const o=new RegExp(r).exec(e.slice(i));return o?i+o.index+o[0].length-1:-1}return ue.exports=t,ue.exports.default=t,ue.exports}var he={exports:{}},$e;function nr(){if($e)return he.exports;$e=1;function t(e,r){const i=new RegExp(r,"g"),n=e.match(i);return n?n.length:0}return he.exports=t,he.exports.default=t,he.exports}var ze;function ir(){if(ze)return le.exports;ze=1;const t=tr(),e=rr(),r=nr();function i(n,o,a){const s=a&&a.debug||!1,l=!(a&&typeof a.nested===!1),c=a&&a.startIndex||0;s&&console.log("[xml-utils] starting findTagByName with",o," and ",a);const u=t(n,`<${o}[ 
>/]`,c);if(s&&console.log("[xml-utils] start:",u),u===-1)return;const h=n.slice(u+o.length);let m=e(h,"^[^<]*[ /]>",0);const d=m!==-1&&h[m-1]==="/";if(s&&console.log("[xml-utils] selfClosing:",d),d===!1)if(l){let T=0,x=1,b=0;for(;(m=e(h,"[ /]"+o+">",T))!==-1;){const E=h.substring(T,m+1);if(x+=r(E,"<"+o+`[ 
	>]`),b+=r(E,"</"+o+">"),b>=x)break;T=m}}else m=e(h,"[ /]"+o+">",0);const g=u+o.length+m+1;if(s&&console.log("[xml-utils] end:",g),g===-1)return;const p=n.slice(u,g);let y;return d?y=null:y=p.slice(p.indexOf(">")+1,p.lastIndexOf("<")),{inner:y,outer:p,start:u,end:g}}return le.exports=i,le.exports.default=i,le.exports}var He;function or(){if(He)return ce.exports;He=1;const t=ir();function e(r,i,n){const o=[],a=n&&n.debug||!1,s=n&&typeof n.nested=="boolean"?n.nested:!0;let l=n&&n.startIndex||0,c;for(;c=t(r,i,{debug:a,startIndex:l});)s?l=c.start+1+i.length:l=c.end,o.push(c);return a&&console.log("findTagsByName found",o.length,"tags"),o}return ce.exports=e,ce.exports.default=e,ce.exports}var sr=or();const ar=lt(sr),Z={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},O={};for(const t in Z)Z.hasOwnProperty(t)&&(O[Z[t]]=parseInt(t,10));const cr=[O.BitsPerSample,O.ExtraSamples,O.SampleFormat,O.StripByteCounts,O.StripOffsets,O.StripRowCounts,O.TileByteCounts,O.TileOffsets,O.SubIFDs],Ae={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},w={};for(const t in Ae)Ae.hasOwnProperty(t)&&(w[Ae[t]]=parseInt(t,10));const P={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8},lr={Unspecified:0},yn={AddCompression:1},pn={None:0,Deflate:1,Zstandard:2},fr={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function ur(t,e){const{width:r,height:i}=t,n=new Uint8Array(r*i*3);let o;for(let a=0,s=0;a<t.length;++a,s+=3)o=256-t[a]/e*256,n[s]=o,n[s+1]=o,n[s+2]=o;return n}function hr(t,e){const{width:r,height:i}=t,n=new Uint8Array(r*i*3);let o;for(let a=0,s=0;a<t.length;++a,s+=3)o=t[a]/e*256,n[s]=o,n[s+1]=o,n[s+2]=o;return n}function dr(t,e){const{width:r,height:i}=t,n=new Uint8Array(r*i*3),o=e.length/3,a=e.length/3*2;for(let s=0,l=0;s<t.length;++s,l+=3){const c=t[s];n[l]=e[c]/65536*256,n[l+1]=e[c+o]/65536*256,n[l+2]=e[c+a]/65536*256}return n}function gr(t){const{width:e,height:r}=t,i=new Uint8Array(e*r*3);for(let n=0,o=0;n<t.length;n+=4,o+=3){const a=t[n],s=t[n+1],l=t[n+2],c=t[n+3];i[o]=255*((255-a)/256)*((255-c)/256),i[o+1]=255*((255-s)/256)*((255-c)/256),i[o+2]=255*((255-l)/256)*((255-c)/256)}return i}function mr(t){const{width:e,height:r}=t,i=new Uint8ClampedArray(e*r*3);for(let n=0,o=0;n<t.length;n+=3,o+=3){const a=t[n],s=t[n+1],l=t[n+2];i[o]=a+1.402*(l-128),i[o+1]=a-.34414*(s-128)-.71414*(l-128),i[o+2]=a+1.772*(s-128)}return i}const yr=.95047,pr=1,xr=1.08883;function wr(t){const{width:e,height:r}=t,i=new Uint8Array(e*r*3);for(let n=0,o=0;n<t.length;n+=3,o+=3){const a=t[n+0],s=t[n+1]<<24>>24,l=t[n+2]<<24>>24;let c=(a+16)/116,u=s/500+c,h=c-l/200,m,d,g;u=yr*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),c=pr*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),h=xr*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),m=u*3.2406+c*-1.5372+h*-.4986,d=u*-.9689+c*1.8758+h*.0415,g=u*.0557+c*-.204+h*1.057,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,i[o]=Math.max(0,Math.min(1,m))*255,i[o+1]=Math.max(0,Math.min(1,d))*255,i[o+2]=Math.max(0,Math.min(1,g))*255}return i}const Tr="modulepreload",br=function(t){return"/demdag-web/"+t},Ze={},k=function(e,r,i){let n=Promise.resolve();if(r&&r.length>0){let l=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=a?.nonce||a?.getAttribute("nonce");n=l(r.map(c=>{if(c=br(c),c in Ze)return;Ze[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":Tr,u||(m.as="script"),m.crossOrigin="",m.href=c,s&&m.setAttribute("nonce",s),document.head.appendChild(m),u)return new Promise((d,g)=>{m.addEventListener("load",d),m.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return n.then(a=>{for(const s of a||[])s.status==="rejected"&&o(s.reason);return e().catch(o)})},ft=new Map;function G(t,e){Array.isArray(t)||(t=[t]),t.forEach(r=>ft.set(r,e))}async function Er(t){const e=ft.get(t.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${t.Compression}`);const r=await e();return new r(t)}G([void 0,1],()=>k(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([0,1])).then(t=>t.default));G(5,()=>k(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([2,1])).then(t=>t.default));G(6,()=>{throw new Error("old style JPEG compression is not supported.")});G(7,()=>k(()=>import("./jpeg-vtRboCKw.js"),__vite__mapDeps([3,1])).then(t=>t.default));G([8,32946],()=>k(()=>import("./deflate-B9JhHpvg.js"),__vite__mapDeps([4,5,1])).then(t=>t.default));G(32773,()=>k(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([6,1])).then(t=>t.default));G(34887,()=>k(()=>import("./lerc-BlYw7UyN.js"),__vite__mapDeps([7,5,1])).then(async t=>(await t.zstd.init(),t)).then(t=>t.default));G(50001,()=>k(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([8,1])).then(t=>t.default));function xe(t,e,r,i=1){return new(Object.getPrototypeOf(t)).constructor(e*r*i)}function Ar(t,e,r,i,n){const o=e/i,a=r/n;return t.map(s=>{const l=xe(s,i,n);for(let c=0;c<n;++c){const u=Math.min(Math.round(a*c),r-1);for(let h=0;h<i;++h){const m=Math.min(Math.round(o*h),e-1),d=s[u*e+m];l[c*i+h]=d}}return l})}function V(t,e,r){return(1-r)*t+r*e}function Sr(t,e,r,i,n){const o=e/i,a=r/n;return t.map(s=>{const l=xe(s,i,n);for(let c=0;c<n;++c){const u=a*c,h=Math.floor(u),m=Math.min(Math.ceil(u),r-1);for(let d=0;d<i;++d){const g=o*d,p=g%1,y=Math.floor(g),T=Math.min(Math.ceil(g),e-1),x=s[h*e+y],b=s[h*e+T],E=s[m*e+y],A=s[m*e+T],v=V(V(x,b,p),V(E,A,p),u%1);l[c*i+d]=v}}return l})}function Dr(t,e,r,i,n,o="nearest"){switch(o.toLowerCase()){case"nearest":return Ar(t,e,r,i,n);case"bilinear":case"linear":return Sr(t,e,r,i,n);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function Ir(t,e,r,i,n,o){const a=e/i,s=r/n,l=xe(t,i,n,o);for(let c=0;c<n;++c){const u=Math.min(Math.round(s*c),r-1);for(let h=0;h<i;++h){const m=Math.min(Math.round(a*h),e-1);for(let d=0;d<o;++d){const g=t[u*e*o+m*o+d];l[c*i*o+h*o+d]=g}}}return l}function _r(t,e,r,i,n,o){const a=e/i,s=r/n,l=xe(t,i,n,o);for(let c=0;c<n;++c){const u=s*c,h=Math.floor(u),m=Math.min(Math.ceil(u),r-1);for(let d=0;d<i;++d){const g=a*d,p=g%1,y=Math.floor(g),T=Math.min(Math.ceil(g),e-1);for(let x=0;x<o;++x){const b=t[h*e*o+y*o+x],E=t[h*e*o+T*o+x],A=t[m*e*o+y*o+x],v=t[m*e*o+T*o+x],Y=V(V(b,E,p),V(A,v,p),u%1);l[c*i*o+d*o+x]=Y}}}return l}function vr(t,e,r,i,n,o,a="nearest"){switch(a.toLowerCase()){case"nearest":return Ir(t,e,r,i,n,o);case"bilinear":case"linear":return _r(t,e,r,i,n,o);default:throw new Error(`Unsupported resampling method: '${a}'`)}}function Pr(t,e,r){let i=0;for(let n=e;n<r;++n)i+=t[n];return i}function Ie(t,e,r){switch(t){case 1:if(e<=8)return new Uint8Array(r);if(e<=16)return new Uint16Array(r);if(e<=32)return new Uint32Array(r);break;case 2:if(e===8)return new Int8Array(r);if(e===16)return new Int16Array(r);if(e===32)return new Int32Array(r);break;case 3:switch(e){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}break}throw Error("Unsupported data format/bitsPerSample")}function Rr(t,e){return(t===1||t===2)&&e<=32&&e%8===0?!1:!(t===3&&(e===16||e===32||e===64))}function Ur(t,e,r,i,n,o,a){const s=new DataView(t),l=r===2?a*o:a*o*i,c=r===2?1:i,u=Ie(e,n,l),h=parseInt("1".repeat(n),2);if(e===1){let m;r===1?m=i*n:m=n;let d=o*m;(d&7)!==0&&(d=d+7&-8);for(let g=0;g<a;++g){const p=g*d;for(let y=0;y<o;++y){const T=p+y*c*n;for(let x=0;x<c;++x){const b=T+x*n,E=(g*o+y)*c+x,A=Math.floor(b/8),v=b%8;if(v+n<=8)u[E]=s.getUint8(A)>>8-n-v&h;else if(v+n<=16)u[E]=s.getUint16(A)>>16-n-v&h;else if(v+n<=24){const Y=s.getUint16(A)<<8|s.getUint8(A+2);u[E]=Y>>24-n-v&h}else u[E]=s.getUint32(A)>>32-n-v&h}}}}return u.buffer}class Br{constructor(e,r,i,n,o,a){this.fileDirectory=e,this.geoKeys=r,this.dataView=i,this.littleEndian=n,this.tiles=o?{}:null,this.isTiled=!e.StripOffsets;const s=e.PlanarConfiguration;if(this.planarConfiguration=typeof s>"u"?1:s,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=a}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let r=0;r<this.fileDirectory.BitsPerSample.length;++r)e+=this.getSampleByteSize(r);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const r=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(r){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(n,o){return ct(this,n,o)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,r){const i=this.getSampleFormat(e),n=this.getBitsPerSample(e);return Ie(i,n,r)}async getTileOrStrip(e,r,i,n,o){const a=Math.ceil(this.getWidth()/this.getTileWidth()),s=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:c}=this;this.planarConfiguration===1?l=r*a+e:this.planarConfiguration===2&&(l=i*a*s+r*a+e);let u,h;this.isTiled?(u=this.fileDirectory.TileOffsets[l],h=this.fileDirectory.TileByteCounts[l]):(u=this.fileDirectory.StripOffsets[l],h=this.fileDirectory.StripByteCounts[l]);const m=(await this.source.fetch([{offset:u,length:h}],o))[0];let d;return c===null||!c[l]?(d=(async()=>{let g=await n.decode(this.fileDirectory,m);const p=this.getSampleFormat(),y=this.getBitsPerSample();return Rr(p,y)&&(g=Ur(g,p,this.planarConfiguration,this.getSamplesPerPixel(),y,this.getTileWidth(),this.getBlockHeight(r))),g})(),c!==null&&(c[l]=d)):d=c[l],{x:e,y:r,sample:i,data:await d}}async _readRaster(e,r,i,n,o,a,s,l,c){const u=this.getTileWidth(),h=this.getTileHeight(),m=this.getWidth(),d=this.getHeight(),g=Math.max(Math.floor(e[0]/u),0),p=Math.min(Math.ceil(e[2]/u),Math.ceil(m/u)),y=Math.max(Math.floor(e[1]/h),0),T=Math.min(Math.ceil(e[3]/h),Math.ceil(d/h)),x=e[2]-e[0];let b=this.getBytesPerPixel();const E=[],A=[];for(let I=0;I<r.length;++I)this.planarConfiguration===1?E.push(Pr(this.fileDirectory.BitsPerSample,0,r[I])/8):E.push(0),A.push(this.getReaderForSample(r[I]));const v=[],{littleEndian:Y}=this;for(let I=y;I<T;++I)for(let re=g;re<p;++re){let Te;this.planarConfiguration===1&&(Te=this.getTileOrStrip(re,I,0,o,c));for(let ne=0;ne<r.length;++ne){const ie=ne,Ke=r[ne];this.planarConfiguration===2&&(b=this.getSampleByteSize(Ke),Te=this.getTileOrStrip(re,I,Ke,o,c));const bt=Te.then(X=>{const Et=X.data,At=new DataView(Et),be=this.getBlockHeight(X.y),$=X.y*h,oe=X.x*u,St=$+be,Dt=(X.x+1)*u,It=A[ie],_t=Math.min(be,be-(St-e[3]),d-$),vt=Math.min(u,u-(Dt-e[2]),m-oe);for(let z=Math.max(0,e[1]-$);z<_t;++z)for(let H=Math.max(0,e[0]-oe);H<vt;++H){const Pt=(z*u+H)*b,Ve=It.call(At,Pt+E[ie],Y);let se;n?(se=(z+$-e[1])*x*r.length+(H+oe-e[0])*r.length+ie,i[se]=Ve):(se=(z+$-e[1])*x+H+oe-e[0],i[ie][se]=Ve)}});v.push(bt)}}if(await Promise.all(v),a&&e[2]-e[0]!==a||s&&e[3]-e[1]!==s){let I;return n?I=vr(i,e[2]-e[0],e[3]-e[1],a,s,r.length,l):I=Dr(i,e[2]-e[0],e[3]-e[1],a,s,l),I.width=a,I.height=s,I}return i.width=a||e[2]-e[0],i.height=s||e[3]-e[1],i}async readRasters({window:e,samples:r=[],interleave:i,pool:n=null,width:o,height:a,resampleMethod:s,fillValue:l,signal:c}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const h=u[2]-u[0],m=u[3]-u[1],d=h*m,g=this.getSamplesPerPixel();if(!r||!r.length)for(let x=0;x<g;++x)r.push(x);else for(let x=0;x<r.length;++x)if(r[x]>=g)return Promise.reject(new RangeError(`Invalid sample index '${r[x]}'.`));let p;if(i){const x=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,b=Math.max.apply(null,this.fileDirectory.BitsPerSample);p=Ie(x,b,d*r.length),l&&p.fill(l)}else{p=[];for(let x=0;x<r.length;++x){const b=this.getArrayForSample(r[x],d);Array.isArray(l)&&x<l.length?b.fill(l[x]):l&&!Array.isArray(l)&&b.fill(l),p.push(b)}}const y=n||await Er(this.fileDirectory);return await this._readRaster(u,r,p,i,y,o,a,s,c)}async readRGB({window:e,interleave:r=!0,pool:i=null,width:n,height:o,resampleMethod:a,enableAlpha:s=!1,signal:l}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=this.fileDirectory.PhotometricInterpretation;if(u===P.RGB){let T=[0,1,2];if(this.fileDirectory.ExtraSamples!==lr.Unspecified&&s){T=[];for(let x=0;x<this.fileDirectory.BitsPerSample.length;x+=1)T.push(x)}return this.readRasters({window:e,interleave:r,samples:T,pool:i,width:n,height:o,resampleMethod:a,signal:l})}let h;switch(u){case P.WhiteIsZero:case P.BlackIsZero:case P.Palette:h=[0];break;case P.CMYK:h=[0,1,2,3];break;case P.YCbCr:case P.CIELab:h=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const m={window:c,interleave:!0,samples:h,pool:i,width:n,height:o,resampleMethod:a,signal:l},{fileDirectory:d}=this,g=await this.readRasters(m),p=2**this.fileDirectory.BitsPerSample[0];let y;switch(u){case P.WhiteIsZero:y=ur(g,p);break;case P.BlackIsZero:y=hr(g,p);break;case P.Palette:y=dr(g,d.ColorMap);break;case P.CMYK:y=gr(g);break;case P.YCbCr:y=mr(g);break;case P.CIELab:y=wr(g);break;default:throw new Error("Unsupported photometric interpretation.")}if(!r){const T=new Uint8Array(y.length/3),x=new Uint8Array(y.length/3),b=new Uint8Array(y.length/3);for(let E=0,A=0;E<y.length;E+=3,++A)T[A]=y[E],x[A]=y[E+1],b[A]=y[E+2];y=[T,x,b]}return y.width=g.width,y.height=g.height,y}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let r=0;r<this.fileDirectory.ModelTiepoint.length;r+=6)e.push({i:this.fileDirectory.ModelTiepoint[r],j:this.fileDirectory.ModelTiepoint[r+1],k:this.fileDirectory.ModelTiepoint[r+2],x:this.fileDirectory.ModelTiepoint[r+3],y:this.fileDirectory.ModelTiepoint[r+4],z:this.fileDirectory.ModelTiepoint[r+5]});return e}getGDALMetadata(e=null){const r={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let n=ar(i,"Item");e===null?n=n.filter(o=>Ee(o,"sample")===void 0):n=n.filter(o=>Number(Ee(o,"sample"))===e);for(let o=0;o<n.length;++o){const a=n[o];r[Ee(a,"name")]=a.inner}return r}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,r=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(r)return[r[3],r[7],r[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const r=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(r)return[r[0],-r[1],r[2]];if(i)return i[1]===0&&i[4]===0?[i[0],-i[5],i[10]]:[Math.sqrt(i[0]*i[0]+i[4]*i[4]),-Math.sqrt(i[1]*i[1]+i[5]*i[5]),i[10]];if(e){const[n,o,a]=e.getResolution();return[n*e.getWidth()/this.getWidth(),o*e.getHeight()/this.getHeight(),a*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const r=this.getHeight(),i=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[n,o,a,s,l,c,u,h]=this.fileDirectory.ModelTransformation,d=[[0,0],[0,r],[i,0],[i,r]].map(([y,T])=>[s+n*y+o*T,h+l*y+c*T]),g=d.map(y=>y[0]),p=d.map(y=>y[1]);return[Math.min(...g),Math.min(...p),Math.max(...g),Math.max(...p)]}else{const n=this.getOrigin(),o=this.getResolution(),a=n[0],s=n[1],l=a+o[0]*i,c=s+o[1]*r;return[Math.min(a,l),Math.min(s,c),Math.max(a,l),Math.max(s,c)]}}}class Mr{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,r){const i=this.getUint32(e,r),n=this.getUint32(e+4,r);let o;if(r){if(o=i+2**32*n,!Number.isSafeInteger(o))throw new Error(`${o} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return o}if(o=2**32*i+n,!Number.isSafeInteger(o))throw new Error(`${o} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return o}getInt64(e,r){let i=0;const n=(this._dataView.getUint8(e+(r?7:0))&128)>0;let o=!0;for(let a=0;a<8;a++){let s=this._dataView.getUint8(e+(r?a:7-a));n&&(o?s!==0&&(s=~(s-1)&255,o=!1):s=~s&255),i+=s*256**a}return n&&(i=-i),i}getUint8(e,r){return this._dataView.getUint8(e,r)}getInt8(e,r){return this._dataView.getInt8(e,r)}getUint16(e,r){return this._dataView.getUint16(e,r)}getInt16(e,r){return this._dataView.getInt16(e,r)}getUint32(e,r){return this._dataView.getUint32(e,r)}getInt32(e,r){return this._dataView.getInt32(e,r)}getFloat16(e,r){return ct(this._dataView,e,r)}getFloat32(e,r){return this._dataView.getFloat32(e,r)}getFloat64(e,r){return this._dataView.getFloat64(e,r)}}class Or{constructor(e,r,i,n){this._dataView=new DataView(e),this._sliceOffset=r,this._littleEndian=i,this._bigTiff=n}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,r){return this.sliceOffset<=e&&this.sliceTop>=e+r}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const r=this.readUint32(e),i=this.readUint32(e+4);let n;if(this._littleEndian){if(n=r+2**32*i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*r+i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}readInt64(e){let r=0;const i=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let n=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(this._littleEndian?o:7-o));i&&(n?a!==0&&(a=~(a-1)&255,n=!1):a=~a&255),r+=a*256**o}return i&&(r=-r),r}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}class Lr{async fetch(e,r=void 0){return Promise.all(e.map(i=>this.fetchSlice(i,r)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class Ge extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Ge),this.name="AbortError"}}class Gr extends Lr{constructor(e){super(),this.arrayBuffer=e}fetchSlice(e,r){if(r&&r.aborted)throw new Ge("Request aborted");return this.arrayBuffer.slice(e.offset,e.offset+e.length)}}function Fr(t){return new Gr(t)}function _e(t){switch(t){case w.BYTE:case w.ASCII:case w.SBYTE:case w.UNDEFINED:return 1;case w.SHORT:case w.SSHORT:return 2;case w.LONG:case w.SLONG:case w.FLOAT:case w.IFD:return 4;case w.RATIONAL:case w.SRATIONAL:case w.DOUBLE:case w.LONG8:case w.SLONG8:case w.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${t}`)}}function Cr(t){const e=t.GeoKeyDirectory;if(!e)return null;const r={};for(let i=4;i<=e[3]*4;i+=4){const n=fr[e[i]],o=e[i+1]?Z[e[i+1]]:null,a=e[i+2],s=e[i+3];let l=null;if(!o)l=s;else{if(l=t[o],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${n}'.`);typeof l=="string"?l=l.substring(s,s+a-1):l.subarray&&(l=l.subarray(s,s+a),a===1&&(l=l[0]))}r[n]=l}return r}function K(t,e,r,i){let n=null,o=null;const a=_e(e);switch(e){case w.BYTE:case w.ASCII:case w.UNDEFINED:n=new Uint8Array(r),o=t.readUint8;break;case w.SBYTE:n=new Int8Array(r),o=t.readInt8;break;case w.SHORT:n=new Uint16Array(r),o=t.readUint16;break;case w.SSHORT:n=new Int16Array(r),o=t.readInt16;break;case w.LONG:case w.IFD:n=new Uint32Array(r),o=t.readUint32;break;case w.SLONG:n=new Int32Array(r),o=t.readInt32;break;case w.LONG8:case w.IFD8:n=new Array(r),o=t.readUint64;break;case w.SLONG8:n=new Array(r),o=t.readInt64;break;case w.RATIONAL:n=new Uint32Array(r*2),o=t.readUint32;break;case w.SRATIONAL:n=new Int32Array(r*2),o=t.readInt32;break;case w.FLOAT:n=new Float32Array(r),o=t.readFloat32;break;case w.DOUBLE:n=new Float64Array(r),o=t.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===w.RATIONAL||e===w.SRATIONAL)for(let s=0;s<r;s+=2)n[s]=o.call(t,i+s*a),n[s+1]=o.call(t,i+(s*a+4));else for(let s=0;s<r;++s)n[s]=o.call(t,i+s*a);return e===w.ASCII?new TextDecoder("utf-8").decode(n):n}class Nr{constructor(e,r,i){this.fileDirectory=e,this.geoKeyDirectory=r,this.nextIFDByteOffset=i}}class de extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class kr{async readRasters(e={}){const{window:r,width:i,height:n}=e;let{resX:o,resY:a,bbox:s}=e;const l=await this.getImage();let c=l;const u=await this.getImageCount(),h=l.getBoundingBox();if(r&&s)throw new Error('Both "bbox" and "window" passed.');if(i||n){if(r){const[g,p]=l.getOrigin(),[y,T]=l.getResolution();s=[g+r[0]*y,p+r[1]*T,g+r[2]*y,p+r[3]*T]}const d=s||h;if(i){if(o)throw new Error("Both width and resX passed");o=(d[2]-d[0])/i}if(n){if(a)throw new Error("Both width and resY passed");a=(d[3]-d[1])/n}}if(o||a){const d=[];for(let g=0;g<u;++g){const p=await this.getImage(g),{SubfileType:y,NewSubfileType:T}=p.fileDirectory;(g===0||y===2||T&1)&&d.push(p)}d.sort((g,p)=>g.getWidth()-p.getWidth());for(let g=0;g<d.length;++g){const p=d[g],y=(h[2]-h[0])/p.getWidth(),T=(h[3]-h[1])/p.getHeight();if(c=p,o&&o>y||a&&a>T)break}}let m=r;if(s){const[d,g]=l.getOrigin(),[p,y]=c.getResolution(l);m=[Math.round((s[0]-d)/p),Math.round((s[1]-g)/y),Math.round((s[2]-d)/p),Math.round((s[3]-g)/y)],m=[Math.min(m[0],m[2]),Math.min(m[1],m[3]),Math.max(m[0],m[2]),Math.max(m[1],m[3])]}return c.readRasters({...e,window:m})}}class Fe extends kr{constructor(e,r,i,n,o={}){super(),this.source=e,this.littleEndian=r,this.bigTiff=i,this.firstIFDOffset=n,this.cache=o.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,r){const i=this.bigTiff?4048:1024;return new Or((await this.source.fetch([{offset:e,length:typeof r<"u"?r:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const r=this.bigTiff?20:12,i=this.bigTiff?8:2;let n=await this.getSlice(e);const o=this.bigTiff?n.readUint64(e):n.readUint16(e),a=o*r+(this.bigTiff?16:6);n.covers(e,a)||(n=await this.getSlice(e,a));const s={};let l=e+(this.bigTiff?8:2);for(let h=0;h<o;l+=r,++h){const m=n.readUint16(l),d=n.readUint16(l+2),g=this.bigTiff?n.readUint64(l+4):n.readUint32(l+4);let p,y;const T=_e(d),x=l+(this.bigTiff?12:8);if(T*g<=(this.bigTiff?8:4))p=K(n,d,g,x);else{const b=n.readOffset(x),E=_e(d)*g;if(n.covers(b,E))p=K(n,d,g,b);else{const A=await this.getSlice(b,E);p=K(A,d,g,b)}}g===1&&cr.indexOf(m)===-1&&!(d===w.RATIONAL||d===w.SRATIONAL)?y=p[0]:y=p,s[Z[m]]=y}const c=Cr(s),u=n.readOffset(e+i+r*o);return new Nr(s,c,u)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(r){throw r instanceof de?new de(e):r}return this.ifdRequests[e]=(async()=>{const r=await this.ifdRequests[e-1];if(r.nextIFDByteOffset===0)throw new de(e);return this.parseFileDirectoryAt(r.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const r=await this.requestIFD(e);return new Br(r.fileDirectory,r.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,r=!0;for(;r;)try{await this.requestIFD(e),++e}catch(i){if(i instanceof de)r=!1;else throw i}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const r="GDAL_STRUCTURAL_METADATA_SIZE=",i=r.length+100;let n=await this.getSlice(e,i);if(r===K(n,w.ASCII,r.length,e)){const a=K(n,w.ASCII,i,e).split(`
`)[0],s=Number(a.split("=")[1].split(" ")[0])+a.length;s>i&&(n=await this.getSlice(e,s));const l=K(n,w.ASCII,s,e);this.ghostValues={},l.split(`
`).filter(c=>c.length>0).map(c=>c.split("=")).forEach(([c,u])=>{this.ghostValues[c]=u})}return this.ghostValues}static async fromSource(e,r,i){const n=(await e.fetch([{offset:0,length:1024}],i))[0],o=new Mr(n),a=o.getUint16(0,0);let s;if(a===18761)s=!0;else if(a===19789)s=!1;else throw new TypeError("Invalid byte order value.");const l=o.getUint16(2,s);let c;if(l===42)c=!1;else if(l===43){if(c=!0,o.getUint16(4,s)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const u=c?o.getUint64(8,s):o.getUint32(4,s);return new Fe(e,s,c,u,r)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function Kr(t,e){return Fe.fromSource(Fr(t),e)}const Vr="/demdag-web/assets/d8_discovery-DIlOFSey.tif",jr="/demdag-web/assets/d8_finish-Bx5Xn6p1.tif",qr="/demdag-web/assets/d8_bg-CjKuwq6_.jpg",Yr="/demdag-web/assets/helens_fdr_discovery-CKLjcKoa.tif",Xr="/demdag-web/assets/helens_fdr_finish-BCrm6vHq.tif",$r="/demdag-web/assets/helens_bg-Bc-HqWEv.jpg",zr=()=>(ge=(ge+1)%ve.length,N=ve[ge],ee=Ce(),N),Ce=()=>{switch(N){case"large":return dn;case"none":return 0;default:return R>=8||R>=4?0:R>=2?1:R>=1?2:R>=.5?4:R<=.25?8:0}},we=()=>{console.debug("locating hud");let t=document.getElementById("canvas").getBoundingClientRect();F.style.top=t.top+15+"px",F.style.left=t.left+15+"px",t.top<0&&(F.style.top="15px"),t.left<0&&(F.style.left="15px")},ut=t=>{console.debug("zoom: ",t);let e=document.getElementById("canvas");e.style.width=`${f.canvas.width*t}px`,e.style.height=`${f.canvas.height*t}px`;let r=document.getElementById("zoom");r.innerHTML=t,we()},ht=t=>{let e=C+t;e<0&&(e=0),e>=Q.length&&(e=Q.length-1),C=e,R=Q[C],ut(R),me()},Hr=t=>new Promise((e,r)=>{const i=new Image;i.crossOrigin="Anonymous",i.onload=()=>e(i),i.onerror=n=>r(n),i.src=t}),Zr=async t=>{if(!Se?.[t]){let e;console.debug("fetching:",t);const i=await(await fetch(t)).arrayBuffer(),o=await(await Kr(i)).getImage(),a=o.getWidth(),s=o.getHeight();if(t.includes("_discovery")||t.includes("_finish")){const c=(await o.readRasters())[0],u=new Uint8ClampedArray(c.length*4);for(let m=0;m<s;m++)for(let d=0;d<a;d++){const g=m*a+d,p=4*m*a+4*d,y=c[g];u[p]=y&255,u[p+1]=y>>8&255,u[p+2]=y>>16&255,u[p+3]=y>>24&255}const h={data:u,width:a,height:s,_raw_data:c};console.debug("data: ",h,t),e=h}else{const l=await o.readRGB(),c=document.createElement("canvas");c.width=a,c.height=s;const u=c.getContext("2d",{willReadFrequently:!0}),h=u.getImageData(0,0,a,s),m=h.data;for(let d=0;d<s;d++)for(let g=0;g<a;g++){const p=3*d*a+3*g,y=4*d*a+4*g;m[y]=l[p],m[y+1]=l[p+1],m[y+2]=l[p+2],m[y+3]=255}console.debug("imdata: ",h),u.putImageData(h,0,0),e=h}Se[t]=e}return Se[t]},Jr=async t=>t.endsWith(".tif")||t.endsWith(".tiff")?Zr(t):Hr(t),dt=async(t,e)=>{U=[],console.debug("urls:",t),Promise.all(t.map(Jr)).then(r=>{U=r,e(U)})},Qr=(t,e,r,i)=>{const n=r-t,o=i-e;return n*n+o*o},Wr=()=>{let t=L,e=ee,r=e*e;if(e>0&U.length>=3){let i=L.x/f.canvas.width,n=L.y/f.canvas.height,o=U[0],a=Math.floor(o.width*i),s=Math.floor(o.height*n),l=0;for(let c=-e;c<=e;c++){let u=Math.min(o.width,Math.max(0,a+c));for(let h=-e;h<=e;h++){let m=Math.min(o.height,Math.max(0,s+h));if(Qr(a,s,u,m)<=r){const d=m*o.width+u,g=1+U[1]._raw_data[d]-U[0]._raw_data[d];g>l&&(l=g,t={x:u,y:m})}}}}return t},en=()=>{if(!(U.length>0)||!(U[0]?.width>0))return;let t=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,t),rn(f,0,0,U[0].width,U[0].height);let e=f.getAttribLocation(S,"a_position"),r=f.getAttribLocation(S,"a_texCoord"),i=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,i),f.bufferData(f.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),f.STATIC_DRAW);let n=f.getUniformLocation(S,"u_resolution"),o=f.getUniformLocation(S,"u_mouse"),a=f.getUniformLocation(S,"u_mpos"),s=f.getUniformLocation(S,"u_zoom"),l=f.getUniformLocation(S,"u_snap"),c=f.getUniformLocation(S,"u_image0"),u=f.getUniformLocation(S,"u_image1"),h=f.getUniformLocation(S,"u_image2");f.useProgram(S),f.enableVertexAttribArray(e),f.bindBuffer(f.ARRAY_BUFFER,t),f.vertexAttribPointer(e,2,f.FLOAT,!1,0,0),f.enableVertexAttribArray(r),f.bindBuffer(f.ARRAY_BUFFER,i),f.vertexAttribPointer(r,2,f.FLOAT,!1,0,0),Pe||(De=Wr()),f.uniform2f(n,f.canvas.width,f.canvas.height),f.uniform2f(o,L.x,L.y),f.uniform2f(a,De.x,De.y),f.uniform1f(s,R),f.uniform1f(l,ee),f.uniform1i(c,0),f.uniform1i(u,1),f.uniform1i(h,2),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,J[0]),f.activeTexture(f.TEXTURE1),f.bindTexture(f.TEXTURE_2D,J[1]),f.activeTexture(f.TEXTURE2),f.bindTexture(f.TEXTURE_2D,J[2]),f.drawArrays(f.TRIANGLES,0,6),ye&&tn(),f.finish()},Ne=()=>{try{en()}catch(t){console.error(t)}},tn=()=>{let t=0;const e=f.canvas.width,r=f.canvas.height,i=new Uint8Array(e*r*4);f.readPixels(0,0,e,r,f.RGBA,f.UNSIGNED_BYTE,i);for(let n=0;n<r;n++)for(let o=0;o<e;o++){const a=4*n*e+4*o;i[a+2]>=255&&(t+=1)}wt=t},gt=t=>{if(t.length===0){console.error("No Images!");return}let e=document.getElementById("canvas");if(e.style["image-rendering"]="pixelated",f=e.getContext("webgl",{antialias:!1}),!f){console.error("Cannot attach as webgl canvas to the document!");return}const r=["vertex-shader-2d","fragment-shader-2d"],i=[];for(let s=0;s<r.length;++s){let l="",c,u=r[s];const h=document.getElementById(u);if(!h)throw"*** Error: unknown script element"+u;if(l=`
${h.text}`,h.type==="x-shader/x-vertex")c=f.VERTEX_SHADER;else if(h.type==="x-shader/x-fragment")c=f.FRAGMENT_SHADER;else if(c!==f.VERTEX_SHADER&&c!==f.FRAGMENT_SHADER)throw"*** Error: unknown shader type";const d=f.createShader(c);if(f.shaderSource(d,l),f.compileShader(d),!f.getShaderParameter(d,f.COMPILE_STATUS)){const p=f.getShaderInfoLog(d);return console.error("*** Error compiling shader '"+d+"':"+p+`
`+l.split(`
`).map((y,T)=>`${T+1}: ${y}`).join(`
`)),f.deleteShader(d),null}i.push(d)}if(S=f.createProgram(),i.forEach(s=>{f.attachShader(S,s)}),f.linkProgram(S),!f.getProgramParameter(S,f.LINK_STATUS)){const s=f.getProgramInfoLog(S);return console.error("Error in program linking:"+s),f.deleteProgram(S),null}f.useProgram(S),J=[];for(let s=0;s<t.length;++s){let l=f.createTexture();f.bindTexture(f.TEXTURE_2D,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),t[s]?.data?f.texImage2D(f.TEXTURE_2D,0,f.RGBA,t[s].width,t[s].height,0,f.RGBA,f.UNSIGNED_BYTE,t[s].data):f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,t[s]),J.push(l)}let o=t[0].width,a=t[0].height;if(o>=4096||a>4096){alert("texture too large!"),ht(-1);return}f.canvas.width=o,f.canvas.height=a,f.viewport(0,0,f.canvas.width,f.canvas.height),Ne(),ut(R)},rn=(t,e,r,i,n)=>{let o=e,a=e+i,s=r,l=r+n;t.bufferData(t.ARRAY_BUFFER,new Float32Array([o,s,a,s,o,l,o,l,a,s,a,l]),t.STATIC_DRAW)},nn=(t,e)=>{e=e||t.target;const{left:r,top:i}=e.getBoundingClientRect();return{x:t.clientX-r,y:t.clientY-i}},on=(t,e)=>{e=e||t.target;let{x:r,y:i}=nn(t,e);return r=r*e.width/e.clientWidth,i=i*e.height/e.clientHeight,{x:r,y:i}},sn=()=>{let t=!1;return(e=>{(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)})(navigator.userAgent||navigator.vendor||window.opera),t},an=()=>{try{return document.createEvent("TouchEvent"),!0}catch{return!1}};document.querySelector("#canvas").addEventListener("touchstart",t=>{Re++,t.touches.length===1&&Re===1&&t.preventDefault()},{passive:!1});document.querySelector("#canvas").addEventListener("touchend",t=>{Re=0});document.querySelector("#canvas").addEventListener("click",()=>{Pe=!Pe});const cn=t=>{const{x:e,y:r}=on(t),i=mn*50/R;L.x=e,L.y=r-i,console.debug("mousePos",L),Ne(),ye&&xt()};document.querySelector("#canvas").addEventListener("pointermove",cn);window.addEventListener("scroll",we);window.addEventListener("resize",we);const ln=async()=>{C=3,R=Q[C],await dt([Vr,jr,qr],gt)},fn=async()=>{C=0,R=Q[C],await dt([Yr,Xr,$r],gt)},mt=async t=>{t||(t=new URLSearchParams(window.location.search).get("example")),t=="lg"?(window.history.pushState({},document.title,"./?example=lg"),fn()):(window.history.pushState({},document.title,"./"),ln()),we(),me()},yt=t=>{pe=ke.find(e=>e.id===t),Tt=pe.from_sqm,pt(),Ne(),xt()},pt=()=>{Tt?(ye=!0,F.style.display=""):(ye=!1,F.style.display="none")};document.querySelector("#canvas").addEventListener("mouseenter",pt);document.querySelector("#canvas").addEventListener("mouseexit",()=>{F.style.display="none"});const xt=()=>{let t=pe,r=(wt*gn*t.from_sqm).toLocaleString(void 0,{maximumFractionDigits:1}),i=document.getElementById("area_value");i.innerText=`${r} ${t.label}`},un=()=>{let t=document.getElementById("area-units"),e=t.innerHTML;for(const n of ke)e+=`
    <div>
      <input type="radio" id="units-${n.id}" name="units" value="${n.id}" onChange=changeUnits("${n.id}")>
      <label for="units-${n.id}" >${n.label}</label>
    </div>
    `;t.innerHTML=e;let r=pe,i=document.querySelector(`input[id='units-${r.id}']`);i.checked=!0,yt(r.id)},me=()=>{ee=Ce();let t=document.getElementById("snapMode");t.innerHTML=`mode: ${N}</br>radius: ${ee}`},hn=()=>{let t=document.getElementById("cycleSnap");t.classList.add(`mode-${N}`),me(),t.addEventListener("click",()=>{t.classList.remove(`mode-${N}`),zr(),t.classList.add(`mode-${N}`),me()})};window.main=mt;window.adjustZoom=ht;window.changeUnits=yt;var f,S,U=[],J=[],R=1,Q=[.25,.5,1,2,4,8,16],C=2,ve=["zoom","large","none"],dn=40,ge=0,N=ve[ge],ee=Ce(),wt=0,ye=!1,Pe=!1;const gn=100;var Tt=1,Se={},F=document.getElementById("area-summary"),L={x:1e6,y:1e6},De=L;const mn=an()||sn();var Re=0;const ke=[{id:"acres",label:"Acres",from_sqm:1/4046.86},{id:"sqmi",label:"Sq Mi",from_sqm:1/2589988110336e-6},{id:"sqm",label:"Sq M",from_sqm:1},{id:"sqkm",label:"Sq Km",from_sqm:1/1e3},{id:"pixels",label:"Pixels",from_sqm:1/100},{id:"none",label:"None",from_sqm:0}];var pe=ke.at(-1);un();hn();mt();export{yn as L,pn as a,lt as g};
