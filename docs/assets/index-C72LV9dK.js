const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/raw-Dt1HMqYc.js","assets/basedecoder-DvumDe3Y.js","assets/lzw-DpvbRwG5.js","assets/jpeg-CdeCw_eT.js","assets/deflate-CUkHh1nh.js","assets/pako.esm-CPws4d4z.js","assets/packbits-DQnG8s9w.js","assets/lerc-17Al6GDM.js","assets/webimage-BcnuJlio.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function I(r){return(e,...t)=>gt(r,e,t)}function X(r,e){return I(Ge(r,e).get)}const{apply:gt,construct:jr,defineProperty:Yr,get:Xr,getOwnPropertyDescriptor:Ge,getPrototypeOf:me,has:zr,ownKeys:dt,set:qr,setPrototypeOf:$r}=Reflect,{iterator:ie,species:Hr,toStringTag:yt,for:Zr}=Symbol,pt=Object,{create:xe,defineProperty:mt,freeze:Jr,is:Qr}=pt,xt=Array,wt=xt.prototype,Le=wt[ie],Tt=I(Le),Fe=ArrayBuffer,bt=Fe.prototype;X(bt,"byteLength");const Oe=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Oe&&X(Oe.prototype,"byteLength");const Me=me(Uint8Array);Me.from;const P=Me.prototype;P[ie];I(P.keys);I(P.values);I(P.entries);I(P.set);I(P.reverse);I(P.fill);I(P.copyWithin);I(P.sort);I(P.slice);I(P.subarray);X(P,"buffer");X(P,"byteOffset");X(P,"length");X(P,yt);const Et=Uint8Array,Ce=Uint16Array,we=Uint32Array,At=Float32Array,re=me([][ie]()),Ne=I(re.next),St=I(function*(){}().next),Dt=me(re),It=DataView.prototype,_t=I(It.getUint16),Te=WeakMap,ke=Te.prototype,Ve=I(ke.get),vt=I(ke.set),Ke=new Te,Pt=xe(null,{next:{value:function(){const e=Ve(Ke,this);return Ne(e)}},[ie]:{value:function(){return this}}});function Rt(r){if(r[ie]===Le&&re.next===Ne)return r;const e=xe(Pt);return vt(Ke,e,Tt(r)),e}const Ot=new Te,Ut=xe(Dt,{next:{value:function(){const e=Ve(Ot,this);return St(e)},writable:!0,configurable:!0}});for(const r of dt(re))r!=="next"&&mt(Ut,r,Ge(re,r));const je=new Fe(4),Bt=new At(je),Gt=new we(je),U=new Ce(512),B=new Et(512);for(let r=0;r<256;++r){const e=r-127;e<-24?(U[r]=0,U[r|256]=32768,B[r]=24,B[r|256]=24):e<-14?(U[r]=1024>>-e-14,U[r|256]=1024>>-e-14|32768,B[r]=-e-1,B[r|256]=-e-1):e<=15?(U[r]=e+15<<10,U[r|256]=e+15<<10|32768,B[r]=13,B[r|256]=13):e<128?(U[r]=31744,U[r|256]=64512,B[r]=24,B[r|256]=24):(U[r]=31744,U[r|256]=64512,B[r]=13,B[r|256]=13)}const be=new we(2048);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,be[r]=e|t}for(let r=1024;r<2048;++r)be[r]=939524096+(r-1024<<13);const z=new we(64);for(let r=1;r<31;++r)z[r]=r<<23;z[31]=1199570944;z[32]=2147483648;for(let r=33;r<63;++r)z[r]=2147483648+(r-32<<23);z[63]=3347054592;const Ye=new Ce(64);for(let r=1;r<64;++r)r!==32&&(Ye[r]=1024);function Lt(r){const e=r>>10;return Gt[0]=be[Ye[e]+(r&1023)]+z[e],Bt[0]}function Xe(r,e,...t){return Lt(_t(r,e,...Rt(t)))}function ze(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ee={exports:{}};function qe(r,e,t){const n=t&&t.debug||!1;n&&console.log("[xml-utils] getting "+e+" in "+r);const i=typeof r=="object"?r.outer:r,o=i.slice(0,i.indexOf(">")+1),a=['"',"'"];for(let s=0;s<a.length;s++){const c=a[s],f=e+"\\="+c+"([^"+c+"]*)"+c;n&&console.log("[xml-utils] pattern:",f);const h=new RegExp(f).exec(o);if(n&&console.log("[xml-utils] match:",h),h)return h[1]}}Ee.exports=qe;Ee.exports.default=qe;var Ft=Ee.exports;const he=ze(Ft);var Ae={exports:{}},Se={exports:{}},De={exports:{}};function $e(r,e,t){const i=new RegExp(e).exec(r.slice(t));return i?t+i.index:-1}De.exports=$e;De.exports.default=$e;var Mt=De.exports,Ie={exports:{}};function He(r,e,t){const i=new RegExp(e).exec(r.slice(t));return i?t+i.index+i[0].length-1:-1}Ie.exports=He;Ie.exports.default=He;var Ct=Ie.exports,_e={exports:{}};function Ze(r,e){const t=new RegExp(e,"g"),n=r.match(t);return n?n.length:0}_e.exports=Ze;_e.exports.default=Ze;var Nt=_e.exports;const kt=Mt,ue=Ct,Ue=Nt;function Je(r,e,t){const n=t&&t.debug||!1,i=!(t&&typeof t.nested===!1),o=t&&t.startIndex||0;n&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const a=kt(r,`<${e}[ 
>/]`,o);if(n&&console.log("[xml-utils] start:",a),a===-1)return;const s=r.slice(a+e.length);let c=ue(s,"^[^<]*[ /]>",0);const f=c!==-1&&s[c-1]==="/";if(n&&console.log("[xml-utils] selfClosing:",f),f===!1)if(i){let u=0,d=1,m=0;for(;(c=ue(s,"[ /]"+e+">",u))!==-1;){const p=s.substring(u,c+1);if(d+=Ue(p,"<"+e+`[ 
	>]`),m+=Ue(p,"</"+e+">"),m>=d)break;u=c}}else c=ue(s,"[ /]"+e+">",0);const g=a+e.length+c+1;if(n&&console.log("[xml-utils] end:",g),g===-1)return;const h=r.slice(a,g);let y;return f?y=null:y=h.slice(h.indexOf(">")+1,h.lastIndexOf("<")),{inner:y,outer:h,start:a,end:g}}Se.exports=Je;Se.exports.default=Je;var Vt=Se.exports;const Kt=Vt;function Qe(r,e,t){const n=[],i=t&&t.debug||!1,o=t&&typeof t.nested=="boolean"?t.nested:!0;let a=t&&t.startIndex||0,s;for(;s=Kt(r,e,{debug:i,startIndex:a});)o?a=s.start+1+e.length:a=s.end,n.push(s);return i&&console.log("findTagsByName found",n.length,"tags"),n}Ae.exports=Qe;Ae.exports.default=Qe;var jt=Ae.exports;const Yt=ze(jt),Q={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},G={};for(const r in Q)Q.hasOwnProperty(r)&&(G[Q[r]]=parseInt(r,10));const Xt=[G.BitsPerSample,G.ExtraSamples,G.SampleFormat,G.StripByteCounts,G.StripOffsets,G.StripRowCounts,G.TileByteCounts,G.TileOffsets,G.SubIFDs],ge={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},w={};for(const r in ge)ge.hasOwnProperty(r)&&(w[ge[r]]=parseInt(r,10));const R={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},zt={Unspecified:0,Assocalpha:1,Unassalpha:2},Wr={Version:0,AddCompression:1},ei={None:0,Deflate:1,Zstandard:2},qt={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function $t(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3);let o;for(let a=0,s=0;a<r.length;++a,s+=3)o=256-r[a]/e*256,i[s]=o,i[s+1]=o,i[s+2]=o;return i}function Ht(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3);let o;for(let a=0,s=0;a<r.length;++a,s+=3)o=r[a]/e*256,i[s]=o,i[s+1]=o,i[s+2]=o;return i}function Zt(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3),o=e.length/3,a=e.length/3*2;for(let s=0,c=0;s<r.length;++s,c+=3){const f=r[s];i[c]=e[f]/65536*256,i[c+1]=e[f+o]/65536*256,i[c+2]=e[f+a]/65536*256}return i}function Jt(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let i=0,o=0;i<r.length;i+=4,o+=3){const a=r[i],s=r[i+1],c=r[i+2],f=r[i+3];n[o]=255*((255-a)/256)*((255-f)/256),n[o+1]=255*((255-s)/256)*((255-f)/256),n[o+2]=255*((255-c)/256)*((255-f)/256)}return n}function Qt(r){const{width:e,height:t}=r,n=new Uint8ClampedArray(e*t*3);for(let i=0,o=0;i<r.length;i+=3,o+=3){const a=r[i],s=r[i+1],c=r[i+2];n[o]=a+1.402*(c-128),n[o+1]=a-.34414*(s-128)-.71414*(c-128),n[o+2]=a+1.772*(s-128)}return n}const Wt=.95047,er=1,tr=1.08883;function rr(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let i=0,o=0;i<r.length;i+=3,o+=3){const a=r[i+0],s=r[i+1]<<24>>24,c=r[i+2]<<24>>24;let f=(a+16)/116,g=s/500+f,h=f-c/200,y,u,d;g=Wt*(g*g*g>.008856?g*g*g:(g-16/116)/7.787),f=er*(f*f*f>.008856?f*f*f:(f-16/116)/7.787),h=tr*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),y=g*3.2406+f*-1.5372+h*-.4986,u=g*-.9689+f*1.8758+h*.0415,d=g*.0557+f*-.204+h*1.057,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,u=u>.0031308?1.055*u**(1/2.4)-.055:12.92*u,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,n[o]=Math.max(0,Math.min(1,y))*255,n[o+1]=Math.max(0,Math.min(1,u))*255,n[o+2]=Math.max(0,Math.min(1,d))*255}return n}const ir="modulepreload",nr=function(r){return"/demdag-web/"+r},Be={},k=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(t.map(c=>{if(c=nr(c),c in Be)return;Be[c]=!0;const f=c.endsWith(".css"),g=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${g}`))return;const h=document.createElement("link");if(h.rel=f?"stylesheet":ir,f||(h.as="script"),h.crossOrigin="",h.href=c,s&&h.setAttribute("nonce",s),document.head.appendChild(h),f)return new Promise((y,u)=>{h.addEventListener("load",y),h.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return i.then(a=>{for(const s of a||[])s.status==="rejected"&&o(s.reason);return e().catch(o)})},We=new Map;function C(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>We.set(t,e))}async function or(r){const e=We.get(r.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const t=await e();return new t(r)}C([void 0,1],()=>k(()=>import("./raw-Dt1HMqYc.js"),__vite__mapDeps([0,1])).then(r=>r.default));C(5,()=>k(()=>import("./lzw-DpvbRwG5.js"),__vite__mapDeps([2,1])).then(r=>r.default));C(6,()=>{throw new Error("old style JPEG compression is not supported.")});C(7,()=>k(()=>import("./jpeg-CdeCw_eT.js"),__vite__mapDeps([3,1])).then(r=>r.default));C([8,32946],()=>k(()=>import("./deflate-CUkHh1nh.js"),__vite__mapDeps([4,5,1])).then(r=>r.default));C(32773,()=>k(()=>import("./packbits-DQnG8s9w.js"),__vite__mapDeps([6,1])).then(r=>r.default));C(34887,()=>k(()=>import("./lerc-17Al6GDM.js"),__vite__mapDeps([7,5,1])).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));C(50001,()=>k(()=>import("./webimage-BcnuJlio.js"),__vite__mapDeps([8,1])).then(r=>r.default));function le(r,e,t,n=1){return new(Object.getPrototypeOf(r)).constructor(e*t*n)}function sr(r,e,t,n,i){const o=e/n,a=t/i;return r.map(s=>{const c=le(s,n,i);for(let f=0;f<i;++f){const g=Math.min(Math.round(a*f),t-1);for(let h=0;h<n;++h){const y=Math.min(Math.round(o*h),e-1),u=s[g*e+y];c[f*n+h]=u}}return c})}function Y(r,e,t){return(1-t)*r+t*e}function ar(r,e,t,n,i){const o=e/n,a=t/i;return r.map(s=>{const c=le(s,n,i);for(let f=0;f<i;++f){const g=a*f,h=Math.floor(g),y=Math.min(Math.ceil(g),t-1);for(let u=0;u<n;++u){const d=o*u,m=d%1,p=Math.floor(d),T=Math.min(Math.ceil(d),e-1),x=s[h*e+p],b=s[h*e+T],E=s[y*e+p],A=s[y*e+T],S=Y(Y(x,b,m),Y(E,A,m),g%1);c[f*n+u]=S}}return c})}function cr(r,e,t,n,i,o="nearest"){switch(o.toLowerCase()){case"nearest":return sr(r,e,t,n,i);case"bilinear":case"linear":return ar(r,e,t,n,i);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function lr(r,e,t,n,i,o){const a=e/n,s=t/i,c=le(r,n,i,o);for(let f=0;f<i;++f){const g=Math.min(Math.round(s*f),t-1);for(let h=0;h<n;++h){const y=Math.min(Math.round(a*h),e-1);for(let u=0;u<o;++u){const d=r[g*e*o+y*o+u];c[f*n*o+h*o+u]=d}}}return c}function fr(r,e,t,n,i,o){const a=e/n,s=t/i,c=le(r,n,i,o);for(let f=0;f<i;++f){const g=s*f,h=Math.floor(g),y=Math.min(Math.ceil(g),t-1);for(let u=0;u<n;++u){const d=a*u,m=d%1,p=Math.floor(d),T=Math.min(Math.ceil(d),e-1);for(let x=0;x<o;++x){const b=r[h*e*o+p*o+x],E=r[h*e*o+T*o+x],A=r[y*e*o+p*o+x],S=r[y*e*o+T*o+x],N=Y(Y(b,E,m),Y(A,S,m),g%1);c[f*n*o+u*o+x]=N}}}return c}function hr(r,e,t,n,i,o,a="nearest"){switch(a.toLowerCase()){case"nearest":return lr(r,e,t,n,i,o);case"bilinear":case"linear":return fr(r,e,t,n,i,o);default:throw new Error(`Unsupported resampling method: '${a}'`)}}function ur(r,e,t){let n=0;for(let i=e;i<t;++i)n+=r[i];return n}function de(r,e,t){switch(r){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function gr(r,e){return(r===1||r===2)&&e<=32&&e%8===0?!1:!(r===3&&(e===16||e===32||e===64))}function dr(r,e,t,n,i,o,a){const s=new DataView(r),c=t===2?a*o:a*o*n,f=t===2?1:n,g=de(e,i,c),h=parseInt("1".repeat(i),2);if(e===1){let y;t===1?y=n*i:y=i;let u=o*y;u&7&&(u=u+7&-8);for(let d=0;d<a;++d){const m=d*u;for(let p=0;p<o;++p){const T=m+p*f*i;for(let x=0;x<f;++x){const b=T+x*i,E=(d*o+p)*f+x,A=Math.floor(b/8),S=b%8;if(S+i<=8)g[E]=s.getUint8(A)>>8-i-S&h;else if(S+i<=16)g[E]=s.getUint16(A)>>16-i-S&h;else if(S+i<=24){const N=s.getUint16(A)<<8|s.getUint8(A+2);g[E]=N>>24-i-S&h}else g[E]=s.getUint32(A)>>32-i-S&h}}}}return g.buffer}class yr{constructor(e,t,n,i,o,a){this.fileDirectory=e,this.geoKeys=t,this.dataView=n,this.littleEndian=i,this.tiles=o?{}:null,this.isTiled=!e.StripOffsets;const s=e.PlanarConfiguration;if(this.planarConfiguration=typeof s>"u"?1:s,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=a}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,n=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(i,o){return Xe(this,i,o)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const n=this.getSampleFormat(e),i=this.getBitsPerSample(e);return de(n,i,t)}async getTileOrStrip(e,t,n,i,o){const a=Math.ceil(this.getWidth()/this.getTileWidth()),s=Math.ceil(this.getHeight()/this.getTileHeight());let c;const{tiles:f}=this;this.planarConfiguration===1?c=t*a+e:this.planarConfiguration===2&&(c=n*a*s+t*a+e);let g,h;this.isTiled?(g=this.fileDirectory.TileOffsets[c],h=this.fileDirectory.TileByteCounts[c]):(g=this.fileDirectory.StripOffsets[c],h=this.fileDirectory.StripByteCounts[c]);const y=(await this.source.fetch([{offset:g,length:h}],o))[0];let u;return f===null||!f[c]?(u=(async()=>{let d=await i.decode(this.fileDirectory,y);const m=this.getSampleFormat(),p=this.getBitsPerSample();return gr(m,p)&&(d=dr(d,m,this.planarConfiguration,this.getSamplesPerPixel(),p,this.getTileWidth(),this.getBlockHeight(t))),d})(),f!==null&&(f[c]=u)):u=f[c],{x:e,y:t,sample:n,data:await u}}async _readRaster(e,t,n,i,o,a,s,c,f){const g=this.getTileWidth(),h=this.getTileHeight(),y=this.getWidth(),u=this.getHeight(),d=Math.max(Math.floor(e[0]/g),0),m=Math.min(Math.ceil(e[2]/g),Math.ceil(y/g)),p=Math.max(Math.floor(e[1]/h),0),T=Math.min(Math.ceil(e[3]/h),Math.ceil(u/h)),x=e[2]-e[0];let b=this.getBytesPerPixel();const E=[],A=[];for(let D=0;D<t.length;++D)this.planarConfiguration===1?E.push(ur(this.fileDirectory.BitsPerSample,0,t[D])/8):E.push(0),A.push(this.getReaderForSample(t[D]));const S=[],{littleEndian:N}=this;for(let D=p;D<T;++D)for(let V=d;V<m;++V){let K;this.planarConfiguration===1&&(K=this.getTileOrStrip(V,D,0,o,f));for(let L=0;L<t.length;++L){const F=L,oe=t[L];this.planarConfiguration===2&&(b=this.getSampleByteSize(oe),K=this.getTileOrStrip(V,D,oe,o,f));const nt=K.then(q=>{const ot=q.data,st=new DataView(ot),fe=this.getBlockHeight(q.y),$=q.y*h,se=q.x*g,at=$+fe,ct=(q.x+1)*g,lt=A[F],ft=Math.min(fe,fe-(at-e[3]),u-$),ht=Math.min(g,g-(ct-e[2]),y-se);for(let H=Math.max(0,e[1]-$);H<ft;++H)for(let Z=Math.max(0,e[0]-se);Z<ht;++Z){const ut=(H*g+Z)*b,Re=lt.call(st,ut+E[F],N);let ae;i?(ae=(H+$-e[1])*x*t.length+(Z+se-e[0])*t.length+F,n[ae]=Re):(ae=(H+$-e[1])*x+Z+se-e[0],n[F][ae]=Re)}});S.push(nt)}}if(await Promise.all(S),a&&e[2]-e[0]!==a||s&&e[3]-e[1]!==s){let D;return i?D=hr(n,e[2]-e[0],e[3]-e[1],a,s,t.length,c):D=cr(n,e[2]-e[0],e[3]-e[1],a,s,c),D.width=a,D.height=s,D}return n.width=a||e[2]-e[0],n.height=s||e[3]-e[1],n}async readRasters({window:e,samples:t=[],interleave:n,pool:i=null,width:o,height:a,resampleMethod:s,fillValue:c,signal:f}={}){const g=e||[0,0,this.getWidth(),this.getHeight()];if(g[0]>g[2]||g[1]>g[3])throw new Error("Invalid subsets");const h=g[2]-g[0],y=g[3]-g[1],u=h*y,d=this.getSamplesPerPixel();if(!t||!t.length)for(let x=0;x<d;++x)t.push(x);else for(let x=0;x<t.length;++x)if(t[x]>=d)return Promise.reject(new RangeError(`Invalid sample index '${t[x]}'.`));let m;if(n){const x=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,b=Math.max.apply(null,this.fileDirectory.BitsPerSample);m=de(x,b,u*t.length),c&&m.fill(c)}else{m=[];for(let x=0;x<t.length;++x){const b=this.getArrayForSample(t[x],u);Array.isArray(c)&&x<c.length?b.fill(c[x]):c&&!Array.isArray(c)&&b.fill(c),m.push(b)}}const p=i||await or(this.fileDirectory);return await this._readRaster(g,t,m,n,p,o,a,s,f)}async readRGB({window:e,interleave:t=!0,pool:n=null,width:i,height:o,resampleMethod:a,enableAlpha:s=!1,signal:c}={}){const f=e||[0,0,this.getWidth(),this.getHeight()];if(f[0]>f[2]||f[1]>f[3])throw new Error("Invalid subsets");const g=this.fileDirectory.PhotometricInterpretation;if(g===R.RGB){let T=[0,1,2];if(this.fileDirectory.ExtraSamples!==zt.Unspecified&&s){T=[];for(let x=0;x<this.fileDirectory.BitsPerSample.length;x+=1)T.push(x)}return this.readRasters({window:e,interleave:t,samples:T,pool:n,width:i,height:o,resampleMethod:a,signal:c})}let h;switch(g){case R.WhiteIsZero:case R.BlackIsZero:case R.Palette:h=[0];break;case R.CMYK:h=[0,1,2,3];break;case R.YCbCr:case R.CIELab:h=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const y={window:f,interleave:!0,samples:h,pool:n,width:i,height:o,resampleMethod:a,signal:c},{fileDirectory:u}=this,d=await this.readRasters(y),m=2**this.fileDirectory.BitsPerSample[0];let p;switch(g){case R.WhiteIsZero:p=$t(d,m);break;case R.BlackIsZero:p=Ht(d,m);break;case R.Palette:p=Zt(d,u.ColorMap);break;case R.CMYK:p=Jt(d);break;case R.YCbCr:p=Qt(d);break;case R.CIELab:p=rr(d);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const T=new Uint8Array(p.length/3),x=new Uint8Array(p.length/3),b=new Uint8Array(p.length/3);for(let E=0,A=0;E<p.length;E+=3,++A)T[A]=p[E],x[A]=p[E+1],b[A]=p[E+2];p=[T,x,b]}return p.width=d.width,p.height=d.height,p}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let i=Yt(n,"Item");e===null?i=i.filter(o=>he(o,"sample")===void 0):i=i.filter(o=>Number(he(o,"sample"))===e);for(let o=0;o<i.length;++o){const a=i[o];t[he(a,"name")]=a.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(n)return n[1]===0&&n[4]===0?[n[0],-n[5],n[10]]:[Math.sqrt(n[0]*n[0]+n[4]*n[4]),-Math.sqrt(n[1]*n[1]+n[5]*n[5]),n[10]];if(e){const[i,o,a]=e.getResolution();return[i*e.getWidth()/this.getWidth(),o*e.getHeight()/this.getHeight(),a*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),n=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[i,o,a,s,c,f,g,h]=this.fileDirectory.ModelTransformation,u=[[0,0],[0,t],[n,0],[n,t]].map(([p,T])=>[s+i*p+o*T,h+c*p+f*T]),d=u.map(p=>p[0]),m=u.map(p=>p[1]);return[Math.min(...d),Math.min(...m),Math.max(...d),Math.max(...m)]}else{const i=this.getOrigin(),o=this.getResolution(),a=i[0],s=i[1],c=a+o[0]*n,f=s+o[1]*t;return[Math.min(a,c),Math.min(s,f),Math.max(a,c),Math.max(s,f)]}}}class pr{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const n=this.getUint32(e,t),i=this.getUint32(e+4,t);let o;if(t){if(o=n+2**32*i,!Number.isSafeInteger(o))throw new Error(`${o} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return o}if(o=2**32*n+i,!Number.isSafeInteger(o))throw new Error(`${o} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return o}getInt64(e,t){let n=0;const i=(this._dataView.getUint8(e+(t?7:0))&128)>0;let o=!0;for(let a=0;a<8;a++){let s=this._dataView.getUint8(e+(t?a:7-a));i&&(o?s!==0&&(s=~(s-1)&255,o=!1):s=~s&255),n+=s*256**a}return i&&(n=-n),n}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return Xe(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class mr{constructor(e,t,n,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=n,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),n=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const n=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(this._littleEndian?o:7-o));n&&(i?a!==0&&(a=~(a-1)&255,i=!1):a=~a&255),t+=a*256**o}return n&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}class xr{async fetch(e,t=void 0){return Promise.all(e.map(n=>this.fetchSlice(n,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class ve extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,ve),this.name="AbortError"}}class wr extends xr{constructor(e){super(),this.arrayBuffer=e}fetchSlice(e,t){if(t&&t.aborted)throw new ve("Request aborted");return this.arrayBuffer.slice(e.offset,e.offset+e.length)}}function Tr(r){return new wr(r)}function ye(r){switch(r){case w.BYTE:case w.ASCII:case w.SBYTE:case w.UNDEFINED:return 1;case w.SHORT:case w.SSHORT:return 2;case w.LONG:case w.SLONG:case w.FLOAT:case w.IFD:return 4;case w.RATIONAL:case w.SRATIONAL:case w.DOUBLE:case w.LONG8:case w.SLONG8:case w.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function br(r){const e=r.GeoKeyDirectory;if(!e)return null;const t={};for(let n=4;n<=e[3]*4;n+=4){const i=qt[e[n]],o=e[n+1]?Q[e[n+1]]:null,a=e[n+2],s=e[n+3];let c=null;if(!o)c=s;else{if(c=r[o],typeof c>"u"||c===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof c=="string"?c=c.substring(s,s+a-1):c.subarray&&(c=c.subarray(s,s+a),a===1&&(c=c[0]))}t[i]=c}return t}function j(r,e,t,n){let i=null,o=null;const a=ye(e);switch(e){case w.BYTE:case w.ASCII:case w.UNDEFINED:i=new Uint8Array(t),o=r.readUint8;break;case w.SBYTE:i=new Int8Array(t),o=r.readInt8;break;case w.SHORT:i=new Uint16Array(t),o=r.readUint16;break;case w.SSHORT:i=new Int16Array(t),o=r.readInt16;break;case w.LONG:case w.IFD:i=new Uint32Array(t),o=r.readUint32;break;case w.SLONG:i=new Int32Array(t),o=r.readInt32;break;case w.LONG8:case w.IFD8:i=new Array(t),o=r.readUint64;break;case w.SLONG8:i=new Array(t),o=r.readInt64;break;case w.RATIONAL:i=new Uint32Array(t*2),o=r.readUint32;break;case w.SRATIONAL:i=new Int32Array(t*2),o=r.readInt32;break;case w.FLOAT:i=new Float32Array(t),o=r.readFloat32;break;case w.DOUBLE:i=new Float64Array(t),o=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===w.RATIONAL||e===w.SRATIONAL)for(let s=0;s<t;s+=2)i[s]=o.call(r,n+s*a),i[s+1]=o.call(r,n+(s*a+4));else for(let s=0;s<t;++s)i[s]=o.call(r,n+s*a);return e===w.ASCII?new TextDecoder("utf-8").decode(i):i}class Er{constructor(e,t,n){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=n}}class ce extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Ar{async readRasters(e={}){const{window:t,width:n,height:i}=e;let{resX:o,resY:a,bbox:s}=e;const c=await this.getImage();let f=c;const g=await this.getImageCount(),h=c.getBoundingBox();if(t&&s)throw new Error('Both "bbox" and "window" passed.');if(n||i){if(t){const[d,m]=c.getOrigin(),[p,T]=c.getResolution();s=[d+t[0]*p,m+t[1]*T,d+t[2]*p,m+t[3]*T]}const u=s||h;if(n){if(o)throw new Error("Both width and resX passed");o=(u[2]-u[0])/n}if(i){if(a)throw new Error("Both width and resY passed");a=(u[3]-u[1])/i}}if(o||a){const u=[];for(let d=0;d<g;++d){const m=await this.getImage(d),{SubfileType:p,NewSubfileType:T}=m.fileDirectory;(d===0||p===2||T&1)&&u.push(m)}u.sort((d,m)=>d.getWidth()-m.getWidth());for(let d=0;d<u.length;++d){const m=u[d],p=(h[2]-h[0])/m.getWidth(),T=(h[3]-h[1])/m.getHeight();if(f=m,o&&o>p||a&&a>T)break}}let y=t;if(s){const[u,d]=c.getOrigin(),[m,p]=f.getResolution(c);y=[Math.round((s[0]-u)/m),Math.round((s[1]-d)/p),Math.round((s[2]-u)/m),Math.round((s[3]-d)/p)],y=[Math.min(y[0],y[2]),Math.min(y[1],y[3]),Math.max(y[0],y[2]),Math.max(y[1],y[3])]}return f.readRasters({...e,window:y})}}class Pe extends Ar{constructor(e,t,n,i,o={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=n,this.firstIFDOffset=i,this.cache=o.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const n=this.bigTiff?4048:1024;return new mr((await this.source.fetch([{offset:e,length:typeof t<"u"?t:n}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,n=this.bigTiff?8:2;let i=await this.getSlice(e);const o=this.bigTiff?i.readUint64(e):i.readUint16(e),a=o*t+(this.bigTiff?16:6);i.covers(e,a)||(i=await this.getSlice(e,a));const s={};let c=e+(this.bigTiff?8:2);for(let h=0;h<o;c+=t,++h){const y=i.readUint16(c),u=i.readUint16(c+2),d=this.bigTiff?i.readUint64(c+4):i.readUint32(c+4);let m,p;const T=ye(u),x=c+(this.bigTiff?12:8);if(T*d<=(this.bigTiff?8:4))m=j(i,u,d,x);else{const b=i.readOffset(x),E=ye(u)*d;if(i.covers(b,E))m=j(i,u,d,b);else{const A=await this.getSlice(b,E);m=j(A,u,d,b)}}d===1&&Xt.indexOf(y)===-1&&!(u===w.RATIONAL||u===w.SRATIONAL)?p=m[0]:p=m,s[Q[y]]=p}const f=br(s),g=i.readOffset(e+n+t*o);return new Er(s,f,g)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof ce?new ce(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new ce(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new yr(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(n){if(n instanceof ce)t=!1;else throw n}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",n=t.length+100;let i=await this.getSlice(e,n);if(t===j(i,w.ASCII,t.length,e)){const a=j(i,w.ASCII,n,e).split(`
`)[0],s=Number(a.split("=")[1].split(" ")[0])+a.length;s>n&&(i=await this.getSlice(e,s));const c=j(i,w.ASCII,s,e);this.ghostValues={},c.split(`
`).filter(f=>f.length>0).map(f=>f.split("=")).forEach(([f,g])=>{this.ghostValues[f]=g})}return this.ghostValues}static async fromSource(e,t,n){const i=(await e.fetch([{offset:0,length:1024}],n))[0],o=new pr(i),a=o.getUint16(0,0);let s;if(a===18761)s=!0;else if(a===19789)s=!1;else throw new TypeError("Invalid byte order value.");const c=o.getUint16(2,s);let f;if(c===42)f=!1;else if(c===43){if(f=!0,o.getUint16(4,s)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const g=f?o.getUint64(8,s):o.getUint32(4,s);return new Pe(e,s,f,g,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function Sr(r,e){return Pe.fromSource(Tr(r),e)}const Dr="/demdag-web/assets/d8_discovery-DIlOFSey.tif",Ir="/demdag-web/assets/d8_finish-Bx5Xn6p1.tif",_r="/demdag-web/assets/d8_bg-CjKuwq6_.jpg",vr="/demdag-web/assets/helens_fdr_discovery-DxiLFFLb.tif",Pr="/demdag-web/assets/helens_fdr_finish-JytjPmE5.tif",Rr="/demdag-web/assets/helens_bg-Bc-HqWEv.jpg";var O=[],v=1,l,_,W=[],ee=[.25,.5,1,2,4,8,16],M=2;function Or(){v=1,M=2,console.debug("zoom: ",v),ne()}function et(r){let e=M+r;e<0&&(e=0),e>=ee.length&&(e=ee.length-1),M=e,v=ee[M],console.debug("zoom: ",v),ne()}function Ur(r,e){const t=new Image;return t.crossOrigin="Anonymous",t.src=r,t.onload=e,t}let J={};async function Br(r){if(!(J!=null&&J[r])){let e;console.debug("fetching:",r);const n=await(await fetch(r)).arrayBuffer(),o=await(await Sr(n)).getImage(),a=o.getWidth(),s=o.getHeight();if(r.includes("_discovery")||r.includes("_finish")){const c=await o.readRasters(),f=new Uint8ClampedArray(c[0].length*4);for(let h=0;h<s;h++)for(let y=0;y<a;y++){const u=h*a+y,d=4*h*a+4*y,m=c[0][u];f[d]=m&255,f[d+1]=m>>8&255,f[d+2]=m>>16&255,f[d+3]=m>>24&255}const g={data:f,width:a,height:s};console.debug("data: ",g,r),e=g}else{const c=await o.readRGB(),f=document.createElement("canvas");f.width=a,f.height=s;const g=f.getContext("2d",{willReadFrequently:!0}),h=g.getImageData(0,0,a,s),y=h.data;for(let u=0;u<s;u++)for(let d=0;d<a;d++){const m=3*u*a+3*d,p=4*u*a+4*d;y[p]=c[m],y[p+1]=c[m+1],y[p+2]=c[m+2],y[p+3]=255}console.debug("imdata: ",h),g.putImageData(h,0,0),e=h}J[r]=e}return J[r]}async function tt(r,e){var t=r.length;O=[];var n=function(){--t,console.debug("loaded img."),t===0&&(console.debug("images:",O),e(O))};console.debug("urls:",r);for(var i=0;i<r.length;++i){const o=r[i];console.debug("loading: ",o);let a;o.endsWith(".tif")||o.endsWith(".tiff")?(a=await Br(o),O.push(a),n()):(a=await Ur(o,n),O.push(a))}}function ne(){try{Gr()}catch(r){console.error(r)}}function Gr(){var K;if(!(O.length>0)||!(((K=O[0])==null?void 0:K.width)>0))return;var r=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,r),Lr(l,0,0,O[0].width,O[0].height);let e=O[0].width*v,t=O[0].height*v;if(e>=4096||t>4096){alert("texture too large!"),et(-1);return}l.canvas.width=e,l.canvas.height=t;var n=l.getAttribLocation(_,"a_position"),i=l.getAttribLocation(_,"a_texCoord"),o=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,o),l.bufferData(l.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),l.STATIC_DRAW);var a=l.getUniformLocation(_,"u_resolution"),s=l.getUniformLocation(_,"u_mouse"),c=l.getUniformLocation(_,"u_zoom"),f=l.getUniformLocation(_,"u_image0"),g=l.getUniformLocation(_,"u_image1"),h=l.getUniformLocation(_,"u_image2");l.viewport(0,0,l.canvas.width,l.canvas.height),l.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT),l.useProgram(_),l.enableVertexAttribArray(n),l.bindBuffer(l.ARRAY_BUFFER,r);var y=2,u=l.FLOAT,d=!1,m=0,p=0;l.vertexAttribPointer(n,y,u,d,m,p),l.enableVertexAttribArray(i),l.bindBuffer(l.ARRAY_BUFFER,o);var y=2,u=l.FLOAT,d=!1,m=0,p=0;l.vertexAttribPointer(i,y,u,d,m,p),l.uniform2f(a,l.canvas.width/v,l.canvas.height/v),l.uniform2f(s,te.x/v,te.y/v),l.uniform1f(c,v),l.uniform1i(f,0),l.uniform1i(g,1),l.uniform1i(h,2),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,W[0]),l.activeTexture(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,W[1]),l.activeTexture(l.TEXTURE2),l.bindTexture(l.TEXTURE_2D,W[2]),l.drawArrays(l.TRIANGLES,0,6);let T=l.canvas.width,x=l.canvas.height;const b=new Uint8Array(T*x*4);l.readPixels(0,0,T,x,l.RGBA,l.UNSIGNED_BYTE,b);let E=0;for(let L=0;L<x;L++)for(let F=0;F<T;F++){const oe=4*L*T+4*F;b[oe+2]>=255&&(E+=1)}let S=Math.floor(E/(v*v))*10*10,N=document.getElementById("area_sqm");N.innerText=S.toLocaleString();let D=S/4046.86,V=document.getElementById("area_acres");V.innerText=D.toLocaleString()}function rt(r){var s;if(r.length===0){console.error("No Images!");return}var e=document.querySelector("#canvas");if(l=e.getContext("webgl"),!l){console.error("Cannot attach as webgl canvas to the document!");return}const t=["vertex-shader-2d","fragment-shader-2d"],n=[];for(let c=0;c<t.length;++c){let f="",g,h=t[c];const y=document.getElementById(h);if(!y)throw"*** Error: unknown script element"+h;if(f=y.text,y.type==="x-shader/x-vertex")g=l.VERTEX_SHADER;else if(y.type==="x-shader/x-fragment")g=l.FRAGMENT_SHADER;else if(g!==l.VERTEX_SHADER&&g!==l.FRAGMENT_SHADER)throw"*** Error: unknown shader type";const u=l.createShader(g);if(l.shaderSource(u,f),l.compileShader(u),!l.getShaderParameter(u,l.COMPILE_STATUS)){const m=l.getShaderInfoLog(u);return console.error("*** Error compiling shader '"+u+"':"+m+`
`+f.split(`
`).map((p,T)=>`${T+1}: ${p}`).join(`
`)),l.deleteShader(u),null}n.push(u)}if(_=l.createProgram(),n.forEach(function(c){l.attachShader(_,c)}),l.linkProgram(_),!l.getProgramParameter(_,l.LINK_STATUS)){const c=l.getProgramInfoLog(_);return errFn("Error in program linking:"+c),l.deleteProgram(_),null}l.useProgram(_),W=[];for(var o=0;o<r.length;++o){var a=l.createTexture();l.bindTexture(l.TEXTURE_2D,a),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),(s=r[o])!=null&&s.data?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,r[o].width,r[o].height,0,l.RGBA,l.UNSIGNED_BYTE,r[o].data):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,r[o]),W.push(a)}ne()}function Lr(r,e,t,n,i){var o=e,a=e+n,s=t,c=t+i;r.bufferData(r.ARRAY_BUFFER,new Float32Array([o,s,a,s,o,c,o,c,a,s,a,c]),r.STATIC_DRAW)}var te={x:1e6,y:1e6};function Fr(r,e){e=e||r.target;var t=e.getBoundingClientRect();return{x:r.clientX-t.left,y:r.clientY-t.top}}function Mr(r,e){var t;return function(n){t||(t=setTimeout(()=>(r(n),t=void 0),e))}}function Cr(r,e){e=e||r.target;var t=Fr(r,e);return t.x=t.x*e.width/e.clientWidth,t.y=t.y*e.height/e.clientHeight,t}const Nr=function(){let r=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(r=!0)}(navigator.userAgent||navigator.vendor||window.opera),r},kr=Nr();let pe=0;document.querySelector("#canvas").addEventListener("touchstart",function(r){pe++,r.touches.length===1&&pe===1&&r.preventDefault()},{passive:!1});document.querySelector("#canvas").addEventListener("touchend",function(r){pe=0});const Vr=r=>{const e=Cr(r);te.x=e.x,te.y=e.y-kr*40,console.debug("mousePos",te),ne()};document.querySelector("#canvas").addEventListener("pointermove",Mr(Vr,16));document.addEventListener("resize",ne);async function it(){M=3,v=ee[M],await tt([Dr,Ir,_r],rt)}async function Kr(){M=2,v=ee[M],await tt([vr,Pr,Rr],rt)}window.main=it;window.mainLG=Kr;window.adjustZoom=et;window.resetZoom=Or;it();export{Wr as L,ei as a,ze as g};
