const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/raw-Dt1HMqYc.js","assets/basedecoder-DvumDe3Y.js","assets/lzw-DpvbRwG5.js","assets/jpeg-CdeCw_eT.js","assets/deflate-CUkHh1nh.js","assets/pako.esm-CPws4d4z.js","assets/packbits-DQnG8s9w.js","assets/lerc-B7wnwJtX.js","assets/webimage-BcnuJlio.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();function I(t){return(e,...r)=>wt(t,e,r)}function V(t,e){return I(Fe(t,e).get)}const{apply:wt,construct:en,defineProperty:tn,get:rn,getOwnPropertyDescriptor:Fe,getPrototypeOf:pe,has:nn,ownKeys:Tt,set:on,setPrototypeOf:sn}=Reflect,{iterator:W,species:an,toStringTag:bt,for:cn}=Symbol,Et=Object,{create:xe,defineProperty:At,freeze:ln,is:fn}=Et,St=Array,Dt=St.prototype,Ce=Dt[W],It=I(Ce),Ne=ArrayBuffer,_t=Ne.prototype;V(_t,"byteLength");const Be=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Be&&V(Be.prototype,"byteLength");const ke=pe(Uint8Array);ke.from;const P=ke.prototype;P[W];I(P.keys);I(P.values);I(P.entries);I(P.set);I(P.reverse);I(P.fill);I(P.copyWithin);I(P.sort);I(P.slice);I(P.subarray);V(P,"buffer");V(P,"byteOffset");V(P,"length");V(P,bt);const vt=Uint8Array,Ve=Uint16Array,we=Uint32Array,Pt=Float32Array,Q=pe([][W]()),Ke=I(Q.next),Rt=I(function*(){}().next),Ot=pe(Q),Ut=DataView.prototype,Bt=I(Ut.getUint16),Te=WeakMap,je=Te.prototype,qe=I(je.get),Gt=I(je.set),Ye=new Te,Lt=xe(null,{next:{value:function(){const e=qe(Ye,this);return Ke(e)}},[W]:{value:function(){return this}}});function Mt(t){if(t[W]===Ce&&Q.next===Ke)return t;const e=xe(Lt);return Gt(Ye,e,It(t)),e}const Ft=new Te,Ct=xe(Ot,{next:{value:function(){const e=qe(Ft,this);return Rt(e)},writable:!0,configurable:!0}});for(const t of Tt(Q))t!=="next"&&At(Ct,t,Fe(Q,t));const Xe=new Ne(4),Nt=new Pt(Xe),kt=new we(Xe),U=new Ve(512),B=new vt(512);for(let t=0;t<256;++t){const e=t-127;e<-24?(U[t]=0,U[t|256]=32768,B[t]=24,B[t|256]=24):e<-14?(U[t]=1024>>-e-14,U[t|256]=1024>>-e-14|32768,B[t]=-e-1,B[t|256]=-e-1):e<=15?(U[t]=e+15<<10,U[t|256]=e+15<<10|32768,B[t]=13,B[t|256]=13):e<128?(U[t]=31744,U[t|256]=64512,B[t]=24,B[t|256]=24):(U[t]=31744,U[t|256]=64512,B[t]=13,B[t|256]=13)}const be=new we(2048);for(let t=1;t<1024;++t){let e=t<<13,r=0;for(;!(e&8388608);)e<<=1,r-=8388608;e&=-8388609,r+=947912704,be[t]=e|r}for(let t=1024;t<2048;++t)be[t]=939524096+(t-1024<<13);const K=new we(64);for(let t=1;t<31;++t)K[t]=t<<23;K[31]=1199570944;K[32]=2147483648;for(let t=33;t<63;++t)K[t]=2147483648+(t-32<<23);K[63]=3347054592;const ze=new Ve(64);for(let t=1;t<64;++t)t!==32&&(ze[t]=1024);function Vt(t){const e=t>>10;return kt[0]=be[ze[e]+(t&1023)]+K[e],Nt[0]}function $e(t,e,...r){return Vt(Bt(t,e,...Mt(r)))}function He(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ee={exports:{}};function Ze(t,e,r){const i=r&&r.debug||!1;i&&console.log("[xml-utils] getting "+e+" in "+t);const n=typeof t=="object"?t.outer:t,o=n.slice(0,n.indexOf(">")+1),a=['"',"'"];for(let s=0;s<a.length;s++){const c=a[s],f=e+"\\="+c+"([^"+c+"]*)"+c;i&&console.log("[xml-utils] pattern:",f);const u=new RegExp(f).exec(o);if(i&&console.log("[xml-utils] match:",u),u)return u[1]}}Ee.exports=Ze;Ee.exports.default=Ze;var Kt=Ee.exports;const fe=He(Kt);var Ae={exports:{}},Se={exports:{}},De={exports:{}};function Je(t,e,r){const n=new RegExp(e).exec(t.slice(r));return n?r+n.index:-1}De.exports=Je;De.exports.default=Je;var jt=De.exports,Ie={exports:{}};function Qe(t,e,r){const n=new RegExp(e).exec(t.slice(r));return n?r+n.index+n[0].length-1:-1}Ie.exports=Qe;Ie.exports.default=Qe;var qt=Ie.exports,_e={exports:{}};function We(t,e){const r=new RegExp(e,"g"),i=t.match(r);return i?i.length:0}_e.exports=We;_e.exports.default=We;var Yt=_e.exports;const Xt=jt,ue=qt,Ge=Yt;function et(t,e,r){const i=r&&r.debug||!1,n=!(r&&typeof r.nested===!1),o=r&&r.startIndex||0;i&&console.log("[xml-utils] starting findTagByName with",e," and ",r);const a=Xt(t,`<${e}[ 
>/]`,o);if(i&&console.log("[xml-utils] start:",a),a===-1)return;const s=t.slice(a+e.length);let c=ue(s,"^[^<]*[ /]>",0);const f=c!==-1&&s[c-1]==="/";if(i&&console.log("[xml-utils] selfClosing:",f),f===!1)if(n){let h=0,g=1,p=0;for(;(c=ue(s,"[ /]"+e+">",h))!==-1;){const m=s.substring(h,c+1);if(g+=Ge(m,"<"+e+`[ 
	>]`),p+=Ge(m,"</"+e+">"),p>=g)break;h=c}}else c=ue(s,"[ /]"+e+">",0);const d=a+e.length+c+1;if(i&&console.log("[xml-utils] end:",d),d===-1)return;const u=t.slice(a,d);let y;return f?y=null:y=u.slice(u.indexOf(">")+1,u.lastIndexOf("<")),{inner:y,outer:u,start:a,end:d}}Se.exports=et;Se.exports.default=et;var zt=Se.exports;const $t=zt;function tt(t,e,r){const i=[],n=r&&r.debug||!1,o=r&&typeof r.nested=="boolean"?r.nested:!0;let a=r&&r.startIndex||0,s;for(;s=$t(t,e,{debug:n,startIndex:a});)o?a=s.start+1+e.length:a=s.end,i.push(s);return n&&console.log("findTagsByName found",i.length,"tags"),i}Ae.exports=tt;Ae.exports.default=tt;var Ht=Ae.exports;const Zt=He(Ht),$={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},G={};for(const t in $)$.hasOwnProperty(t)&&(G[$[t]]=parseInt(t,10));const Jt=[G.BitsPerSample,G.ExtraSamples,G.SampleFormat,G.StripByteCounts,G.StripOffsets,G.StripRowCounts,G.TileByteCounts,G.TileOffsets,G.SubIFDs],he={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},w={};for(const t in he)he.hasOwnProperty(t)&&(w[he[t]]=parseInt(t,10));const R={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},Qt={Unspecified:0,Assocalpha:1,Unassalpha:2},un={Version:0,AddCompression:1},hn={None:0,Deflate:1,Zstandard:2},Wt={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function er(t,e){const{width:r,height:i}=t,n=new Uint8Array(r*i*3);let o;for(let a=0,s=0;a<t.length;++a,s+=3)o=256-t[a]/e*256,n[s]=o,n[s+1]=o,n[s+2]=o;return n}function tr(t,e){const{width:r,height:i}=t,n=new Uint8Array(r*i*3);let o;for(let a=0,s=0;a<t.length;++a,s+=3)o=t[a]/e*256,n[s]=o,n[s+1]=o,n[s+2]=o;return n}function rr(t,e){const{width:r,height:i}=t,n=new Uint8Array(r*i*3),o=e.length/3,a=e.length/3*2;for(let s=0,c=0;s<t.length;++s,c+=3){const f=t[s];n[c]=e[f]/65536*256,n[c+1]=e[f+o]/65536*256,n[c+2]=e[f+a]/65536*256}return n}function nr(t){const{width:e,height:r}=t,i=new Uint8Array(e*r*3);for(let n=0,o=0;n<t.length;n+=4,o+=3){const a=t[n],s=t[n+1],c=t[n+2],f=t[n+3];i[o]=255*((255-a)/256)*((255-f)/256),i[o+1]=255*((255-s)/256)*((255-f)/256),i[o+2]=255*((255-c)/256)*((255-f)/256)}return i}function ir(t){const{width:e,height:r}=t,i=new Uint8ClampedArray(e*r*3);for(let n=0,o=0;n<t.length;n+=3,o+=3){const a=t[n],s=t[n+1],c=t[n+2];i[o]=a+1.402*(c-128),i[o+1]=a-.34414*(s-128)-.71414*(c-128),i[o+2]=a+1.772*(s-128)}return i}const or=.95047,sr=1,ar=1.08883;function cr(t){const{width:e,height:r}=t,i=new Uint8Array(e*r*3);for(let n=0,o=0;n<t.length;n+=3,o+=3){const a=t[n+0],s=t[n+1]<<24>>24,c=t[n+2]<<24>>24;let f=(a+16)/116,d=s/500+f,u=f-c/200,y,h,g;d=or*(d*d*d>.008856?d*d*d:(d-16/116)/7.787),f=sr*(f*f*f>.008856?f*f*f:(f-16/116)/7.787),u=ar*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),y=d*3.2406+f*-1.5372+u*-.4986,h=d*-.9689+f*1.8758+u*.0415,g=d*.0557+f*-.204+u*1.057,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,i[o]=Math.max(0,Math.min(1,y))*255,i[o+1]=Math.max(0,Math.min(1,h))*255,i[o+2]=Math.max(0,Math.min(1,g))*255}return i}const lr="modulepreload",fr=function(t){return"/demdag-web/"+t},Le={},C=function(e,r,i){let n=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(r.map(c=>{if(c=fr(c),c in Le)return;Le[c]=!0;const f=c.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":lr,f||(u.as="script"),u.crossOrigin="",u.href=c,s&&u.setAttribute("nonce",s),document.head.appendChild(u),f)return new Promise((y,h)=>{u.addEventListener("load",y),u.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return n.then(a=>{for(const s of a||[])s.status==="rejected"&&o(s.reason);return e().catch(o)})},rt=new Map;function F(t,e){Array.isArray(t)||(t=[t]),t.forEach(r=>rt.set(r,e))}async function ur(t){const e=rt.get(t.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${t.Compression}`);const r=await e();return new r(t)}F([void 0,1],()=>C(()=>import("./raw-Dt1HMqYc.js"),__vite__mapDeps([0,1])).then(t=>t.default));F(5,()=>C(()=>import("./lzw-DpvbRwG5.js"),__vite__mapDeps([2,1])).then(t=>t.default));F(6,()=>{throw new Error("old style JPEG compression is not supported.")});F(7,()=>C(()=>import("./jpeg-CdeCw_eT.js"),__vite__mapDeps([3,1])).then(t=>t.default));F([8,32946],()=>C(()=>import("./deflate-CUkHh1nh.js"),__vite__mapDeps([4,5,1])).then(t=>t.default));F(32773,()=>C(()=>import("./packbits-DQnG8s9w.js"),__vite__mapDeps([6,1])).then(t=>t.default));F(34887,()=>C(()=>import("./lerc-B7wnwJtX.js"),__vite__mapDeps([7,5,1])).then(async t=>(await t.zstd.init(),t)).then(t=>t.default));F(50001,()=>C(()=>import("./webimage-BcnuJlio.js"),__vite__mapDeps([8,1])).then(t=>t.default));function ae(t,e,r,i=1){return new(Object.getPrototypeOf(t)).constructor(e*r*i)}function hr(t,e,r,i,n){const o=e/i,a=r/n;return t.map(s=>{const c=ae(s,i,n);for(let f=0;f<n;++f){const d=Math.min(Math.round(a*f),r-1);for(let u=0;u<i;++u){const y=Math.min(Math.round(o*u),e-1),h=s[d*e+y];c[f*i+u]=h}}return c})}function k(t,e,r){return(1-r)*t+r*e}function dr(t,e,r,i,n){const o=e/i,a=r/n;return t.map(s=>{const c=ae(s,i,n);for(let f=0;f<n;++f){const d=a*f,u=Math.floor(d),y=Math.min(Math.ceil(d),r-1);for(let h=0;h<i;++h){const g=o*h,p=g%1,m=Math.floor(g),T=Math.min(Math.ceil(g),e-1),x=s[u*e+m],b=s[u*e+T],E=s[y*e+m],A=s[y*e+T],S=k(k(x,b,p),k(E,A,p),d%1);c[f*i+h]=S}}return c})}function gr(t,e,r,i,n,o="nearest"){switch(o.toLowerCase()){case"nearest":return hr(t,e,r,i,n);case"bilinear":case"linear":return dr(t,e,r,i,n);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function yr(t,e,r,i,n,o){const a=e/i,s=r/n,c=ae(t,i,n,o);for(let f=0;f<n;++f){const d=Math.min(Math.round(s*f),r-1);for(let u=0;u<i;++u){const y=Math.min(Math.round(a*u),e-1);for(let h=0;h<o;++h){const g=t[d*e*o+y*o+h];c[f*i*o+u*o+h]=g}}}return c}function mr(t,e,r,i,n,o){const a=e/i,s=r/n,c=ae(t,i,n,o);for(let f=0;f<n;++f){const d=s*f,u=Math.floor(d),y=Math.min(Math.ceil(d),r-1);for(let h=0;h<i;++h){const g=a*h,p=g%1,m=Math.floor(g),T=Math.min(Math.ceil(g),e-1);for(let x=0;x<o;++x){const b=t[u*e*o+m*o+x],E=t[u*e*o+T*o+x],A=t[y*e*o+m*o+x],S=t[y*e*o+T*o+x],L=k(k(b,E,p),k(A,S,p),d%1);c[f*i*o+h*o+x]=L}}}return c}function pr(t,e,r,i,n,o,a="nearest"){switch(a.toLowerCase()){case"nearest":return yr(t,e,r,i,n,o);case"bilinear":case"linear":return mr(t,e,r,i,n,o);default:throw new Error(`Unsupported resampling method: '${a}'`)}}function xr(t,e,r){let i=0;for(let n=e;n<r;++n)i+=t[n];return i}function ge(t,e,r){switch(t){case 1:if(e<=8)return new Uint8Array(r);if(e<=16)return new Uint16Array(r);if(e<=32)return new Uint32Array(r);break;case 2:if(e===8)return new Int8Array(r);if(e===16)return new Int16Array(r);if(e===32)return new Int32Array(r);break;case 3:switch(e){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}break}throw Error("Unsupported data format/bitsPerSample")}function wr(t,e){return(t===1||t===2)&&e<=32&&e%8===0?!1:!(t===3&&(e===16||e===32||e===64))}function Tr(t,e,r,i,n,o,a){const s=new DataView(t),c=r===2?a*o:a*o*i,f=r===2?1:i,d=ge(e,n,c),u=parseInt("1".repeat(n),2);if(e===1){let y;r===1?y=i*n:y=n;let h=o*y;h&7&&(h=h+7&-8);for(let g=0;g<a;++g){const p=g*h;for(let m=0;m<o;++m){const T=p+m*f*n;for(let x=0;x<f;++x){const b=T+x*n,E=(g*o+m)*f+x,A=Math.floor(b/8),S=b%8;if(S+n<=8)d[E]=s.getUint8(A)>>8-n-S&u;else if(S+n<=16)d[E]=s.getUint16(A)>>16-n-S&u;else if(S+n<=24){const L=s.getUint16(A)<<8|s.getUint8(A+2);d[E]=L>>24-n-S&u}else d[E]=s.getUint32(A)>>32-n-S&u}}}}return d.buffer}class br{constructor(e,r,i,n,o,a){this.fileDirectory=e,this.geoKeys=r,this.dataView=i,this.littleEndian=n,this.tiles=o?{}:null,this.isTiled=!e.StripOffsets;const s=e.PlanarConfiguration;if(this.planarConfiguration=typeof s>"u"?1:s,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=a}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let r=0;r<this.fileDirectory.BitsPerSample.length;++r)e+=this.getSampleByteSize(r);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const r=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(r){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(n,o){return $e(this,n,o)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,r){const i=this.getSampleFormat(e),n=this.getBitsPerSample(e);return ge(i,n,r)}async getTileOrStrip(e,r,i,n,o){const a=Math.ceil(this.getWidth()/this.getTileWidth()),s=Math.ceil(this.getHeight()/this.getTileHeight());let c;const{tiles:f}=this;this.planarConfiguration===1?c=r*a+e:this.planarConfiguration===2&&(c=i*a*s+r*a+e);let d,u;this.isTiled?(d=this.fileDirectory.TileOffsets[c],u=this.fileDirectory.TileByteCounts[c]):(d=this.fileDirectory.StripOffsets[c],u=this.fileDirectory.StripByteCounts[c]);const y=(await this.source.fetch([{offset:d,length:u}],o))[0];let h;return f===null||!f[c]?(h=(async()=>{let g=await n.decode(this.fileDirectory,y);const p=this.getSampleFormat(),m=this.getBitsPerSample();return wr(p,m)&&(g=Tr(g,p,this.planarConfiguration,this.getSamplesPerPixel(),m,this.getTileWidth(),this.getBlockHeight(r))),g})(),f!==null&&(f[c]=h)):h=f[c],{x:e,y:r,sample:i,data:await h}}async _readRaster(e,r,i,n,o,a,s,c,f){const d=this.getTileWidth(),u=this.getTileHeight(),y=this.getWidth(),h=this.getHeight(),g=Math.max(Math.floor(e[0]/d),0),p=Math.min(Math.ceil(e[2]/d),Math.ceil(y/d)),m=Math.max(Math.floor(e[1]/u),0),T=Math.min(Math.ceil(e[3]/u),Math.ceil(h/u)),x=e[2]-e[0];let b=this.getBytesPerPixel();const E=[],A=[];for(let D=0;D<r.length;++D)this.planarConfiguration===1?E.push(xr(this.fileDirectory.BitsPerSample,0,r[D])/8):E.push(0),A.push(this.getReaderForSample(r[D]));const S=[],{littleEndian:L}=this;for(let D=m;D<T;++D)for(let te=g;te<p;++te){let ce;this.planarConfiguration===1&&(ce=this.getTileOrStrip(te,D,0,o,f));for(let re=0;re<r.length;++re){const ne=re,Oe=r[re];this.planarConfiguration===2&&(b=this.getSampleByteSize(Oe),ce=this.getTileOrStrip(te,D,Oe,o,f));const ft=ce.then(j=>{const ut=j.data,ht=new DataView(ut),le=this.getBlockHeight(j.y),q=j.y*u,ie=j.x*d,dt=q+le,gt=(j.x+1)*d,yt=A[ne],mt=Math.min(le,le-(dt-e[3]),h-q),pt=Math.min(d,d-(gt-e[2]),y-ie);for(let Y=Math.max(0,e[1]-q);Y<mt;++Y)for(let X=Math.max(0,e[0]-ie);X<pt;++X){const xt=(Y*d+X)*b,Ue=yt.call(ht,xt+E[ne],L);let oe;n?(oe=(Y+q-e[1])*x*r.length+(X+ie-e[0])*r.length+ne,i[oe]=Ue):(oe=(Y+q-e[1])*x+X+ie-e[0],i[ne][oe]=Ue)}});S.push(ft)}}if(await Promise.all(S),a&&e[2]-e[0]!==a||s&&e[3]-e[1]!==s){let D;return n?D=pr(i,e[2]-e[0],e[3]-e[1],a,s,r.length,c):D=gr(i,e[2]-e[0],e[3]-e[1],a,s,c),D.width=a,D.height=s,D}return i.width=a||e[2]-e[0],i.height=s||e[3]-e[1],i}async readRasters({window:e,samples:r=[],interleave:i,pool:n=null,width:o,height:a,resampleMethod:s,fillValue:c,signal:f}={}){const d=e||[0,0,this.getWidth(),this.getHeight()];if(d[0]>d[2]||d[1]>d[3])throw new Error("Invalid subsets");const u=d[2]-d[0],y=d[3]-d[1],h=u*y,g=this.getSamplesPerPixel();if(!r||!r.length)for(let x=0;x<g;++x)r.push(x);else for(let x=0;x<r.length;++x)if(r[x]>=g)return Promise.reject(new RangeError(`Invalid sample index '${r[x]}'.`));let p;if(i){const x=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,b=Math.max.apply(null,this.fileDirectory.BitsPerSample);p=ge(x,b,h*r.length),c&&p.fill(c)}else{p=[];for(let x=0;x<r.length;++x){const b=this.getArrayForSample(r[x],h);Array.isArray(c)&&x<c.length?b.fill(c[x]):c&&!Array.isArray(c)&&b.fill(c),p.push(b)}}const m=n||await ur(this.fileDirectory);return await this._readRaster(d,r,p,i,m,o,a,s,f)}async readRGB({window:e,interleave:r=!0,pool:i=null,width:n,height:o,resampleMethod:a,enableAlpha:s=!1,signal:c}={}){const f=e||[0,0,this.getWidth(),this.getHeight()];if(f[0]>f[2]||f[1]>f[3])throw new Error("Invalid subsets");const d=this.fileDirectory.PhotometricInterpretation;if(d===R.RGB){let T=[0,1,2];if(this.fileDirectory.ExtraSamples!==Qt.Unspecified&&s){T=[];for(let x=0;x<this.fileDirectory.BitsPerSample.length;x+=1)T.push(x)}return this.readRasters({window:e,interleave:r,samples:T,pool:i,width:n,height:o,resampleMethod:a,signal:c})}let u;switch(d){case R.WhiteIsZero:case R.BlackIsZero:case R.Palette:u=[0];break;case R.CMYK:u=[0,1,2,3];break;case R.YCbCr:case R.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const y={window:f,interleave:!0,samples:u,pool:i,width:n,height:o,resampleMethod:a,signal:c},{fileDirectory:h}=this,g=await this.readRasters(y),p=2**this.fileDirectory.BitsPerSample[0];let m;switch(d){case R.WhiteIsZero:m=er(g,p);break;case R.BlackIsZero:m=tr(g,p);break;case R.Palette:m=rr(g,h.ColorMap);break;case R.CMYK:m=nr(g);break;case R.YCbCr:m=ir(g);break;case R.CIELab:m=cr(g);break;default:throw new Error("Unsupported photometric interpretation.")}if(!r){const T=new Uint8Array(m.length/3),x=new Uint8Array(m.length/3),b=new Uint8Array(m.length/3);for(let E=0,A=0;E<m.length;E+=3,++A)T[A]=m[E],x[A]=m[E+1],b[A]=m[E+2];m=[T,x,b]}return m.width=g.width,m.height=g.height,m}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let r=0;r<this.fileDirectory.ModelTiepoint.length;r+=6)e.push({i:this.fileDirectory.ModelTiepoint[r],j:this.fileDirectory.ModelTiepoint[r+1],k:this.fileDirectory.ModelTiepoint[r+2],x:this.fileDirectory.ModelTiepoint[r+3],y:this.fileDirectory.ModelTiepoint[r+4],z:this.fileDirectory.ModelTiepoint[r+5]});return e}getGDALMetadata(e=null){const r={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let n=Zt(i,"Item");e===null?n=n.filter(o=>fe(o,"sample")===void 0):n=n.filter(o=>Number(fe(o,"sample"))===e);for(let o=0;o<n.length;++o){const a=n[o];r[fe(a,"name")]=a.inner}return r}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,r=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(r)return[r[3],r[7],r[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const r=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(r)return[r[0],-r[1],r[2]];if(i)return i[1]===0&&i[4]===0?[i[0],-i[5],i[10]]:[Math.sqrt(i[0]*i[0]+i[4]*i[4]),-Math.sqrt(i[1]*i[1]+i[5]*i[5]),i[10]];if(e){const[n,o,a]=e.getResolution();return[n*e.getWidth()/this.getWidth(),o*e.getHeight()/this.getHeight(),a*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const r=this.getHeight(),i=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[n,o,a,s,c,f,d,u]=this.fileDirectory.ModelTransformation,h=[[0,0],[0,r],[i,0],[i,r]].map(([m,T])=>[s+n*m+o*T,u+c*m+f*T]),g=h.map(m=>m[0]),p=h.map(m=>m[1]);return[Math.min(...g),Math.min(...p),Math.max(...g),Math.max(...p)]}else{const n=this.getOrigin(),o=this.getResolution(),a=n[0],s=n[1],c=a+o[0]*i,f=s+o[1]*r;return[Math.min(a,c),Math.min(s,f),Math.max(a,c),Math.max(s,f)]}}}class Er{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,r){const i=this.getUint32(e,r),n=this.getUint32(e+4,r);let o;if(r){if(o=i+2**32*n,!Number.isSafeInteger(o))throw new Error(`${o} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return o}if(o=2**32*i+n,!Number.isSafeInteger(o))throw new Error(`${o} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return o}getInt64(e,r){let i=0;const n=(this._dataView.getUint8(e+(r?7:0))&128)>0;let o=!0;for(let a=0;a<8;a++){let s=this._dataView.getUint8(e+(r?a:7-a));n&&(o?s!==0&&(s=~(s-1)&255,o=!1):s=~s&255),i+=s*256**a}return n&&(i=-i),i}getUint8(e,r){return this._dataView.getUint8(e,r)}getInt8(e,r){return this._dataView.getInt8(e,r)}getUint16(e,r){return this._dataView.getUint16(e,r)}getInt16(e,r){return this._dataView.getInt16(e,r)}getUint32(e,r){return this._dataView.getUint32(e,r)}getInt32(e,r){return this._dataView.getInt32(e,r)}getFloat16(e,r){return $e(this._dataView,e,r)}getFloat32(e,r){return this._dataView.getFloat32(e,r)}getFloat64(e,r){return this._dataView.getFloat64(e,r)}}class Ar{constructor(e,r,i,n){this._dataView=new DataView(e),this._sliceOffset=r,this._littleEndian=i,this._bigTiff=n}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,r){return this.sliceOffset<=e&&this.sliceTop>=e+r}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const r=this.readUint32(e),i=this.readUint32(e+4);let n;if(this._littleEndian){if(n=r+2**32*i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*r+i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}readInt64(e){let r=0;const i=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let n=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(this._littleEndian?o:7-o));i&&(n?a!==0&&(a=~(a-1)&255,n=!1):a=~a&255),r+=a*256**o}return i&&(r=-r),r}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}class Sr{async fetch(e,r=void 0){return Promise.all(e.map(i=>this.fetchSlice(i,r)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class ve extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,ve),this.name="AbortError"}}class Dr extends Sr{constructor(e){super(),this.arrayBuffer=e}fetchSlice(e,r){if(r&&r.aborted)throw new ve("Request aborted");return this.arrayBuffer.slice(e.offset,e.offset+e.length)}}function Ir(t){return new Dr(t)}function ye(t){switch(t){case w.BYTE:case w.ASCII:case w.SBYTE:case w.UNDEFINED:return 1;case w.SHORT:case w.SSHORT:return 2;case w.LONG:case w.SLONG:case w.FLOAT:case w.IFD:return 4;case w.RATIONAL:case w.SRATIONAL:case w.DOUBLE:case w.LONG8:case w.SLONG8:case w.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${t}`)}}function _r(t){const e=t.GeoKeyDirectory;if(!e)return null;const r={};for(let i=4;i<=e[3]*4;i+=4){const n=Wt[e[i]],o=e[i+1]?$[e[i+1]]:null,a=e[i+2],s=e[i+3];let c=null;if(!o)c=s;else{if(c=t[o],typeof c>"u"||c===null)throw new Error(`Could not get value of geoKey '${n}'.`);typeof c=="string"?c=c.substring(s,s+a-1):c.subarray&&(c=c.subarray(s,s+a),a===1&&(c=c[0]))}r[n]=c}return r}function N(t,e,r,i){let n=null,o=null;const a=ye(e);switch(e){case w.BYTE:case w.ASCII:case w.UNDEFINED:n=new Uint8Array(r),o=t.readUint8;break;case w.SBYTE:n=new Int8Array(r),o=t.readInt8;break;case w.SHORT:n=new Uint16Array(r),o=t.readUint16;break;case w.SSHORT:n=new Int16Array(r),o=t.readInt16;break;case w.LONG:case w.IFD:n=new Uint32Array(r),o=t.readUint32;break;case w.SLONG:n=new Int32Array(r),o=t.readInt32;break;case w.LONG8:case w.IFD8:n=new Array(r),o=t.readUint64;break;case w.SLONG8:n=new Array(r),o=t.readInt64;break;case w.RATIONAL:n=new Uint32Array(r*2),o=t.readUint32;break;case w.SRATIONAL:n=new Int32Array(r*2),o=t.readInt32;break;case w.FLOAT:n=new Float32Array(r),o=t.readFloat32;break;case w.DOUBLE:n=new Float64Array(r),o=t.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===w.RATIONAL||e===w.SRATIONAL)for(let s=0;s<r;s+=2)n[s]=o.call(t,i+s*a),n[s+1]=o.call(t,i+(s*a+4));else for(let s=0;s<r;++s)n[s]=o.call(t,i+s*a);return e===w.ASCII?new TextDecoder("utf-8").decode(n):n}class vr{constructor(e,r,i){this.fileDirectory=e,this.geoKeyDirectory=r,this.nextIFDByteOffset=i}}class se extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Pr{async readRasters(e={}){const{window:r,width:i,height:n}=e;let{resX:o,resY:a,bbox:s}=e;const c=await this.getImage();let f=c;const d=await this.getImageCount(),u=c.getBoundingBox();if(r&&s)throw new Error('Both "bbox" and "window" passed.');if(i||n){if(r){const[g,p]=c.getOrigin(),[m,T]=c.getResolution();s=[g+r[0]*m,p+r[1]*T,g+r[2]*m,p+r[3]*T]}const h=s||u;if(i){if(o)throw new Error("Both width and resX passed");o=(h[2]-h[0])/i}if(n){if(a)throw new Error("Both width and resY passed");a=(h[3]-h[1])/n}}if(o||a){const h=[];for(let g=0;g<d;++g){const p=await this.getImage(g),{SubfileType:m,NewSubfileType:T}=p.fileDirectory;(g===0||m===2||T&1)&&h.push(p)}h.sort((g,p)=>g.getWidth()-p.getWidth());for(let g=0;g<h.length;++g){const p=h[g],m=(u[2]-u[0])/p.getWidth(),T=(u[3]-u[1])/p.getHeight();if(f=p,o&&o>m||a&&a>T)break}}let y=r;if(s){const[h,g]=c.getOrigin(),[p,m]=f.getResolution(c);y=[Math.round((s[0]-h)/p),Math.round((s[1]-g)/m),Math.round((s[2]-h)/p),Math.round((s[3]-g)/m)],y=[Math.min(y[0],y[2]),Math.min(y[1],y[3]),Math.max(y[0],y[2]),Math.max(y[1],y[3])]}return f.readRasters({...e,window:y})}}class Pe extends Pr{constructor(e,r,i,n,o={}){super(),this.source=e,this.littleEndian=r,this.bigTiff=i,this.firstIFDOffset=n,this.cache=o.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,r){const i=this.bigTiff?4048:1024;return new Ar((await this.source.fetch([{offset:e,length:typeof r<"u"?r:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const r=this.bigTiff?20:12,i=this.bigTiff?8:2;let n=await this.getSlice(e);const o=this.bigTiff?n.readUint64(e):n.readUint16(e),a=o*r+(this.bigTiff?16:6);n.covers(e,a)||(n=await this.getSlice(e,a));const s={};let c=e+(this.bigTiff?8:2);for(let u=0;u<o;c+=r,++u){const y=n.readUint16(c),h=n.readUint16(c+2),g=this.bigTiff?n.readUint64(c+4):n.readUint32(c+4);let p,m;const T=ye(h),x=c+(this.bigTiff?12:8);if(T*g<=(this.bigTiff?8:4))p=N(n,h,g,x);else{const b=n.readOffset(x),E=ye(h)*g;if(n.covers(b,E))p=N(n,h,g,b);else{const A=await this.getSlice(b,E);p=N(A,h,g,b)}}g===1&&Jt.indexOf(y)===-1&&!(h===w.RATIONAL||h===w.SRATIONAL)?m=p[0]:m=p,s[$[y]]=m}const f=_r(s),d=n.readOffset(e+i+r*o);return new vr(s,f,d)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(r){throw r instanceof se?new se(e):r}return this.ifdRequests[e]=(async()=>{const r=await this.ifdRequests[e-1];if(r.nextIFDByteOffset===0)throw new se(e);return this.parseFileDirectoryAt(r.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const r=await this.requestIFD(e);return new br(r.fileDirectory,r.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,r=!0;for(;r;)try{await this.requestIFD(e),++e}catch(i){if(i instanceof se)r=!1;else throw i}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const r="GDAL_STRUCTURAL_METADATA_SIZE=",i=r.length+100;let n=await this.getSlice(e,i);if(r===N(n,w.ASCII,r.length,e)){const a=N(n,w.ASCII,i,e).split(`
`)[0],s=Number(a.split("=")[1].split(" ")[0])+a.length;s>i&&(n=await this.getSlice(e,s));const c=N(n,w.ASCII,s,e);this.ghostValues={},c.split(`
`).filter(f=>f.length>0).map(f=>f.split("=")).forEach(([f,d])=>{this.ghostValues[f]=d})}return this.ghostValues}static async fromSource(e,r,i){const n=(await e.fetch([{offset:0,length:1024}],i))[0],o=new Er(n),a=o.getUint16(0,0);let s;if(a===18761)s=!0;else if(a===19789)s=!1;else throw new TypeError("Invalid byte order value.");const c=o.getUint16(2,s);let f;if(c===42)f=!1;else if(c===43){if(f=!0,o.getUint16(4,s)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const d=f?o.getUint64(8,s):o.getUint32(4,s);return new Pe(e,s,f,d,r)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function Rr(t,e){return Pe.fromSource(Ir(t),e)}const Or="/demdag-web/assets/d8_discovery-DIlOFSey.tif",Ur="/demdag-web/assets/d8_finish-Bx5Xn6p1.tif",Br="/demdag-web/assets/d8_bg-CjKuwq6_.jpg",Gr="/demdag-web/assets/helens_fdr_discovery-CKLjcKoa.tif",Lr="/demdag-web/assets/helens_fdr_finish-BCrm6vHq.tif",Mr="/demdag-web/assets/helens_bg-Bc-HqWEv.jpg";var O=[],v=1,l,_,H=[],Z=[.25,.5,1,2,4,8,16],M=2,nt=0;const Fr=100;var Re=1;function Cr(){v=1,M=2,console.debug("zoom: ",v),ee()}function it(t){let e=M+t;e<0&&(e=0),e>=Z.length&&(e=Z.length-1),M=e,v=Z[M],console.debug("zoom: ",v),ee()}function Nr(t,e){const r=new Image;return r.crossOrigin="Anonymous",r.src=t,r.onload=e,r}let z={};async function kr(t){if(!(z!=null&&z[t])){let e;console.debug("fetching:",t);const i=await(await fetch(t)).arrayBuffer(),o=await(await Rr(i)).getImage(),a=o.getWidth(),s=o.getHeight();if(t.includes("_discovery")||t.includes("_finish")){const c=await o.readRasters(),f=new Uint8ClampedArray(c[0].length*4);for(let u=0;u<s;u++)for(let y=0;y<a;y++){const h=u*a+y,g=4*u*a+4*y,p=c[0][h];f[g]=p&255,f[g+1]=p>>8&255,f[g+2]=p>>16&255,f[g+3]=p>>24&255}const d={data:f,width:a,height:s};console.debug("data: ",d,t),e=d}else{const c=await o.readRGB(),f=document.createElement("canvas");f.width=a,f.height=s;const d=f.getContext("2d",{willReadFrequently:!0}),u=d.getImageData(0,0,a,s),y=u.data;for(let h=0;h<s;h++)for(let g=0;g<a;g++){const p=3*h*a+3*g,m=4*h*a+4*g;y[m]=c[p],y[m+1]=c[p+1],y[m+2]=c[p+2],y[m+3]=255}console.debug("imdata: ",u),d.putImageData(u,0,0),e=u}z[t]=e}return z[t]}async function ot(t,e){var r=t.length;O=[];var i=function(){--r,console.debug("loaded img."),r===0&&(console.debug("images:",O),e(O))};console.debug("urls:",t);for(var n=0;n<t.length;++n){const o=t[n];console.debug("loading: ",o);let a;o.endsWith(".tif")||o.endsWith(".tiff")?(a=await kr(o),O.push(a),i()):(a=await Nr(o,i),O.push(a))}}function ee(){try{Vr(),console.debug("rendered!")}catch(t){console.error(t)}}function Vr(){var A;if(!(O.length>0)||!(((A=O[0])==null?void 0:A.width)>0))return;var t=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,t),Kr(l,0,0,O[0].width,O[0].height);let e=O[0].width*v,r=O[0].height*v;if(e>=4096||r>4096){alert("texture too large!"),it(-1);return}l.canvas.width=e,l.canvas.height=r;var i=l.getAttribLocation(_,"a_position"),n=l.getAttribLocation(_,"a_texCoord"),o=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,o),l.bufferData(l.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),l.STATIC_DRAW);var a=l.getUniformLocation(_,"u_resolution"),s=l.getUniformLocation(_,"u_mouse"),c=l.getUniformLocation(_,"u_zoom"),f=l.getUniformLocation(_,"u_image0"),d=l.getUniformLocation(_,"u_image1"),u=l.getUniformLocation(_,"u_image2");l.viewport(0,0,l.canvas.width,l.canvas.height),l.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT),l.useProgram(_),l.enableVertexAttribArray(i),l.bindBuffer(l.ARRAY_BUFFER,t);var y=2,h=l.FLOAT,g=!1,p=0,m=0;l.vertexAttribPointer(i,y,h,g,p,m),l.enableVertexAttribArray(n),l.bindBuffer(l.ARRAY_BUFFER,o);var y=2,h=l.FLOAT,g=!1,p=0,m=0;l.vertexAttribPointer(n,y,h,g,p,m),l.uniform2f(a,l.canvas.width/v,l.canvas.height/v),l.uniform2f(s,J.x/v,J.y/v),l.uniform1f(c,v),l.uniform1i(f,0),l.uniform1i(d,1),l.uniform1i(u,2),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,H[0]),l.activeTexture(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,H[1]),l.activeTexture(l.TEXTURE2),l.bindTexture(l.TEXTURE_2D,H[2]),l.drawArrays(l.TRIANGLES,0,6);let T=l.canvas.width,x=l.canvas.height;const b=new Uint8Array(T*x*4);l.readPixels(0,0,T,x,l.RGBA,l.UNSIGNED_BYTE,b);let E=0;for(let S=0;S<x;S++)for(let L=0;L<T;L++){const D=4*S*T+4*L;b[D+2]>=255&&(E+=1)}nt=Math.floor(E/(v*v))}function st(t){var s;if(t.length===0){console.error("No Images!");return}var e=document.querySelector("#canvas");if(l=e.getContext("webgl"),!l){console.error("Cannot attach as webgl canvas to the document!");return}const r=["vertex-shader-2d","fragment-shader-2d"],i=[];for(let c=0;c<r.length;++c){let f="",d,u=r[c];const y=document.getElementById(u);if(!y)throw"*** Error: unknown script element"+u;if(f=y.text,y.type==="x-shader/x-vertex")d=l.VERTEX_SHADER;else if(y.type==="x-shader/x-fragment")d=l.FRAGMENT_SHADER;else if(d!==l.VERTEX_SHADER&&d!==l.FRAGMENT_SHADER)throw"*** Error: unknown shader type";const h=l.createShader(d);if(l.shaderSource(h,f),l.compileShader(h),!l.getShaderParameter(h,l.COMPILE_STATUS)){const p=l.getShaderInfoLog(h);return console.error("*** Error compiling shader '"+h+"':"+p+`
`+f.split(`
`).map((m,T)=>`${T+1}: ${m}`).join(`
`)),l.deleteShader(h),null}i.push(h)}if(_=l.createProgram(),i.forEach(function(c){l.attachShader(_,c)}),l.linkProgram(_),!l.getProgramParameter(_,l.LINK_STATUS)){const c=l.getProgramInfoLog(_);return errFn("Error in program linking:"+c),l.deleteProgram(_),null}l.useProgram(_),H=[];for(var o=0;o<t.length;++o){var a=l.createTexture();l.bindTexture(l.TEXTURE_2D,a),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),(s=t[o])!=null&&s.data?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,t[o].width,t[o].height,0,l.RGBA,l.UNSIGNED_BYTE,t[o].data):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,t[o]),H.push(a)}ee()}function Kr(t,e,r,i,n){var o=e,a=e+i,s=r,c=r+n;t.bufferData(t.ARRAY_BUFFER,new Float32Array([o,s,a,s,o,c,o,c,a,s,a,c]),t.STATIC_DRAW)}var J={x:1e6,y:1e6};function jr(t,e){e=e||t.target;var r=e.getBoundingClientRect();return{x:t.clientX-r.left,y:t.clientY-r.top}}function qr(t,e){var r;return function(i){r||(r=setTimeout(()=>(t(i),r=void 0),e))}}function Yr(t,e){e=e||t.target;var r=jr(t,e);return r.x=r.x*e.width/e.clientWidth,r.y=r.y*e.height/e.clientHeight,r}const Xr=function(){let t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t};function zr(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}const $r=zr()||Xr();let me=0;document.querySelector("#canvas").addEventListener("touchstart",function(t){me++,t.touches.length===1&&me===1&&t.preventDefault()},{passive:!1});document.querySelector("#canvas").addEventListener("touchend",function(t){me=0});let Me=document.getElementById("area-summary");const Hr=t=>{const e=Yr(t),r=$r*50;J.x=e.x,J.y=e.y-r,console.debug("mousePos",J),ee();try{let i=t.pageX,n=t.pageY;Me.style.left=i+"px",Me.style.top=n-r+"px"}catch(i){console.error(i)}Qr()};document.querySelector("#canvas").addEventListener("pointermove",qr(Hr,16));document.addEventListener("resize",ee);async function Zr(){M=3,v=Z[M],await ot([Or,Ur,Br],st)}async function Jr(){M=2,v=Z[M],await ot([Gr,Lr,Mr],st)}async function at(t){if(t||(t=new URLSearchParams(window.location.search).get("example")),t=="lg"){window.history.pushState({},document.title,"./?example=lg"),Jr();return}window.history.pushState({},document.title,"./"),Zr()}function ct(t){Re=t,lt()}function lt(){if(!Re){document.getElementById("area-summary").style.display="none";return}document.getElementById("area-summary").style.display="block"}document.querySelector("#canvas").addEventListener("mouseenter",lt);document.querySelector("#canvas").addEventListener("mouseexit",()=>{document.getElementById("area-summary").style.display="none"});function Qr(){let e=(nt*Fr*Re).toLocaleString(),r=document.getElementById("area_value");r.innerText=e}const de=[{id:"acres",label:"Acres",from_sqm:1/4046.86},{id:"sqmi",label:"Sq Mi",from_sqm:1/2589988110336e-6},{id:"sqm",label:"Sq M",from_sqm:1},{id:"sqkm",label:"Sq Km",from_sqm:1/1e3},{id:"pixels",label:"Pixels",from_sqm:1/100},{id:"none",label:"Hide",from_sqm:0}];function Wr(){let t=document.getElementById("area-units"),e=t.innerHTML;for(const i of de)e+=`
    <div style="padding: 0 0.5em 0 0; min-width: 6ch;">
      <input type="radio" id="units-${i.id}" name="units" value="${i.id}" onChange=changeUnits(${i.from_sqm})>
      <label for="units-${i.id}" >${i.label}</label>
    </div>
    `;t.innerHTML=e;let r=document.querySelector(`input[id='units-${de[0].id}']`);r.checked=!0,ct(de[0].from_sqm)}window.main=at;window.adjustZoom=it;window.resetZoom=Cr;window.changeUnits=ct;Wr();at();export{un as L,hn as a,He as g};
