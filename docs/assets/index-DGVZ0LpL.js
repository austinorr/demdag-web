const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/raw-in9isEBO.js","assets/basedecoder-B2c5_Eok.js","assets/lzw-_aCqfs4w.js","assets/jpeg-vtRboCKw.js","assets/deflate-B9JhHpvg.js","assets/pako.esm-Cram60i4.js","assets/packbits-DDWKfGV_.js","assets/lerc-B_Nfh8Z_.js","assets/webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();function S(t){return(e,...r)=>bt(t,e,r)}function K(t,e){return S(Ve(t,e).get)}const{apply:bt,getOwnPropertyDescriptor:Ve,getPrototypeOf:Ee,ownKeys:Et}=Reflect,{iterator:W,toStringTag:At}=Symbol,St=Object,{create:Ae,defineProperty:Dt}=St,It=Array,vt=It.prototype,je=vt[W],_t=S(je),qe=ArrayBuffer,Pt=qe.prototype;K(Pt,"byteLength");const Oe=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Oe&&K(Oe.prototype,"byteLength");const Ye=Ee(Uint8Array);Ye.from;const v=Ye.prototype;v[W];S(v.keys);S(v.values);S(v.entries);S(v.set);S(v.reverse);S(v.fill);S(v.copyWithin);S(v.sort);S(v.slice);S(v.subarray);K(v,"buffer");K(v,"byteOffset");K(v,"length");K(v,At);const Rt=Uint8Array,Xe=Uint16Array,Se=Uint32Array,Ut=Float32Array,Q=Ee([][W]()),ze=S(Q.next),Bt=S((function*(){})().next),Ot=Ee(Q),Gt=DataView.prototype,Mt=S(Gt.getUint16),De=WeakMap,$e=De.prototype,He=S($e.get),Lt=S($e.set),Ze=new De,Ft=Ae(null,{next:{value:function(){const e=He(Ze,this);return ze(e)}},[W]:{value:function(){return this}}});function Ct(t){if(t[W]===je&&Q.next===ze)return t;const e=Ae(Ft);return Lt(Ze,e,_t(t)),e}const Nt=new De,kt=Ae(Ot,{next:{value:function(){const e=He(Nt,this);return Bt(e)},writable:!0,configurable:!0}});for(const t of Et(Q))t!=="next"&&Dt(kt,t,Ve(Q,t));const Je=new qe(4),Kt=new Ut(Je),Vt=new Se(Je),R=new Xe(512),U=new Rt(512);for(let t=0;t<256;++t){const e=t-127;e<-24?(R[t]=0,R[t|256]=32768,U[t]=24,U[t|256]=24):e<-14?(R[t]=1024>>-e-14,R[t|256]=1024>>-e-14|32768,U[t]=-e-1,U[t|256]=-e-1):e<=15?(R[t]=e+15<<10,R[t|256]=e+15<<10|32768,U[t]=13,U[t|256]=13):e<128?(R[t]=31744,R[t|256]=64512,U[t]=24,U[t|256]=24):(R[t]=31744,R[t|256]=64512,U[t]=13,U[t|256]=13)}const Ie=new Se(2048);for(let t=1;t<1024;++t){let e=t<<13,r=0;for(;(e&8388608)===0;)e<<=1,r-=8388608;e&=-8388609,r+=947912704,Ie[t]=e|r}for(let t=1024;t<2048;++t)Ie[t]=939524096+(t-1024<<13);const V=new Se(64);for(let t=1;t<31;++t)V[t]=t<<23;V[31]=1199570944;V[32]=2147483648;for(let t=33;t<63;++t)V[t]=2147483648+(t-32<<23);V[63]=3347054592;const Qe=new Xe(64);for(let t=1;t<64;++t)t!==32&&(Qe[t]=1024);function jt(t){const e=t>>10;return Vt[0]=Ie[Qe[e]+(t&1023)]+V[e],Kt[0]}function We(t,e,...r){return jt(Mt(t,e,...Ct(r)))}function et(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var oe={exports:{}},Ge;function qt(){if(Ge)return oe.exports;Ge=1;function t(e,r,o){const n=o&&o.debug||!1;n&&console.log("[xml-utils] getting "+r+" in "+e);const i=typeof e=="object"?e.outer:e,s=i.slice(0,i.indexOf(">")+1),a=['"',"'"];for(let l=0;l<a.length;l++){const c=a[l],u=r+"\\="+c+"([^"+c+"]*)"+c;n&&console.log("[xml-utils] pattern:",u);const y=new RegExp(u).exec(s);if(n&&console.log("[xml-utils] match:",y),y)return y[1]}}return oe.exports=t,oe.exports.default=t,oe.exports}var Yt=qt();const me=et(Yt);var se={exports:{}},ae={exports:{}},ce={exports:{}},Me;function Xt(){if(Me)return ce.exports;Me=1;function t(e,r,o){const i=new RegExp(r).exec(e.slice(o));return i?o+i.index:-1}return ce.exports=t,ce.exports.default=t,ce.exports}var le={exports:{}},Le;function zt(){if(Le)return le.exports;Le=1;function t(e,r,o){const i=new RegExp(r).exec(e.slice(o));return i?o+i.index+i[0].length-1:-1}return le.exports=t,le.exports.default=t,le.exports}var fe={exports:{}},Fe;function $t(){if(Fe)return fe.exports;Fe=1;function t(e,r){const o=new RegExp(r,"g"),n=e.match(o);return n?n.length:0}return fe.exports=t,fe.exports.default=t,fe.exports}var Ce;function Ht(){if(Ce)return ae.exports;Ce=1;const t=Xt(),e=zt(),r=$t();function o(n,i,s){const a=s&&s.debug||!1,l=!(s&&typeof s.nested===!1),c=s&&s.startIndex||0;a&&console.log("[xml-utils] starting findTagByName with",i," and ",s);const u=t(n,`<${i}[ 
>/]`,c);if(a&&console.log("[xml-utils] start:",u),u===-1)return;const h=n.slice(u+i.length);let y=e(h,"^[^<]*[ /]>",0);const g=y!==-1&&h[y-1]==="/";if(a&&console.log("[xml-utils] selfClosing:",g),g===!1)if(l){let T=0,x=1,b=0;for(;(y=e(h,"[ /]"+i+">",T))!==-1;){const E=h.substring(T,y+1);if(x+=r(E,"<"+i+`[ 
	>]`),b+=r(E,"</"+i+">"),b>=x)break;T=y}}else y=e(h,"[ /]"+i+">",0);const d=u+i.length+y+1;if(a&&console.log("[xml-utils] end:",d),d===-1)return;const m=n.slice(u,d);let p;return g?p=null:p=m.slice(m.indexOf(">")+1,m.lastIndexOf("<")),{inner:p,outer:m,start:u,end:d}}return ae.exports=o,ae.exports.default=o,ae.exports}var Ne;function Zt(){if(Ne)return se.exports;Ne=1;const t=Ht();function e(r,o,n){const i=[],s=n&&n.debug||!1,a=n&&typeof n.nested=="boolean"?n.nested:!0;let l=n&&n.startIndex||0,c;for(;c=t(r,o,{debug:s,startIndex:l});)a?l=c.start+1+o.length:l=c.end,i.push(c);return s&&console.log("findTagsByName found",i.length,"tags"),i}return se.exports=e,se.exports.default=e,se.exports}var Jt=Zt();const Qt=et(Jt),$={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},B={};for(const t in $)$.hasOwnProperty(t)&&(B[$[t]]=parseInt(t,10));const Wt=[B.BitsPerSample,B.ExtraSamples,B.SampleFormat,B.StripByteCounts,B.StripOffsets,B.StripRowCounts,B.TileByteCounts,B.TileOffsets,B.SubIFDs],pe={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},w={};for(const t in pe)pe.hasOwnProperty(t)&&(w[pe[t]]=parseInt(t,10));const P={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8},er={Unspecified:0},rn={AddCompression:1},nn={None:0,Deflate:1,Zstandard:2},tr={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function rr(t,e){const{width:r,height:o}=t,n=new Uint8Array(r*o*3);let i;for(let s=0,a=0;s<t.length;++s,a+=3)i=256-t[s]/e*256,n[a]=i,n[a+1]=i,n[a+2]=i;return n}function nr(t,e){const{width:r,height:o}=t,n=new Uint8Array(r*o*3);let i;for(let s=0,a=0;s<t.length;++s,a+=3)i=t[s]/e*256,n[a]=i,n[a+1]=i,n[a+2]=i;return n}function ir(t,e){const{width:r,height:o}=t,n=new Uint8Array(r*o*3),i=e.length/3,s=e.length/3*2;for(let a=0,l=0;a<t.length;++a,l+=3){const c=t[a];n[l]=e[c]/65536*256,n[l+1]=e[c+i]/65536*256,n[l+2]=e[c+s]/65536*256}return n}function or(t){const{width:e,height:r}=t,o=new Uint8Array(e*r*3);for(let n=0,i=0;n<t.length;n+=4,i+=3){const s=t[n],a=t[n+1],l=t[n+2],c=t[n+3];o[i]=255*((255-s)/256)*((255-c)/256),o[i+1]=255*((255-a)/256)*((255-c)/256),o[i+2]=255*((255-l)/256)*((255-c)/256)}return o}function sr(t){const{width:e,height:r}=t,o=new Uint8ClampedArray(e*r*3);for(let n=0,i=0;n<t.length;n+=3,i+=3){const s=t[n],a=t[n+1],l=t[n+2];o[i]=s+1.402*(l-128),o[i+1]=s-.34414*(a-128)-.71414*(l-128),o[i+2]=s+1.772*(a-128)}return o}const ar=.95047,cr=1,lr=1.08883;function fr(t){const{width:e,height:r}=t,o=new Uint8Array(e*r*3);for(let n=0,i=0;n<t.length;n+=3,i+=3){const s=t[n+0],a=t[n+1]<<24>>24,l=t[n+2]<<24>>24;let c=(s+16)/116,u=a/500+c,h=c-l/200,y,g,d;u=ar*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),c=cr*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),h=lr*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),y=u*3.2406+c*-1.5372+h*-.4986,g=u*-.9689+c*1.8758+h*.0415,d=u*.0557+c*-.204+h*1.057,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,o[i]=Math.max(0,Math.min(1,y))*255,o[i+1]=Math.max(0,Math.min(1,g))*255,o[i+2]=Math.max(0,Math.min(1,d))*255}return o}const ur="modulepreload",hr=function(t){return"/demdag-web/"+t},ke={},C=function(e,r,o){let n=Promise.resolve();if(r&&r.length>0){let l=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");n=l(r.map(c=>{if(c=hr(c),c in ke)return;ke[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const y=document.createElement("link");if(y.rel=u?"stylesheet":ur,u||(y.as="script"),y.crossOrigin="",y.href=c,a&&y.setAttribute("nonce",a),document.head.appendChild(y),u)return new Promise((g,d)=>{y.addEventListener("load",g),y.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return n.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},tt=new Map;function G(t,e){Array.isArray(t)||(t=[t]),t.forEach(r=>tt.set(r,e))}async function dr(t){const e=tt.get(t.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${t.Compression}`);const r=await e();return new r(t)}G([void 0,1],()=>C(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([0,1])).then(t=>t.default));G(5,()=>C(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([2,1])).then(t=>t.default));G(6,()=>{throw new Error("old style JPEG compression is not supported.")});G(7,()=>C(()=>import("./jpeg-vtRboCKw.js"),__vite__mapDeps([3,1])).then(t=>t.default));G([8,32946],()=>C(()=>import("./deflate-B9JhHpvg.js"),__vite__mapDeps([4,5,1])).then(t=>t.default));G(32773,()=>C(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([6,1])).then(t=>t.default));G(34887,()=>C(()=>import("./lerc-B_Nfh8Z_.js"),__vite__mapDeps([7,5,1])).then(async t=>(await t.zstd.init(),t)).then(t=>t.default));G(50001,()=>C(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([8,1])).then(t=>t.default));function de(t,e,r,o=1){return new(Object.getPrototypeOf(t)).constructor(e*r*o)}function gr(t,e,r,o,n){const i=e/o,s=r/n;return t.map(a=>{const l=de(a,o,n);for(let c=0;c<n;++c){const u=Math.min(Math.round(s*c),r-1);for(let h=0;h<o;++h){const y=Math.min(Math.round(i*h),e-1),g=a[u*e+y];l[c*o+h]=g}}return l})}function k(t,e,r){return(1-r)*t+r*e}function yr(t,e,r,o,n){const i=e/o,s=r/n;return t.map(a=>{const l=de(a,o,n);for(let c=0;c<n;++c){const u=s*c,h=Math.floor(u),y=Math.min(Math.ceil(u),r-1);for(let g=0;g<o;++g){const d=i*g,m=d%1,p=Math.floor(d),T=Math.min(Math.ceil(d),e-1),x=a[h*e+p],b=a[h*e+T],E=a[y*e+p],A=a[y*e+T],_=k(k(x,b,m),k(E,A,m),u%1);l[c*o+g]=_}}return l})}function mr(t,e,r,o,n,i="nearest"){switch(i.toLowerCase()){case"nearest":return gr(t,e,r,o,n);case"bilinear":case"linear":return yr(t,e,r,o,n);default:throw new Error(`Unsupported resampling method: '${i}'`)}}function pr(t,e,r,o,n,i){const s=e/o,a=r/n,l=de(t,o,n,i);for(let c=0;c<n;++c){const u=Math.min(Math.round(a*c),r-1);for(let h=0;h<o;++h){const y=Math.min(Math.round(s*h),e-1);for(let g=0;g<i;++g){const d=t[u*e*i+y*i+g];l[c*o*i+h*i+g]=d}}}return l}function xr(t,e,r,o,n,i){const s=e/o,a=r/n,l=de(t,o,n,i);for(let c=0;c<n;++c){const u=a*c,h=Math.floor(u),y=Math.min(Math.ceil(u),r-1);for(let g=0;g<o;++g){const d=s*g,m=d%1,p=Math.floor(d),T=Math.min(Math.ceil(d),e-1);for(let x=0;x<i;++x){const b=t[h*e*i+p*i+x],E=t[h*e*i+T*i+x],A=t[y*e*i+p*i+x],_=t[y*e*i+T*i+x],j=k(k(b,E,m),k(A,_,m),u%1);l[c*o*i+g*i+x]=j}}}return l}function wr(t,e,r,o,n,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return pr(t,e,r,o,n,i);case"bilinear":case"linear":return xr(t,e,r,o,n,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function Tr(t,e,r){let o=0;for(let n=e;n<r;++n)o+=t[n];return o}function we(t,e,r){switch(t){case 1:if(e<=8)return new Uint8Array(r);if(e<=16)return new Uint16Array(r);if(e<=32)return new Uint32Array(r);break;case 2:if(e===8)return new Int8Array(r);if(e===16)return new Int16Array(r);if(e===32)return new Int32Array(r);break;case 3:switch(e){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}break}throw Error("Unsupported data format/bitsPerSample")}function br(t,e){return(t===1||t===2)&&e<=32&&e%8===0?!1:!(t===3&&(e===16||e===32||e===64))}function Er(t,e,r,o,n,i,s){const a=new DataView(t),l=r===2?s*i:s*i*o,c=r===2?1:o,u=we(e,n,l),h=parseInt("1".repeat(n),2);if(e===1){let y;r===1?y=o*n:y=n;let g=i*y;(g&7)!==0&&(g=g+7&-8);for(let d=0;d<s;++d){const m=d*g;for(let p=0;p<i;++p){const T=m+p*c*n;for(let x=0;x<c;++x){const b=T+x*n,E=(d*i+p)*c+x,A=Math.floor(b/8),_=b%8;if(_+n<=8)u[E]=a.getUint8(A)>>8-n-_&h;else if(_+n<=16)u[E]=a.getUint16(A)>>16-n-_&h;else if(_+n<=24){const j=a.getUint16(A)<<8|a.getUint8(A+2);u[E]=j>>24-n-_&h}else u[E]=a.getUint32(A)>>32-n-_&h}}}}return u.buffer}class Ar{constructor(e,r,o,n,i,s){this.fileDirectory=e,this.geoKeys=r,this.dataView=o,this.littleEndian=n,this.tiles=i?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=s}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let r=0;r<this.fileDirectory.BitsPerSample.length;++r)e+=this.getSampleByteSize(r);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const r=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,o=this.fileDirectory.BitsPerSample[e];switch(r){case 1:if(o<=8)return DataView.prototype.getUint8;if(o<=16)return DataView.prototype.getUint16;if(o<=32)return DataView.prototype.getUint32;break;case 2:if(o<=8)return DataView.prototype.getInt8;if(o<=16)return DataView.prototype.getInt16;if(o<=32)return DataView.prototype.getInt32;break;case 3:switch(o){case 16:return function(n,i){return We(this,n,i)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,r){const o=this.getSampleFormat(e),n=this.getBitsPerSample(e);return we(o,n,r)}async getTileOrStrip(e,r,o,n,i){const s=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:c}=this;this.planarConfiguration===1?l=r*s+e:this.planarConfiguration===2&&(l=o*s*a+r*s+e);let u,h;this.isTiled?(u=this.fileDirectory.TileOffsets[l],h=this.fileDirectory.TileByteCounts[l]):(u=this.fileDirectory.StripOffsets[l],h=this.fileDirectory.StripByteCounts[l]);const y=(await this.source.fetch([{offset:u,length:h}],i))[0];let g;return c===null||!c[l]?(g=(async()=>{let d=await n.decode(this.fileDirectory,y);const m=this.getSampleFormat(),p=this.getBitsPerSample();return br(m,p)&&(d=Er(d,m,this.planarConfiguration,this.getSamplesPerPixel(),p,this.getTileWidth(),this.getBlockHeight(r))),d})(),c!==null&&(c[l]=g)):g=c[l],{x:e,y:r,sample:o,data:await g}}async _readRaster(e,r,o,n,i,s,a,l,c){const u=this.getTileWidth(),h=this.getTileHeight(),y=this.getWidth(),g=this.getHeight(),d=Math.max(Math.floor(e[0]/u),0),m=Math.min(Math.ceil(e[2]/u),Math.ceil(y/u)),p=Math.max(Math.floor(e[1]/h),0),T=Math.min(Math.ceil(e[3]/h),Math.ceil(g/h)),x=e[2]-e[0];let b=this.getBytesPerPixel();const E=[],A=[];for(let I=0;I<r.length;++I)this.planarConfiguration===1?E.push(Tr(this.fileDirectory.BitsPerSample,0,r[I])/8):E.push(0),A.push(this.getReaderForSample(r[I]));const _=[],{littleEndian:j}=this;for(let I=p;I<T;++I)for(let ee=d;ee<m;++ee){let ge;this.planarConfiguration===1&&(ge=this.getTileOrStrip(ee,I,0,i,c));for(let te=0;te<r.length;++te){const re=te,Ue=r[te];this.planarConfiguration===2&&(b=this.getSampleByteSize(Ue),ge=this.getTileOrStrip(ee,I,Ue,i,c));const ht=ge.then(q=>{const dt=q.data,gt=new DataView(dt),ye=this.getBlockHeight(q.y),Y=q.y*h,ne=q.x*u,yt=Y+ye,mt=(q.x+1)*u,pt=A[re],xt=Math.min(ye,ye-(yt-e[3]),g-Y),wt=Math.min(u,u-(mt-e[2]),y-ne);for(let X=Math.max(0,e[1]-Y);X<xt;++X)for(let z=Math.max(0,e[0]-ne);z<wt;++z){const Tt=(X*u+z)*b,Be=pt.call(gt,Tt+E[re],j);let ie;n?(ie=(X+Y-e[1])*x*r.length+(z+ne-e[0])*r.length+re,o[ie]=Be):(ie=(X+Y-e[1])*x+z+ne-e[0],o[re][ie]=Be)}});_.push(ht)}}if(await Promise.all(_),s&&e[2]-e[0]!==s||a&&e[3]-e[1]!==a){let I;return n?I=wr(o,e[2]-e[0],e[3]-e[1],s,a,r.length,l):I=mr(o,e[2]-e[0],e[3]-e[1],s,a,l),I.width=s,I.height=a,I}return o.width=s||e[2]-e[0],o.height=a||e[3]-e[1],o}async readRasters({window:e,samples:r=[],interleave:o,pool:n=null,width:i,height:s,resampleMethod:a,fillValue:l,signal:c}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const h=u[2]-u[0],y=u[3]-u[1],g=h*y,d=this.getSamplesPerPixel();if(!r||!r.length)for(let x=0;x<d;++x)r.push(x);else for(let x=0;x<r.length;++x)if(r[x]>=d)return Promise.reject(new RangeError(`Invalid sample index '${r[x]}'.`));let m;if(o){const x=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,b=Math.max.apply(null,this.fileDirectory.BitsPerSample);m=we(x,b,g*r.length),l&&m.fill(l)}else{m=[];for(let x=0;x<r.length;++x){const b=this.getArrayForSample(r[x],g);Array.isArray(l)&&x<l.length?b.fill(l[x]):l&&!Array.isArray(l)&&b.fill(l),m.push(b)}}const p=n||await dr(this.fileDirectory);return await this._readRaster(u,r,m,o,p,i,s,a,c)}async readRGB({window:e,interleave:r=!0,pool:o=null,width:n,height:i,resampleMethod:s,enableAlpha:a=!1,signal:l}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=this.fileDirectory.PhotometricInterpretation;if(u===P.RGB){let T=[0,1,2];if(this.fileDirectory.ExtraSamples!==er.Unspecified&&a){T=[];for(let x=0;x<this.fileDirectory.BitsPerSample.length;x+=1)T.push(x)}return this.readRasters({window:e,interleave:r,samples:T,pool:o,width:n,height:i,resampleMethod:s,signal:l})}let h;switch(u){case P.WhiteIsZero:case P.BlackIsZero:case P.Palette:h=[0];break;case P.CMYK:h=[0,1,2,3];break;case P.YCbCr:case P.CIELab:h=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const y={window:c,interleave:!0,samples:h,pool:o,width:n,height:i,resampleMethod:s,signal:l},{fileDirectory:g}=this,d=await this.readRasters(y),m=2**this.fileDirectory.BitsPerSample[0];let p;switch(u){case P.WhiteIsZero:p=rr(d,m);break;case P.BlackIsZero:p=nr(d,m);break;case P.Palette:p=ir(d,g.ColorMap);break;case P.CMYK:p=or(d);break;case P.YCbCr:p=sr(d);break;case P.CIELab:p=fr(d);break;default:throw new Error("Unsupported photometric interpretation.")}if(!r){const T=new Uint8Array(p.length/3),x=new Uint8Array(p.length/3),b=new Uint8Array(p.length/3);for(let E=0,A=0;E<p.length;E+=3,++A)T[A]=p[E],x[A]=p[E+1],b[A]=p[E+2];p=[T,x,b]}return p.width=d.width,p.height=d.height,p}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let r=0;r<this.fileDirectory.ModelTiepoint.length;r+=6)e.push({i:this.fileDirectory.ModelTiepoint[r],j:this.fileDirectory.ModelTiepoint[r+1],k:this.fileDirectory.ModelTiepoint[r+2],x:this.fileDirectory.ModelTiepoint[r+3],y:this.fileDirectory.ModelTiepoint[r+4],z:this.fileDirectory.ModelTiepoint[r+5]});return e}getGDALMetadata(e=null){const r={};if(!this.fileDirectory.GDAL_METADATA)return null;const o=this.fileDirectory.GDAL_METADATA;let n=Qt(o,"Item");e===null?n=n.filter(i=>me(i,"sample")===void 0):n=n.filter(i=>Number(me(i,"sample"))===e);for(let i=0;i<n.length;++i){const s=n[i];r[me(s,"name")]=s.inner}return r}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,r=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(r)return[r[3],r[7],r[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const r=this.fileDirectory.ModelPixelScale,o=this.fileDirectory.ModelTransformation;if(r)return[r[0],-r[1],r[2]];if(o)return o[1]===0&&o[4]===0?[o[0],-o[5],o[10]]:[Math.sqrt(o[0]*o[0]+o[4]*o[4]),-Math.sqrt(o[1]*o[1]+o[5]*o[5]),o[10]];if(e){const[n,i,s]=e.getResolution();return[n*e.getWidth()/this.getWidth(),i*e.getHeight()/this.getHeight(),s*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const r=this.getHeight(),o=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[n,i,s,a,l,c,u,h]=this.fileDirectory.ModelTransformation,g=[[0,0],[0,r],[o,0],[o,r]].map(([p,T])=>[a+n*p+i*T,h+l*p+c*T]),d=g.map(p=>p[0]),m=g.map(p=>p[1]);return[Math.min(...d),Math.min(...m),Math.max(...d),Math.max(...m)]}else{const n=this.getOrigin(),i=this.getResolution(),s=n[0],a=n[1],l=s+i[0]*o,c=a+i[1]*r;return[Math.min(s,l),Math.min(a,c),Math.max(s,l),Math.max(a,c)]}}}class Sr{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,r){const o=this.getUint32(e,r),n=this.getUint32(e+4,r);let i;if(r){if(i=o+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*o+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}getInt64(e,r){let o=0;const n=(this._dataView.getUint8(e+(r?7:0))&128)>0;let i=!0;for(let s=0;s<8;s++){let a=this._dataView.getUint8(e+(r?s:7-s));n&&(i?a!==0&&(a=~(a-1)&255,i=!1):a=~a&255),o+=a*256**s}return n&&(o=-o),o}getUint8(e,r){return this._dataView.getUint8(e,r)}getInt8(e,r){return this._dataView.getInt8(e,r)}getUint16(e,r){return this._dataView.getUint16(e,r)}getInt16(e,r){return this._dataView.getInt16(e,r)}getUint32(e,r){return this._dataView.getUint32(e,r)}getInt32(e,r){return this._dataView.getInt32(e,r)}getFloat16(e,r){return We(this._dataView,e,r)}getFloat32(e,r){return this._dataView.getFloat32(e,r)}getFloat64(e,r){return this._dataView.getFloat64(e,r)}}class Dr{constructor(e,r,o,n){this._dataView=new DataView(e),this._sliceOffset=r,this._littleEndian=o,this._bigTiff=n}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,r){return this.sliceOffset<=e&&this.sliceTop>=e+r}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const r=this.readUint32(e),o=this.readUint32(e+4);let n;if(this._littleEndian){if(n=r+2**32*o,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*r+o,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}readInt64(e){let r=0;const o=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let n=!0;for(let i=0;i<8;i++){let s=this._dataView.getUint8(e+(this._littleEndian?i:7-i));o&&(n?s!==0&&(s=~(s-1)&255,n=!1):s=~s&255),r+=s*256**i}return o&&(r=-r),r}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}class Ir{async fetch(e,r=void 0){return Promise.all(e.map(o=>this.fetchSlice(o,r)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class ve extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,ve),this.name="AbortError"}}class vr extends Ir{constructor(e){super(),this.arrayBuffer=e}fetchSlice(e,r){if(r&&r.aborted)throw new ve("Request aborted");return this.arrayBuffer.slice(e.offset,e.offset+e.length)}}function _r(t){return new vr(t)}function Te(t){switch(t){case w.BYTE:case w.ASCII:case w.SBYTE:case w.UNDEFINED:return 1;case w.SHORT:case w.SSHORT:return 2;case w.LONG:case w.SLONG:case w.FLOAT:case w.IFD:return 4;case w.RATIONAL:case w.SRATIONAL:case w.DOUBLE:case w.LONG8:case w.SLONG8:case w.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${t}`)}}function Pr(t){const e=t.GeoKeyDirectory;if(!e)return null;const r={};for(let o=4;o<=e[3]*4;o+=4){const n=tr[e[o]],i=e[o+1]?$[e[o+1]]:null,s=e[o+2],a=e[o+3];let l=null;if(!i)l=a;else{if(l=t[i],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${n}'.`);typeof l=="string"?l=l.substring(a,a+s-1):l.subarray&&(l=l.subarray(a,a+s),s===1&&(l=l[0]))}r[n]=l}return r}function N(t,e,r,o){let n=null,i=null;const s=Te(e);switch(e){case w.BYTE:case w.ASCII:case w.UNDEFINED:n=new Uint8Array(r),i=t.readUint8;break;case w.SBYTE:n=new Int8Array(r),i=t.readInt8;break;case w.SHORT:n=new Uint16Array(r),i=t.readUint16;break;case w.SSHORT:n=new Int16Array(r),i=t.readInt16;break;case w.LONG:case w.IFD:n=new Uint32Array(r),i=t.readUint32;break;case w.SLONG:n=new Int32Array(r),i=t.readInt32;break;case w.LONG8:case w.IFD8:n=new Array(r),i=t.readUint64;break;case w.SLONG8:n=new Array(r),i=t.readInt64;break;case w.RATIONAL:n=new Uint32Array(r*2),i=t.readUint32;break;case w.SRATIONAL:n=new Int32Array(r*2),i=t.readInt32;break;case w.FLOAT:n=new Float32Array(r),i=t.readFloat32;break;case w.DOUBLE:n=new Float64Array(r),i=t.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===w.RATIONAL||e===w.SRATIONAL)for(let a=0;a<r;a+=2)n[a]=i.call(t,o+a*s),n[a+1]=i.call(t,o+(a*s+4));else for(let a=0;a<r;++a)n[a]=i.call(t,o+a*s);return e===w.ASCII?new TextDecoder("utf-8").decode(n):n}class Rr{constructor(e,r,o){this.fileDirectory=e,this.geoKeyDirectory=r,this.nextIFDByteOffset=o}}class ue extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Ur{async readRasters(e={}){const{window:r,width:o,height:n}=e;let{resX:i,resY:s,bbox:a}=e;const l=await this.getImage();let c=l;const u=await this.getImageCount(),h=l.getBoundingBox();if(r&&a)throw new Error('Both "bbox" and "window" passed.');if(o||n){if(r){const[d,m]=l.getOrigin(),[p,T]=l.getResolution();a=[d+r[0]*p,m+r[1]*T,d+r[2]*p,m+r[3]*T]}const g=a||h;if(o){if(i)throw new Error("Both width and resX passed");i=(g[2]-g[0])/o}if(n){if(s)throw new Error("Both width and resY passed");s=(g[3]-g[1])/n}}if(i||s){const g=[];for(let d=0;d<u;++d){const m=await this.getImage(d),{SubfileType:p,NewSubfileType:T}=m.fileDirectory;(d===0||p===2||T&1)&&g.push(m)}g.sort((d,m)=>d.getWidth()-m.getWidth());for(let d=0;d<g.length;++d){const m=g[d],p=(h[2]-h[0])/m.getWidth(),T=(h[3]-h[1])/m.getHeight();if(c=m,i&&i>p||s&&s>T)break}}let y=r;if(a){const[g,d]=l.getOrigin(),[m,p]=c.getResolution(l);y=[Math.round((a[0]-g)/m),Math.round((a[1]-d)/p),Math.round((a[2]-g)/m),Math.round((a[3]-d)/p)],y=[Math.min(y[0],y[2]),Math.min(y[1],y[3]),Math.max(y[0],y[2]),Math.max(y[1],y[3])]}return c.readRasters({...e,window:y})}}class _e extends Ur{constructor(e,r,o,n,i={}){super(),this.source=e,this.littleEndian=r,this.bigTiff=o,this.firstIFDOffset=n,this.cache=i.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,r){const o=this.bigTiff?4048:1024;return new Dr((await this.source.fetch([{offset:e,length:typeof r<"u"?r:o}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const r=this.bigTiff?20:12,o=this.bigTiff?8:2;let n=await this.getSlice(e);const i=this.bigTiff?n.readUint64(e):n.readUint16(e),s=i*r+(this.bigTiff?16:6);n.covers(e,s)||(n=await this.getSlice(e,s));const a={};let l=e+(this.bigTiff?8:2);for(let h=0;h<i;l+=r,++h){const y=n.readUint16(l),g=n.readUint16(l+2),d=this.bigTiff?n.readUint64(l+4):n.readUint32(l+4);let m,p;const T=Te(g),x=l+(this.bigTiff?12:8);if(T*d<=(this.bigTiff?8:4))m=N(n,g,d,x);else{const b=n.readOffset(x),E=Te(g)*d;if(n.covers(b,E))m=N(n,g,d,b);else{const A=await this.getSlice(b,E);m=N(A,g,d,b)}}d===1&&Wt.indexOf(y)===-1&&!(g===w.RATIONAL||g===w.SRATIONAL)?p=m[0]:p=m,a[$[y]]=p}const c=Pr(a),u=n.readOffset(e+o+r*i);return new Rr(a,c,u)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(r){throw r instanceof ue?new ue(e):r}return this.ifdRequests[e]=(async()=>{const r=await this.ifdRequests[e-1];if(r.nextIFDByteOffset===0)throw new ue(e);return this.parseFileDirectoryAt(r.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const r=await this.requestIFD(e);return new Ar(r.fileDirectory,r.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,r=!0;for(;r;)try{await this.requestIFD(e),++e}catch(o){if(o instanceof ue)r=!1;else throw o}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const r="GDAL_STRUCTURAL_METADATA_SIZE=",o=r.length+100;let n=await this.getSlice(e,o);if(r===N(n,w.ASCII,r.length,e)){const s=N(n,w.ASCII,o,e).split(`
`)[0],a=Number(s.split("=")[1].split(" ")[0])+s.length;a>o&&(n=await this.getSlice(e,a));const l=N(n,w.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(c=>c.length>0).map(c=>c.split("=")).forEach(([c,u])=>{this.ghostValues[c]=u})}return this.ghostValues}static async fromSource(e,r,o){const n=(await e.fetch([{offset:0,length:1024}],o))[0],i=new Sr(n),s=i.getUint16(0,0);let a;if(s===18761)a=!0;else if(s===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=i.getUint16(2,a);let c;if(l===42)c=!1;else if(l===43){if(c=!0,i.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const u=c?i.getUint64(8,a):i.getUint32(4,a);return new _e(e,a,c,u,r)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function Br(t,e){return _e.fromSource(_r(t),e)}const Or="/demdag-web/assets/d8_discovery-DIlOFSey.tif",Gr="/demdag-web/assets/d8_finish-Bx5Xn6p1.tif",Mr="/demdag-web/assets/d8_bg-CjKuwq6_.jpg",Lr="/demdag-web/assets/helens_fdr_discovery-CKLjcKoa.tif",Fr="/demdag-web/assets/helens_fdr_finish-BCrm6vHq.tif",Cr="/demdag-web/assets/helens_bg-Bc-HqWEv.jpg";var O=[],F=1,f,D,H=[],Z=[.25,.5,1,2,4,8,16],L=2,rt=0,he=!1;const Nr=100;var Pe=1;const M=document.getElementById("area-summary");function nt(t){console.debug("zoom: ",t);let e=document.getElementById("canvas");e.style.width=`${f.canvas.width*t}px`,e.style.height=`${f.canvas.height*t}px`;let r=document.getElementById("zoom");r.innerHTML=t,Re()}function it(t){let e=L+t;e<0&&(e=0),e>=Z.length&&(e=Z.length-1),L=e,F=Z[L],nt(F)}function kr(t,e){const r=new Image;return r.crossOrigin="Anonymous",r.src=t,r.onload=e,r}let xe={};async function Kr(t){if(!xe?.[t]){let e;console.debug("fetching:",t);const o=await(await fetch(t)).arrayBuffer(),i=await(await Br(o)).getImage(),s=i.getWidth(),a=i.getHeight();if(t.includes("_discovery")||t.includes("_finish")){const l=await i.readRasters(),c=new Uint8ClampedArray(l[0].length*4);for(let h=0;h<a;h++)for(let y=0;y<s;y++){const g=h*s+y,d=4*h*s+4*y,m=l[0][g];c[d]=m&255,c[d+1]=m>>8&255,c[d+2]=m>>16&255,c[d+3]=m>>24&255}const u={data:c,width:s,height:a};console.debug("data: ",u,t),e=u}else{const l=await i.readRGB(),c=document.createElement("canvas");c.width=s,c.height=a;const u=c.getContext("2d",{willReadFrequently:!0}),h=u.getImageData(0,0,s,a),y=h.data;for(let g=0;g<a;g++)for(let d=0;d<s;d++){const m=3*g*s+3*d,p=4*g*s+4*d;y[p]=l[m],y[p+1]=l[m+1],y[p+2]=l[m+2],y[p+3]=255}console.debug("imdata: ",h),u.putImageData(h,0,0),e=h}xe[t]=e}return xe[t]}async function ot(t,e){var r=t.length;O=[];var o=function(){--r,console.debug("loaded img."),r===0&&(console.debug("images:",O),e(O))};console.debug("urls:",t);for(var n=0;n<t.length;++n){const i=t[n];console.debug("loading: ",i);let s;i.endsWith(".tif")||i.endsWith(".tiff")?(s=await Kr(i),O.push(s),o()):(s=await kr(i,o),O.push(s))}}function st(){try{Vr()}catch(t){console.error(t)}}const Vr=zr(jr,1e3/60);function jr(){if(!(!(O.length>0)||!(O[0]?.width>0))){var t=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,t),Yr(f,0,0,O[0].width,O[0].height);var e=f.getAttribLocation(D,"a_position"),r=f.getAttribLocation(D,"a_texCoord"),o=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,o),f.bufferData(f.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),f.STATIC_DRAW);var n=f.getUniformLocation(D,"u_resolution"),i=f.getUniformLocation(D,"u_mouse"),s=f.getUniformLocation(D,"u_zoom"),a=f.getUniformLocation(D,"u_image0"),l=f.getUniformLocation(D,"u_image1"),c=f.getUniformLocation(D,"u_image2");f.useProgram(D),f.enableVertexAttribArray(e),f.bindBuffer(f.ARRAY_BUFFER,t);var u=2,h=f.FLOAT,y=!1,g=0,d=0;f.vertexAttribPointer(e,u,h,y,g,d),f.enableVertexAttribArray(r),f.bindBuffer(f.ARRAY_BUFFER,o);var u=2,h=f.FLOAT,y=!1,g=0,d=0;f.vertexAttribPointer(r,u,h,y,g,d),f.uniform2f(n,f.canvas.width,f.canvas.height),f.uniform2f(i,J.x,J.y),f.uniform1f(s,F),f.uniform1i(a,0),f.uniform1i(l,1),f.uniform1i(c,2),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,H[0]),f.activeTexture(f.TEXTURE1),f.bindTexture(f.TEXTURE_2D,H[1]),f.activeTexture(f.TEXTURE2),f.bindTexture(f.TEXTURE_2D,H[2]),f.drawArrays(f.TRIANGLES,0,6),he&&qr(),f.finish()}}function qr(){const t=f.canvas.width,e=f.canvas.height,r=new Uint8Array(t*e*4);f.readPixels(0,0,t,e,f.RGBA,f.UNSIGNED_BYTE,r);let o=0;for(let n=0;n<e;n++)for(let i=0;i<t;i++){const s=4*n*t+4*i;r[s+2]>=255&&(o+=1)}rt=o}function at(t){if(t.length===0){console.error("No Images!");return}var e=document.getElementById("canvas");if(f=e.getContext("webgl",{antialias:!1}),!f){console.error("Cannot attach as webgl canvas to the document!");return}const r=["vertex-shader-2d","fragment-shader-2d"],o=[];for(let c=0;c<r.length;++c){let u="",h,y=r[c];const g=document.getElementById(y);if(!g)throw"*** Error: unknown script element"+y;if(u=`
${g.text}`,g.type==="x-shader/x-vertex")h=f.VERTEX_SHADER;else if(g.type==="x-shader/x-fragment")h=f.FRAGMENT_SHADER;else if(h!==f.VERTEX_SHADER&&h!==f.FRAGMENT_SHADER)throw"*** Error: unknown shader type";const m=f.createShader(h);if(f.shaderSource(m,u),f.compileShader(m),!f.getShaderParameter(m,f.COMPILE_STATUS)){const T=f.getShaderInfoLog(m);return console.error("*** Error compiling shader '"+m+"':"+T+`
`+u.split(`
`).map((x,b)=>`${b+1}: ${x}`).join(`
`)),f.deleteShader(m),null}o.push(m)}if(D=f.createProgram(),o.forEach(function(c){f.attachShader(D,c)}),f.linkProgram(D),!f.getProgramParameter(D,f.LINK_STATUS)){const c=f.getProgramInfoLog(D);return console.error("Error in program linking:"+c),f.deleteProgram(D),null}f.useProgram(D),H=[];for(var i=0;i<t.length;++i){var s=f.createTexture();f.bindTexture(f.TEXTURE_2D,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),t[i]?.data?f.texImage2D(f.TEXTURE_2D,0,f.RGBA,t[i].width,t[i].height,0,f.RGBA,f.UNSIGNED_BYTE,t[i].data):f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,t[i]),H.push(s)}let a=t[0].width,l=t[0].height;if(a>=4096||l>4096){alert("texture too large!"),it(-1);return}f.canvas.width=a,f.canvas.height=l,f.viewport(0,0,f.canvas.width,f.canvas.height),st(),nt(F)}function Yr(t,e,r,o,n){var i=e,s=e+o,a=r,l=r+n;t.bufferData(t.ARRAY_BUFFER,new Float32Array([i,a,s,a,i,l,i,l,s,a,s,l]),t.STATIC_DRAW)}var J={x:1e6,y:1e6};function Xr(t,e){e=e||t.target;var r=e.getBoundingClientRect();return{x:t.clientX-r.left,y:t.clientY-r.top}}function zr(t,e){var r;return function(o){r||(r=setTimeout(()=>(t(o),r=void 0),e))}}function $r(t,e){e=e||t.target;var r=Xr(t,e);return r.x=r.x*e.width/e.clientWidth,r.y=r.y*e.height/e.clientHeight,r}const Hr=function(){let t=!1;return(function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)})(navigator.userAgent||navigator.vendor||window.opera),t};function Zr(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}const Jr=Zr()||Hr();let be=0;document.querySelector("#canvas").addEventListener("touchstart",function(t){be++,t.touches.length===1&&be===1&&t.preventDefault()},{passive:!1});document.querySelector("#canvas").addEventListener("touchend",function(t){be=0});const Qr=t=>{const e=$r(t),r=Jr*50/F;J.x=e.x,J.y=e.y-r,console.debug("mousePos",J),st(),he&&ut()};document.querySelector("#canvas").addEventListener("pointermove",Qr);document.addEventListener("scroll",Re);async function Wr(){L=4,F=Z[L],await ot([Or,Gr,Mr],at)}async function en(){L=0,F=Z[L],await ot([Lr,Fr,Cr],at)}async function ct(t){t||(t=new URLSearchParams(window.location.search).get("example")),t=="lg"?(window.history.pushState({},document.title,"./?example=lg"),en()):(window.history.pushState({},document.title,"./"),Wr()),Re()}function lt(t){Pe=t,ut(),ft()}function ft(){Pe?(he=!0,M.style.display=""):(he=!1,M.style.display="none")}document.querySelector("#canvas").addEventListener("mouseenter",ft);document.querySelector("#canvas").addEventListener("mouseexit",()=>{M.style.display="none"});function Re(){console.debug("locating hud");let t=document.getElementById("canvas").getBoundingClientRect();M.style.top=t.top+15+"px",M.style.left=t.left+15+"px",t.top<0&&(M.style.top="15px"),t.left<0&&(M.style.left="15px")}function ut(){let e=(rt*Nr*Pe).toLocaleString(void 0,{maximumFractionDigits:1}),r=document.getElementById("area_value");r.innerText=e}const Ke=[{id:"acres",label:"Acres",from_sqm:1/4046.86},{id:"sqmi",label:"Sq Mi",from_sqm:1/2589988110336e-6},{id:"sqm",label:"Sq M",from_sqm:1},{id:"sqkm",label:"Sq Km",from_sqm:1/1e3},{id:"pixels",label:"Pixels",from_sqm:1/100},{id:"none",label:"None",from_sqm:0}];function tn(){let t=document.getElementById("area-units"),e=t.innerHTML;for(const n of Ke)e+=`
    <div>
      <input type="radio" id="units-${n.id}" name="units" value="${n.id}" onChange=changeUnits(${n.from_sqm})>
      <label for="units-${n.id}" >${n.label}</label>
    </div>
    `;t.innerHTML=e;let r=Ke.at(-1),o=document.querySelector(`input[id='units-${r.id}']`);o.checked=!0,lt(r.from_sqm)}window.main=ct;window.adjustZoom=it;window.changeUnits=lt;tn();ct();export{rn as L,nn as a,et as g};
