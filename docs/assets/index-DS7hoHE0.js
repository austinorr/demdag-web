const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/raw-Dt1HMqYc.js","assets/basedecoder-DvumDe3Y.js","assets/lzw-DpvbRwG5.js","assets/jpeg-CdeCw_eT.js","assets/deflate-CUkHh1nh.js","assets/pako.esm-CPws4d4z.js","assets/packbits-DQnG8s9w.js","assets/lerc-CpRvyOMA.js","assets/webimage-BcnuJlio.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();function S(r){return(e,...t)=>ht(r,e,t)}function N(r,e){return S(ve(r,e).get)}const{apply:ht,construct:Cr,defineProperty:Nr,get:Vr,getOwnPropertyDescriptor:ve,getPrototypeOf:de,has:Kr,ownKeys:ut,set:jr,setPrototypeOf:kr}=Reflect,{iterator:Z,species:Xr,toStringTag:gt,for:Yr}=Symbol,dt=Object,{create:ye,defineProperty:yt,freeze:$r,is:zr}=dt,xt=Array,pt=xt.prototype,Ge=pt[Z],mt=S(Ge),Be=ArrayBuffer,wt=Be.prototype;N(wt,"byteLength");const Re=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Re&&N(Re.prototype,"byteLength");const Fe=de(Uint8Array);Fe.from;const _=Fe.prototype;_[Z];S(_.keys);S(_.values);S(_.entries);S(_.set);S(_.reverse);S(_.fill);S(_.copyWithin);S(_.sort);S(_.slice);S(_.subarray);N(_,"buffer");N(_,"byteOffset");N(_,"length");N(_,gt);const Tt=Uint8Array,Le=Uint16Array,xe=Uint32Array,Et=Float32Array,H=de([][Z]()),Me=S(H.next),At=S(function*(){}().next),bt=de(H),St=DataView.prototype,Dt=S(St.getUint16),pe=WeakMap,Ce=pe.prototype,Ne=S(Ce.get),It=S(Ce.set),Ve=new pe,_t=ye(null,{next:{value:function(){const e=Ne(Ve,this);return Me(e)}},[Z]:{value:function(){return this}}});function Pt(r){if(r[Z]===Ge&&H.next===Me)return r;const e=ye(_t);return It(Ve,e,mt(r)),e}const Rt=new pe,Ot=ye(bt,{next:{value:function(){const e=Ne(Rt,this);return At(e)},writable:!0,configurable:!0}});for(const r of ut(H))r!=="next"&&yt(Ot,r,ve(H,r));const Ke=new Be(4),Ut=new Et(Ke),vt=new xe(Ke),O=new Le(512),U=new Tt(512);for(let r=0;r<256;++r){const e=r-127;e<-24?(O[r]=0,O[r|256]=32768,U[r]=24,U[r|256]=24):e<-14?(O[r]=1024>>-e-14,O[r|256]=1024>>-e-14|32768,U[r]=-e-1,U[r|256]=-e-1):e<=15?(O[r]=e+15<<10,O[r|256]=e+15<<10|32768,U[r]=13,U[r|256]=13):e<128?(O[r]=31744,O[r|256]=64512,U[r]=24,U[r|256]=24):(O[r]=31744,O[r|256]=64512,U[r]=13,U[r|256]=13)}const me=new xe(2048);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,me[r]=e|t}for(let r=1024;r<2048;++r)me[r]=939524096+(r-1024<<13);const V=new xe(64);for(let r=1;r<31;++r)V[r]=r<<23;V[31]=1199570944;V[32]=2147483648;for(let r=33;r<63;++r)V[r]=2147483648+(r-32<<23);V[63]=3347054592;const je=new Le(64);for(let r=1;r<64;++r)r!==32&&(je[r]=1024);function Gt(r){const e=r>>10;return vt[0]=me[je[e]+(r&1023)]+V[e],Ut[0]}function ke(r,e,...t){return Gt(Dt(r,e,...Pt(t)))}function Xe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var we={exports:{}};function Ye(r,e,t){const o=t&&t.debug||!1;o&&console.log("[xml-utils] getting "+e+" in "+r);const n=typeof r=="object"?r.outer:r,i=n.slice(0,n.indexOf(">")+1),a=['"',"'"];for(let s=0;s<a.length;s++){const c=a[s],f=e+"\\="+c+"([^"+c+"]*)"+c;o&&console.log("[xml-utils] pattern:",f);const u=new RegExp(f).exec(i);if(o&&console.log("[xml-utils] match:",u),u)return u[1]}}we.exports=Ye;we.exports.default=Ye;var Bt=we.exports;const ce=Xe(Bt);var Te={exports:{}},Ee={exports:{}},Ae={exports:{}};function $e(r,e,t){const n=new RegExp(e).exec(r.slice(t));return n?t+n.index:-1}Ae.exports=$e;Ae.exports.default=$e;var Ft=Ae.exports,be={exports:{}};function ze(r,e,t){const n=new RegExp(e).exec(r.slice(t));return n?t+n.index+n[0].length-1:-1}be.exports=ze;be.exports.default=ze;var Lt=be.exports,Se={exports:{}};function qe(r,e){const t=new RegExp(e,"g"),o=r.match(t);return o?o.length:0}Se.exports=qe;Se.exports.default=qe;var Mt=Se.exports;const Ct=Ft,le=Lt,Oe=Mt;function He(r,e,t){const o=t&&t.debug||!1,n=!(t&&typeof t.nested===!1),i=t&&t.startIndex||0;o&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const a=Ct(r,`<${e}[ 
>/]`,i);if(o&&console.log("[xml-utils] start:",a),a===-1)return;const s=r.slice(a+e.length);let c=le(s,"^[^<]*[ /]>",0);const f=c!==-1&&s[c-1]==="/";if(o&&console.log("[xml-utils] selfClosing:",f),f===!1)if(n){let h=0,d=1,p=0;for(;(c=le(s,"[ /]"+e+">",h))!==-1;){const x=s.substring(h,c+1);if(d+=Oe(x,"<"+e+`[ 
	>]`),p+=Oe(x,"</"+e+">"),p>=d)break;h=c}}else c=le(s,"[ /]"+e+">",0);const g=a+e.length+c+1;if(o&&console.log("[xml-utils] end:",g),g===-1)return;const u=r.slice(a,g);let y;return f?y=null:y=u.slice(u.indexOf(">")+1,u.lastIndexOf("<")),{inner:y,outer:u,start:a,end:g}}Ee.exports=He;Ee.exports.default=He;var Nt=Ee.exports;const Vt=Nt;function Ze(r,e,t){const o=[],n=t&&t.debug||!1,i=t&&typeof t.nested=="boolean"?t.nested:!0;let a=t&&t.startIndex||0,s;for(;s=Vt(r,e,{debug:n,startIndex:a});)i?a=s.start+1+e.length:a=s.end,o.push(s);return n&&console.log("findTagsByName found",o.length,"tags"),o}Te.exports=Ze;Te.exports.default=Ze;var Kt=Te.exports;const jt=Xe(Kt),$={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},v={};for(const r in $)$.hasOwnProperty(r)&&(v[$[r]]=parseInt(r,10));const kt=[v.BitsPerSample,v.ExtraSamples,v.SampleFormat,v.StripByteCounts,v.StripOffsets,v.StripRowCounts,v.TileByteCounts,v.TileOffsets,v.SubIFDs],fe={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},w={};for(const r in fe)fe.hasOwnProperty(r)&&(w[fe[r]]=parseInt(r,10));const R={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},Xt={Unspecified:0,Assocalpha:1,Unassalpha:2},qr={Version:0,AddCompression:1},Hr={None:0,Deflate:1,Zstandard:2},Yt={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function $t(r,e){const{width:t,height:o}=r,n=new Uint8Array(t*o*3);let i;for(let a=0,s=0;a<r.length;++a,s+=3)i=256-r[a]/e*256,n[s]=i,n[s+1]=i,n[s+2]=i;return n}function zt(r,e){const{width:t,height:o}=r,n=new Uint8Array(t*o*3);let i;for(let a=0,s=0;a<r.length;++a,s+=3)i=r[a]/e*256,n[s]=i,n[s+1]=i,n[s+2]=i;return n}function qt(r,e){const{width:t,height:o}=r,n=new Uint8Array(t*o*3),i=e.length/3,a=e.length/3*2;for(let s=0,c=0;s<r.length;++s,c+=3){const f=r[s];n[c]=e[f]/65536*256,n[c+1]=e[f+i]/65536*256,n[c+2]=e[f+a]/65536*256}return n}function Ht(r){const{width:e,height:t}=r,o=new Uint8Array(e*t*3);for(let n=0,i=0;n<r.length;n+=4,i+=3){const a=r[n],s=r[n+1],c=r[n+2],f=r[n+3];o[i]=255*((255-a)/256)*((255-f)/256),o[i+1]=255*((255-s)/256)*((255-f)/256),o[i+2]=255*((255-c)/256)*((255-f)/256)}return o}function Zt(r){const{width:e,height:t}=r,o=new Uint8ClampedArray(e*t*3);for(let n=0,i=0;n<r.length;n+=3,i+=3){const a=r[n],s=r[n+1],c=r[n+2];o[i]=a+1.402*(c-128),o[i+1]=a-.34414*(s-128)-.71414*(c-128),o[i+2]=a+1.772*(s-128)}return o}const Jt=.95047,Qt=1,Wt=1.08883;function er(r){const{width:e,height:t}=r,o=new Uint8Array(e*t*3);for(let n=0,i=0;n<r.length;n+=3,i+=3){const a=r[n+0],s=r[n+1]<<24>>24,c=r[n+2]<<24>>24;let f=(a+16)/116,g=s/500+f,u=f-c/200,y,h,d;g=Jt*(g*g*g>.008856?g*g*g:(g-16/116)/7.787),f=Qt*(f*f*f>.008856?f*f*f:(f-16/116)/7.787),u=Wt*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),y=g*3.2406+f*-1.5372+u*-.4986,h=g*-.9689+f*1.8758+u*.0415,d=g*.0557+f*-.204+u*1.057,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,o[i]=Math.max(0,Math.min(1,y))*255,o[i+1]=Math.max(0,Math.min(1,h))*255,o[i+2]=Math.max(0,Math.min(1,d))*255}return o}const tr="modulepreload",rr=function(r){return"/demdag-web/"+r},Ue={},L=function(e,t,o){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(t.map(c=>{if(c=rr(c),c in Ue)return;Ue[c]=!0;const f=c.endsWith(".css"),g=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${g}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":tr,f||(u.as="script"),u.crossOrigin="",u.href=c,s&&u.setAttribute("nonce",s),document.head.appendChild(u),f)return new Promise((y,h)=>{u.addEventListener("load",y),u.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return n.then(a=>{for(const s of a||[])s.status==="rejected"&&i(s.reason);return e().catch(i)})},Je=new Map;function F(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>Je.set(t,e))}async function nr(r){const e=Je.get(r.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const t=await e();return new t(r)}F([void 0,1],()=>L(()=>import("./raw-Dt1HMqYc.js"),__vite__mapDeps([0,1])).then(r=>r.default));F(5,()=>L(()=>import("./lzw-DpvbRwG5.js"),__vite__mapDeps([2,1])).then(r=>r.default));F(6,()=>{throw new Error("old style JPEG compression is not supported.")});F(7,()=>L(()=>import("./jpeg-CdeCw_eT.js"),__vite__mapDeps([3,1])).then(r=>r.default));F([8,32946],()=>L(()=>import("./deflate-CUkHh1nh.js"),__vite__mapDeps([4,5,1])).then(r=>r.default));F(32773,()=>L(()=>import("./packbits-DQnG8s9w.js"),__vite__mapDeps([6,1])).then(r=>r.default));F(34887,()=>L(()=>import("./lerc-CpRvyOMA.js"),__vite__mapDeps([7,5,1])).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));F(50001,()=>L(()=>import("./webimage-BcnuJlio.js"),__vite__mapDeps([8,1])).then(r=>r.default));function oe(r,e,t,o=1){return new(Object.getPrototypeOf(r)).constructor(e*t*o)}function ir(r,e,t,o,n){const i=e/o,a=t/n;return r.map(s=>{const c=oe(s,o,n);for(let f=0;f<n;++f){const g=Math.min(Math.round(a*f),t-1);for(let u=0;u<o;++u){const y=Math.min(Math.round(i*u),e-1),h=s[g*e+y];c[f*o+u]=h}}return c})}function C(r,e,t){return(1-t)*r+t*e}function or(r,e,t,o,n){const i=e/o,a=t/n;return r.map(s=>{const c=oe(s,o,n);for(let f=0;f<n;++f){const g=a*f,u=Math.floor(g),y=Math.min(Math.ceil(g),t-1);for(let h=0;h<o;++h){const d=i*h,p=d%1,x=Math.floor(d),T=Math.min(Math.ceil(d),e-1),m=s[u*e+x],E=s[u*e+T],A=s[y*e+x],b=s[y*e+T],P=C(C(m,E,p),C(A,b,p),g%1);c[f*o+h]=P}}return c})}function sr(r,e,t,o,n,i="nearest"){switch(i.toLowerCase()){case"nearest":return ir(r,e,t,o,n);case"bilinear":case"linear":return or(r,e,t,o,n);default:throw new Error(`Unsupported resampling method: '${i}'`)}}function ar(r,e,t,o,n,i){const a=e/o,s=t/n,c=oe(r,o,n,i);for(let f=0;f<n;++f){const g=Math.min(Math.round(s*f),t-1);for(let u=0;u<o;++u){const y=Math.min(Math.round(a*u),e-1);for(let h=0;h<i;++h){const d=r[g*e*i+y*i+h];c[f*o*i+u*i+h]=d}}}return c}function cr(r,e,t,o,n,i){const a=e/o,s=t/n,c=oe(r,o,n,i);for(let f=0;f<n;++f){const g=s*f,u=Math.floor(g),y=Math.min(Math.ceil(g),t-1);for(let h=0;h<o;++h){const d=a*h,p=d%1,x=Math.floor(d),T=Math.min(Math.ceil(d),e-1);for(let m=0;m<i;++m){const E=r[u*e*i+x*i+m],A=r[u*e*i+T*i+m],b=r[y*e*i+x*i+m],P=r[y*e*i+T*i+m],K=C(C(E,A,p),C(b,P,p),g%1);c[f*o*i+h*i+m]=K}}}return c}function lr(r,e,t,o,n,i,a="nearest"){switch(a.toLowerCase()){case"nearest":return ar(r,e,t,o,n,i);case"bilinear":case"linear":return cr(r,e,t,o,n,i);default:throw new Error(`Unsupported resampling method: '${a}'`)}}function fr(r,e,t){let o=0;for(let n=e;n<t;++n)o+=r[n];return o}function ue(r,e,t){switch(r){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function hr(r,e){return(r===1||r===2)&&e<=32&&e%8===0?!1:!(r===3&&(e===16||e===32||e===64))}function ur(r,e,t,o,n,i,a){const s=new DataView(r),c=t===2?a*i:a*i*o,f=t===2?1:o,g=ue(e,n,c),u=parseInt("1".repeat(n),2);if(e===1){let y;t===1?y=o*n:y=n;let h=i*y;h&7&&(h=h+7&-8);for(let d=0;d<a;++d){const p=d*h;for(let x=0;x<i;++x){const T=p+x*f*n;for(let m=0;m<f;++m){const E=T+m*n,A=(d*i+x)*f+m,b=Math.floor(E/8),P=E%8;if(P+n<=8)g[A]=s.getUint8(b)>>8-n-P&u;else if(P+n<=16)g[A]=s.getUint16(b)>>16-n-P&u;else if(P+n<=24){const K=s.getUint16(b)<<8|s.getUint8(b+2);g[A]=K>>24-n-P&u}else g[A]=s.getUint32(b)>>32-n-P&u}}}}return g.buffer}class gr{constructor(e,t,o,n,i,a){this.fileDirectory=e,this.geoKeys=t,this.dataView=o,this.littleEndian=n,this.tiles=i?{}:null,this.isTiled=!e.StripOffsets;const s=e.PlanarConfiguration;if(this.planarConfiguration=typeof s>"u"?1:s,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=a}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,o=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(o<=8)return DataView.prototype.getUint8;if(o<=16)return DataView.prototype.getUint16;if(o<=32)return DataView.prototype.getUint32;break;case 2:if(o<=8)return DataView.prototype.getInt8;if(o<=16)return DataView.prototype.getInt16;if(o<=32)return DataView.prototype.getInt32;break;case 3:switch(o){case 16:return function(n,i){return ke(this,n,i)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const o=this.getSampleFormat(e),n=this.getBitsPerSample(e);return ue(o,n,t)}async getTileOrStrip(e,t,o,n,i){const a=Math.ceil(this.getWidth()/this.getTileWidth()),s=Math.ceil(this.getHeight()/this.getTileHeight());let c;const{tiles:f}=this;this.planarConfiguration===1?c=t*a+e:this.planarConfiguration===2&&(c=o*a*s+t*a+e);let g,u;this.isTiled?(g=this.fileDirectory.TileOffsets[c],u=this.fileDirectory.TileByteCounts[c]):(g=this.fileDirectory.StripOffsets[c],u=this.fileDirectory.StripByteCounts[c]);const y=(await this.source.fetch([{offset:g,length:u}],i))[0];let h;return f===null||!f[c]?(h=(async()=>{let d=await n.decode(this.fileDirectory,y);const p=this.getSampleFormat(),x=this.getBitsPerSample();return hr(p,x)&&(d=ur(d,p,this.planarConfiguration,this.getSamplesPerPixel(),x,this.getTileWidth(),this.getBlockHeight(t))),d})(),f!==null&&(f[c]=h)):h=f[c],{x:e,y:t,sample:o,data:await h}}async _readRaster(e,t,o,n,i,a,s,c,f){const g=this.getTileWidth(),u=this.getTileHeight(),y=this.getWidth(),h=this.getHeight(),d=Math.max(Math.floor(e[0]/g),0),p=Math.min(Math.ceil(e[2]/g),Math.ceil(y/g)),x=Math.max(Math.floor(e[1]/u),0),T=Math.min(Math.ceil(e[3]/u),Math.ceil(h/u)),m=e[2]-e[0];let E=this.getBytesPerPixel();const A=[],b=[];for(let D=0;D<t.length;++D)this.planarConfiguration===1?A.push(fr(this.fileDirectory.BitsPerSample,0,t[D])/8):A.push(0),b.push(this.getReaderForSample(t[D]));const P=[],{littleEndian:K}=this;for(let D=x;D<T;++D)for(let Q=d;Q<p;++Q){let se;this.planarConfiguration===1&&(se=this.getTileOrStrip(Q,D,0,i,f));for(let W=0;W<t.length;++W){const ee=W,_e=t[W];this.planarConfiguration===2&&(E=this.getSampleByteSize(_e),se=this.getTileOrStrip(Q,D,_e,i,f));const rt=se.then(j=>{const nt=j.data,it=new DataView(nt),ae=this.getBlockHeight(j.y),k=j.y*u,te=j.x*g,ot=k+ae,st=(j.x+1)*g,at=b[ee],ct=Math.min(ae,ae-(ot-e[3]),h-k),lt=Math.min(g,g-(st-e[2]),y-te);for(let X=Math.max(0,e[1]-k);X<ct;++X)for(let Y=Math.max(0,e[0]-te);Y<lt;++Y){const ft=(X*g+Y)*E,Pe=at.call(it,ft+A[ee],K);let re;n?(re=(X+k-e[1])*m*t.length+(Y+te-e[0])*t.length+ee,o[re]=Pe):(re=(X+k-e[1])*m+Y+te-e[0],o[ee][re]=Pe)}});P.push(rt)}}if(await Promise.all(P),a&&e[2]-e[0]!==a||s&&e[3]-e[1]!==s){let D;return n?D=lr(o,e[2]-e[0],e[3]-e[1],a,s,t.length,c):D=sr(o,e[2]-e[0],e[3]-e[1],a,s,c),D.width=a,D.height=s,D}return o.width=a||e[2]-e[0],o.height=s||e[3]-e[1],o}async readRasters({window:e,samples:t=[],interleave:o,pool:n=null,width:i,height:a,resampleMethod:s,fillValue:c,signal:f}={}){const g=e||[0,0,this.getWidth(),this.getHeight()];if(g[0]>g[2]||g[1]>g[3])throw new Error("Invalid subsets");const u=g[2]-g[0],y=g[3]-g[1],h=u*y,d=this.getSamplesPerPixel();if(!t||!t.length)for(let m=0;m<d;++m)t.push(m);else for(let m=0;m<t.length;++m)if(t[m]>=d)return Promise.reject(new RangeError(`Invalid sample index '${t[m]}'.`));let p;if(o){const m=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,E=Math.max.apply(null,this.fileDirectory.BitsPerSample);p=ue(m,E,h*t.length),c&&p.fill(c)}else{p=[];for(let m=0;m<t.length;++m){const E=this.getArrayForSample(t[m],h);Array.isArray(c)&&m<c.length?E.fill(c[m]):c&&!Array.isArray(c)&&E.fill(c),p.push(E)}}const x=n||await nr(this.fileDirectory);return await this._readRaster(g,t,p,o,x,i,a,s,f)}async readRGB({window:e,interleave:t=!0,pool:o=null,width:n,height:i,resampleMethod:a,enableAlpha:s=!1,signal:c}={}){const f=e||[0,0,this.getWidth(),this.getHeight()];if(f[0]>f[2]||f[1]>f[3])throw new Error("Invalid subsets");const g=this.fileDirectory.PhotometricInterpretation;if(g===R.RGB){let T=[0,1,2];if(this.fileDirectory.ExtraSamples!==Xt.Unspecified&&s){T=[];for(let m=0;m<this.fileDirectory.BitsPerSample.length;m+=1)T.push(m)}return this.readRasters({window:e,interleave:t,samples:T,pool:o,width:n,height:i,resampleMethod:a,signal:c})}let u;switch(g){case R.WhiteIsZero:case R.BlackIsZero:case R.Palette:u=[0];break;case R.CMYK:u=[0,1,2,3];break;case R.YCbCr:case R.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const y={window:f,interleave:!0,samples:u,pool:o,width:n,height:i,resampleMethod:a,signal:c},{fileDirectory:h}=this,d=await this.readRasters(y),p=2**this.fileDirectory.BitsPerSample[0];let x;switch(g){case R.WhiteIsZero:x=$t(d,p);break;case R.BlackIsZero:x=zt(d,p);break;case R.Palette:x=qt(d,h.ColorMap);break;case R.CMYK:x=Ht(d);break;case R.YCbCr:x=Zt(d);break;case R.CIELab:x=er(d);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const T=new Uint8Array(x.length/3),m=new Uint8Array(x.length/3),E=new Uint8Array(x.length/3);for(let A=0,b=0;A<x.length;A+=3,++b)T[b]=x[A],m[b]=x[A+1],E[b]=x[A+2];x=[T,m,E]}return x.width=d.width,x.height=d.height,x}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const o=this.fileDirectory.GDAL_METADATA;let n=jt(o,"Item");e===null?n=n.filter(i=>ce(i,"sample")===void 0):n=n.filter(i=>Number(ce(i,"sample"))===e);for(let i=0;i<n.length;++i){const a=n[i];t[ce(a,"name")]=a.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,o=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(o)return o[1]===0&&o[4]===0?[o[0],-o[5],o[10]]:[Math.sqrt(o[0]*o[0]+o[4]*o[4]),-Math.sqrt(o[1]*o[1]+o[5]*o[5]),o[10]];if(e){const[n,i,a]=e.getResolution();return[n*e.getWidth()/this.getWidth(),i*e.getHeight()/this.getHeight(),a*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),o=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[n,i,a,s,c,f,g,u]=this.fileDirectory.ModelTransformation,h=[[0,0],[0,t],[o,0],[o,t]].map(([x,T])=>[s+n*x+i*T,u+c*x+f*T]),d=h.map(x=>x[0]),p=h.map(x=>x[1]);return[Math.min(...d),Math.min(...p),Math.max(...d),Math.max(...p)]}else{const n=this.getOrigin(),i=this.getResolution(),a=n[0],s=n[1],c=a+i[0]*o,f=s+i[1]*t;return[Math.min(a,c),Math.min(s,f),Math.max(a,c),Math.max(s,f)]}}}class dr{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const o=this.getUint32(e,t),n=this.getUint32(e+4,t);let i;if(t){if(i=o+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*o+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}getInt64(e,t){let o=0;const n=(this._dataView.getUint8(e+(t?7:0))&128)>0;let i=!0;for(let a=0;a<8;a++){let s=this._dataView.getUint8(e+(t?a:7-a));n&&(i?s!==0&&(s=~(s-1)&255,i=!1):s=~s&255),o+=s*256**a}return n&&(o=-o),o}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return ke(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class yr{constructor(e,t,o,n){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=o,this._bigTiff=n}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),o=this.readUint32(e+4);let n;if(this._littleEndian){if(n=t+2**32*o,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*t+o,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}readInt64(e){let t=0;const o=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let n=!0;for(let i=0;i<8;i++){let a=this._dataView.getUint8(e+(this._littleEndian?i:7-i));o&&(n?a!==0&&(a=~(a-1)&255,n=!1):a=~a&255),t+=a*256**i}return o&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}class xr{async fetch(e,t=void 0){return Promise.all(e.map(o=>this.fetchSlice(o,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class De extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,De),this.name="AbortError"}}class pr extends xr{constructor(e){super(),this.arrayBuffer=e}fetchSlice(e,t){if(t&&t.aborted)throw new De("Request aborted");return this.arrayBuffer.slice(e.offset,e.offset+e.length)}}function mr(r){return new pr(r)}function ge(r){switch(r){case w.BYTE:case w.ASCII:case w.SBYTE:case w.UNDEFINED:return 1;case w.SHORT:case w.SSHORT:return 2;case w.LONG:case w.SLONG:case w.FLOAT:case w.IFD:return 4;case w.RATIONAL:case w.SRATIONAL:case w.DOUBLE:case w.LONG8:case w.SLONG8:case w.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function wr(r){const e=r.GeoKeyDirectory;if(!e)return null;const t={};for(let o=4;o<=e[3]*4;o+=4){const n=Yt[e[o]],i=e[o+1]?$[e[o+1]]:null,a=e[o+2],s=e[o+3];let c=null;if(!i)c=s;else{if(c=r[i],typeof c>"u"||c===null)throw new Error(`Could not get value of geoKey '${n}'.`);typeof c=="string"?c=c.substring(s,s+a-1):c.subarray&&(c=c.subarray(s,s+a),a===1&&(c=c[0]))}t[n]=c}return t}function M(r,e,t,o){let n=null,i=null;const a=ge(e);switch(e){case w.BYTE:case w.ASCII:case w.UNDEFINED:n=new Uint8Array(t),i=r.readUint8;break;case w.SBYTE:n=new Int8Array(t),i=r.readInt8;break;case w.SHORT:n=new Uint16Array(t),i=r.readUint16;break;case w.SSHORT:n=new Int16Array(t),i=r.readInt16;break;case w.LONG:case w.IFD:n=new Uint32Array(t),i=r.readUint32;break;case w.SLONG:n=new Int32Array(t),i=r.readInt32;break;case w.LONG8:case w.IFD8:n=new Array(t),i=r.readUint64;break;case w.SLONG8:n=new Array(t),i=r.readInt64;break;case w.RATIONAL:n=new Uint32Array(t*2),i=r.readUint32;break;case w.SRATIONAL:n=new Int32Array(t*2),i=r.readInt32;break;case w.FLOAT:n=new Float32Array(t),i=r.readFloat32;break;case w.DOUBLE:n=new Float64Array(t),i=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===w.RATIONAL||e===w.SRATIONAL)for(let s=0;s<t;s+=2)n[s]=i.call(r,o+s*a),n[s+1]=i.call(r,o+(s*a+4));else for(let s=0;s<t;++s)n[s]=i.call(r,o+s*a);return e===w.ASCII?new TextDecoder("utf-8").decode(n):n}class Tr{constructor(e,t,o){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=o}}class ne extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Er{async readRasters(e={}){const{window:t,width:o,height:n}=e;let{resX:i,resY:a,bbox:s}=e;const c=await this.getImage();let f=c;const g=await this.getImageCount(),u=c.getBoundingBox();if(t&&s)throw new Error('Both "bbox" and "window" passed.');if(o||n){if(t){const[d,p]=c.getOrigin(),[x,T]=c.getResolution();s=[d+t[0]*x,p+t[1]*T,d+t[2]*x,p+t[3]*T]}const h=s||u;if(o){if(i)throw new Error("Both width and resX passed");i=(h[2]-h[0])/o}if(n){if(a)throw new Error("Both width and resY passed");a=(h[3]-h[1])/n}}if(i||a){const h=[];for(let d=0;d<g;++d){const p=await this.getImage(d),{SubfileType:x,NewSubfileType:T}=p.fileDirectory;(d===0||x===2||T&1)&&h.push(p)}h.sort((d,p)=>d.getWidth()-p.getWidth());for(let d=0;d<h.length;++d){const p=h[d],x=(u[2]-u[0])/p.getWidth(),T=(u[3]-u[1])/p.getHeight();if(f=p,i&&i>x||a&&a>T)break}}let y=t;if(s){const[h,d]=c.getOrigin(),[p,x]=f.getResolution(c);y=[Math.round((s[0]-h)/p),Math.round((s[1]-d)/x),Math.round((s[2]-h)/p),Math.round((s[3]-d)/x)],y=[Math.min(y[0],y[2]),Math.min(y[1],y[3]),Math.max(y[0],y[2]),Math.max(y[1],y[3])]}return f.readRasters({...e,window:y})}}class Ie extends Er{constructor(e,t,o,n,i={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=o,this.firstIFDOffset=n,this.cache=i.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const o=this.bigTiff?4048:1024;return new yr((await this.source.fetch([{offset:e,length:typeof t<"u"?t:o}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,o=this.bigTiff?8:2;let n=await this.getSlice(e);const i=this.bigTiff?n.readUint64(e):n.readUint16(e),a=i*t+(this.bigTiff?16:6);n.covers(e,a)||(n=await this.getSlice(e,a));const s={};let c=e+(this.bigTiff?8:2);for(let u=0;u<i;c+=t,++u){const y=n.readUint16(c),h=n.readUint16(c+2),d=this.bigTiff?n.readUint64(c+4):n.readUint32(c+4);let p,x;const T=ge(h),m=c+(this.bigTiff?12:8);if(T*d<=(this.bigTiff?8:4))p=M(n,h,d,m);else{const E=n.readOffset(m),A=ge(h)*d;if(n.covers(E,A))p=M(n,h,d,E);else{const b=await this.getSlice(E,A);p=M(b,h,d,E)}}d===1&&kt.indexOf(y)===-1&&!(h===w.RATIONAL||h===w.SRATIONAL)?x=p[0]:x=p,s[$[y]]=x}const f=wr(s),g=n.readOffset(e+o+t*i);return new Tr(s,f,g)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof ne?new ne(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new ne(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new gr(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(o){if(o instanceof ne)t=!1;else throw o}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",o=t.length+100;let n=await this.getSlice(e,o);if(t===M(n,w.ASCII,t.length,e)){const a=M(n,w.ASCII,o,e).split(`
`)[0],s=Number(a.split("=")[1].split(" ")[0])+a.length;s>o&&(n=await this.getSlice(e,s));const c=M(n,w.ASCII,s,e);this.ghostValues={},c.split(`
`).filter(f=>f.length>0).map(f=>f.split("=")).forEach(([f,g])=>{this.ghostValues[f]=g})}return this.ghostValues}static async fromSource(e,t,o){const n=(await e.fetch([{offset:0,length:1024}],o))[0],i=new dr(n),a=i.getUint16(0,0);let s;if(a===18761)s=!0;else if(a===19789)s=!1;else throw new TypeError("Invalid byte order value.");const c=i.getUint16(2,s);let f;if(c===42)f=!1;else if(c===43){if(f=!0,i.getUint16(4,s)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const g=f?i.getUint64(8,s):i.getUint32(4,s);return new Ie(e,s,f,g,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function Ar(r,e){return Ie.fromSource(mr(r),e)}const br="/demdag-web/assets/d8_discovery-DIlOFSey.tif",Sr="/demdag-web/assets/d8_finish-Bx5Xn6p1.tif",Dr="/demdag-web/assets/d8_bg-CjKuwq6_.jpg",Ir="/demdag-web/assets/helens_fdr_discovery-DxiLFFLb.tif",_r="/demdag-web/assets/helens_fdr_finish-JytjPmE5.tif",Pr="/demdag-web/assets/helens_bg-Bc-HqWEv.jpg";var B=[],G=1,l,I,z=[],he=[.25,.5,1,2,4,8,16],ie=2;function Rr(){G=1,ie=2,console.debug("zoom: ",G),J()}function Qe(r){let e=ie+r;e<0&&(e=0),e>=he.length&&(e=he.length-1),ie=e,G=he[ie],console.debug("zoom: ",G),J()}function Or(r,e){const t=new Image;return t.crossOrigin="Anonymous",t.src=r,t.onload=e,t}async function Ur(r){const t=await(await fetch(r)).arrayBuffer(),n=await(await Ar(t)).getImage(),i=n.getWidth(),a=n.getHeight();if(r.includes("_discovery")||r.includes("_finish")){const y=await n.readRasters(),h=new Uint8ClampedArray(y[0].length*4);for(let p=0;p<a;p++)for(let x=0;x<i;x++){const T=p*i+x,m=4*p*i+4*x,E=y[0][T];h[m]=E&255,h[m+1]=E>>8&255,h[m+2]=E>>16&255,h[m+3]=E>>24&255}const d={data:h,width:i,height:a};return console.debug("data: ",d),d}const s=await n.readRGB(),c=document.createElement("canvas");c.width=i,c.height=a;const f=c.getContext("2d",{willReadFrequently:!0}),g=f.getImageData(0,0,i,a),u=g.data;for(let y=0;y<a;y++)for(let h=0;h<i;h++){const d=3*y*i+3*h,p=4*y*i+4*h;u[p]=s[d],u[p+1]=s[d+1],u[p+2]=s[d+2],u[p+3]=255}return console.debug("imdata: ",g),f.putImageData(g,0,0),g}async function We(r,e){var t=r.length;B=[];var o=function(){--t,console.debug("loaded img."),t===0&&(console.debug("images:",B),e(B))};console.debug("urls:",r);for(var n=0;n<r.length;++n){const i=r[n];console.debug("loading: ",i);let a;i.endsWith(".tif")||i.endsWith(".tiff")?(a=await Ur(i),B.push(a),o()):(a=await Or(i,o),B.push(a))}}function J(){var r=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,r),vr(l,0,0,B[0].width,B[0].height);let e=B[0].width*G,t=B[0].height*G;if(e>=4096||t>4096){alert("texture too large!"),Qe(-1);return}l.canvas.width=e,l.canvas.height=t;var o=l.getAttribLocation(I,"a_position"),n=l.getAttribLocation(I,"a_texCoord"),i=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,i),l.bufferData(l.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),l.STATIC_DRAW);var a=l.getUniformLocation(I,"u_resolution"),s=l.getUniformLocation(I,"u_mouse"),c=l.getUniformLocation(I,"u_image0"),f=l.getUniformLocation(I,"u_image1"),g=l.getUniformLocation(I,"u_image2");l.viewport(0,0,l.canvas.width,l.canvas.height),l.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT),l.useProgram(I),l.enableVertexAttribArray(o),l.bindBuffer(l.ARRAY_BUFFER,r);var u=2,y=l.FLOAT,h=!1,d=0,p=0;l.vertexAttribPointer(o,u,y,h,d,p),l.enableVertexAttribArray(n),l.bindBuffer(l.ARRAY_BUFFER,i);var u=2,y=l.FLOAT,h=!1,d=0,p=0;l.vertexAttribPointer(n,u,y,h,d,p),l.uniform2f(a,l.canvas.width/G,l.canvas.height/G),l.uniform2f(s,q.x/G,q.y/G),l.uniform1i(c,0),l.uniform1i(f,1),l.uniform1i(g,2),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,z[0]),l.activeTexture(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,z[1]),l.activeTexture(l.TEXTURE2),l.bindTexture(l.TEXTURE_2D,z[2]),l.drawArrays(l.TRIANGLES,0,6)}function et(r){var s;if(r.length===0){console.error("No Images!");return}var e=document.querySelector("#canvas");if(l=e.getContext("webgl"),!l){console.error("Cannot attach as webgl canvas to the document!");return}const t=["vertex-shader-2d","fragment-shader-2d"],o=[];for(let c=0;c<t.length;++c){let f="",g,u=t[c];const y=document.getElementById(u);if(!y)throw"*** Error: unknown script element"+u;if(f=y.text,y.type==="x-shader/x-vertex")g=l.VERTEX_SHADER;else if(y.type==="x-shader/x-fragment")g=l.FRAGMENT_SHADER;else if(g!==l.VERTEX_SHADER&&g!==l.FRAGMENT_SHADER)throw"*** Error: unknown shader type";const h=l.createShader(g);if(l.shaderSource(h,f),l.compileShader(h),!l.getShaderParameter(h,l.COMPILE_STATUS)){const p=l.getShaderInfoLog(h);return console.error("*** Error compiling shader '"+h+"':"+p+`
`+f.split(`
`).map((x,T)=>`${T+1}: ${x}`).join(`
`)),l.deleteShader(h),null}o.push(h)}if(I=l.createProgram(),o.forEach(function(c){l.attachShader(I,c)}),l.linkProgram(I),!l.getProgramParameter(I,l.LINK_STATUS)){const c=l.getProgramInfoLog(I);return errFn("Error in program linking:"+c),l.deleteProgram(I),null}l.useProgram(I),z=[];for(var i=0;i<r.length;++i){var a=l.createTexture();l.bindTexture(l.TEXTURE_2D,a),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),(s=r[i])!=null&&s.data?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,r[i].width,r[i].height,0,l.RGBA,l.UNSIGNED_BYTE,r[i].data):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,r[i]),z.push(a)}J()}function vr(r,e,t,o,n){var i=e,a=e+o,s=t,c=t+n;r.bufferData(r.ARRAY_BUFFER,new Float32Array([i,s,a,s,i,c,i,c,a,s,a,c]),r.STATIC_DRAW)}var q={x:1e6,y:1e6};function Gr(r,e){e=e||r.target;var t=e.getBoundingClientRect();return{x:r.clientX-t.left,y:r.clientY-t.top}}function Br(r,e){var t;return function(o){clearTimeout(t),t=setTimeout(()=>{r(o)},e)}}function Fr(r,e){e=e||r.target;var t=Gr(r,e);return t.x=t.x*e.width/e.clientWidth,t.y=t.y*e.height/e.clientHeight,t}document.querySelector("#canvas").addEventListener("touchstart",function(r){r.preventDefault()},{passive:!1});const Lr=r=>{const e=Fr(r);q.x=e.x,q.y=e.y,console.debug("mousePos",q),J()};document.querySelector("#canvas").addEventListener("pointermove",Br(Lr,10));document.addEventListener("resize",J);async function tt(){await We([br,Sr,Dr],et)}async function Mr(){await We([Ir,_r,Pr],et)}window.main=tt;window.mainLG=Mr;window.adjustZoom=Qe;window.resetZoom=Rr;tt();export{qr as L,Hr as a,Xe as g};
